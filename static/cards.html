<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ryan Retro - Showcase Animation</title>
    
    <!-- Dependencies -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@500;700;800&display=swap" rel="stylesheet">

    <!-- Tailwind Config to match your site -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: {
                            bg: '#2D1B4E',       // Deep Soft Purple
                            card: '#432C7A',     // Lighter Grape
                            hover: '#5B3EA8',    // Bright Purple
                            accent: '#FFFFFF',   // Pure White
                            muted: '#D4BBFF',    // Soft Lavender Text
                            red: '#FF0000',      // YouTube Red
                            
                            // Mapped difficulty colors to fit the theme better
                            easy: '#4ade80',     // Soft Green
                            medium: '#fbbf24',   // Soft Amber
                            hard: '#f43f5e'      // Soft Rose
                        }
                    },
                    fontFamily: {
                        sans: ['"Plus Jakarta Sans"', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <style>
        :root {
            --card-width: 240px;
            --card-height: 340px;
        }

        body {
            margin: 0;
            overflow: hidden;
            width: 100vw;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* --- UI OVERLAYS --- */
        #drop-zone {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(45, 27, 78, 0.9);
            backdrop-filter: blur(8px);
            z-index: 2000;
            display: none;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            gap: 1rem;
        }

        /* --- STAGE --- */
        #stage {
            position: relative;
            width: 100%;
            height: 100%;
            perspective: 1500px;
            overflow: visible;
        }

        .category-group {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            visibility: hidden;
            pointer-events: none;
        }

        .category-title {
            position: absolute;
            top: 15%; 
            width: 100%;
            text-align: center;
            z-index: 500;
            opacity: 0;
        }

        .card {
            position: absolute;
            width: var(--card-width);
            height: var(--card-height);
            left: 50%;
            top: 55%; 
            margin-left: calc(var(--card-width) * -0.5); 
            margin-top: calc(var(--card-height) * -0.5);
            border-radius: 1rem; /* rounded-2xl */
            transform-origin: center center;
            /* REMOVED default huge shadow to prevent ugly stacking */
            box-shadow: none; 
            will-change: transform, opacity, box-shadow;
            transform-style: preserve-3d;
        }

        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            border-radius: 1rem;
            overflow: hidden;
            background: #432C7A; /* brand-card */
            border: 1px solid rgba(212, 187, 255, 0.1);
        }

        .card img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
            background: #432C7A;
            position: relative;
            z-index: 2;
        }

        /* Fallback text when no image */
        .card-fallback {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 20px;
            z-index: 1;
        }

        /* Background Gradient to match site feel */
        .bg-gradient-radial {
            background: radial-gradient(circle at 50% 0%, #432C7A 0%, #2D1B4E 60%, #1a0f2e 100%);
        }
    </style>
</head>
<body class="bg-brand-bg text-brand-accent font-sans antialiased bg-gradient-radial selection:bg-brand-muted selection:text-brand-bg">

    <!-- Drop Zone Overlay -->
    <div id="drop-zone" class="border-4 border-dashed border-brand-muted/30 m-4 rounded-3xl">
        <div class="text-4xl font-extrabold text-white">DROP IMAGES HERE</div>
        <div class="text-brand-muted font-medium">To replace game covers</div>
    </div>
    
    <!-- Status Bar (Hidden for recording) -->
    <div id="status-bar" style="display: none;" class="fixed bottom-8 left-1/2 -translate-x-1/2 bg-brand-card/90 backdrop-blur-md px-6 py-3 rounded-full border border-white/10 shadow-xl z-50 flex items-center gap-3 transition-all hover:border-white/30">
        <div class="w-2.5 h-2.5 rounded-full bg-brand-red animate-pulse" id="status-dot"></div>
        <span id="status-text" class="text-sm font-bold text-brand-muted tracking-wide">Waiting for images...</span>
    </div>

    <!-- Main 3D Stage -->
    <div id="stage">
        <!-- Groups injected via JS -->
    </div>

    <script>
        // --- DATA ---
        const gamesData = [
            {
                id: "easy",
                category: "Easy",
                colorClass: "text-brand-easy",
                games: [
                    { name: "Dispatch", steamId: null },
                    { name: "Coffee Talk", steamId: "914800" },
                    { name: "Unpacking", steamId: "1135690" },
                    { name: "A Little to the Left", steamId: "1623880" },
                    { name: "Cast n Chill", steamId: null },
                    { name: "Dave the Diver", steamId: "1868140" },
                    { name: "Monster Boy", steamId: "709630" },
                    { name: "Silksong", steamId: "1030300" },
                    { name: "Cuphead", steamId: "268910" },
                    { name: "Evoland", steamId: "233350" },
                    { name: "Coromon", steamId: "1218210" },
                    { name: "Stardew Valley", steamId: "413150" },
                    { name: "The Home County", steamId: null }
                ]
            },
            {
                id: "medium",
                category: "Medium",
                colorClass: "text-brand-medium",
                games: [
                    { name: "Hades II", steamId: "1145350" },
                    { name: "Slay The Spire", steamId: "646570" },
                    { name: "Megabonk", steamId: null },
                    { name: "NFS Rivals", steamId: "126260" },
                    { name: "Skyrim", steamId: "489830" },
                    { name: "Tomb Raider", steamId: "203160" },
                    { name: "GTA V", steamId: "271590" }
                ]
            },
            {
                id: "hard",
                category: "Hard",
                colorClass: "text-brand-hard",
                games: [
                    { name: "Witcher 3", steamId: "292030" },
                    { name: "Immortals Fenyx", steamId: "2221920" },
                    { name: "Elden Ring", steamId: "1245620" },
                    { name: "Cyberpunk 2077", steamId: "1091500" }
                ]
            }
        ];

        // --- GLOBAL STATE ---
        const userImages = {}; 
        const statusText = document.getElementById('status-text');
        const statusDot = document.getElementById('status-dot');
        const stage = document.getElementById('stage');
        // Define shadow style here for consistency
        const SHADOW_STYLE = "0 25px 50px -12px rgba(0, 0, 0, 0.5)";

        // --- HELPERS ---
        const normalize = (str) => str.toLowerCase().replace(/[^a-z0-9]/g, '');
        const getSteamUrl = (id) => `https://shared.fastly.steamstatic.com/store_item_assets/steam/apps/${id}/library_600x900.jpg`;

        // --- INIT: BUILD DOM ---
        function initDOM() {
            gamesData.forEach(groupData => {
                const groupEl = document.createElement('div');
                groupEl.className = 'category-group';
                groupEl.id = `group-${groupData.id}`;
                
                const titleEl = document.createElement('div');
                titleEl.className = `category-title text-6xl md:text-8xl font-extrabold tracking-tighter drop-shadow-2xl ${groupData.colorClass}`;
                titleEl.textContent = groupData.category;
                groupEl.appendChild(titleEl);

                const centerIndex = Math.floor(groupData.games.length / 2);

                groupData.games.forEach((game, index) => {
                    const card = document.createElement('div');
                    card.className = 'card';
                    
                    const dist = Math.abs(index - centerIndex);
                    card.style.zIndex = 100 - dist;

                    // Initial Shadow Logic: Only the center card gets a shadow initially
                    // This creates the "Single Card Shadow" look for the stack
                    if (index === centerIndex) {
                        card.style.boxShadow = SHADOW_STYLE;
                    }

                    const inner = document.createElement('div');
                    inner.className = 'card-inner group transition-colors duration-300';
                    
                    const fallback = document.createElement('div');
                    fallback.className = 'card-fallback bg-brand-card';
                    
                    const fallbackTitle = document.createElement('h3');
                    fallbackTitle.className = 'font-bold text-brand-muted text-lg uppercase tracking-wide leading-tight';
                    fallbackTitle.textContent = game.name;
                    fallback.appendChild(fallbackTitle);

                    const img = document.createElement('img');
                    img.className = 'game-card-img transition-opacity duration-300';
                    img.dataset.gamename = game.name;
                    img.setAttribute('referrerpolicy', 'no-referrer');
                    
                    if (game.steamId) img.src = getSteamUrl(game.steamId);
                    else img.style.display = 'none';

                    img.onerror = function() { this.style.display = 'none'; };

                    inner.appendChild(fallback);
                    inner.appendChild(img);
                    card.appendChild(inner);
                    groupEl.appendChild(card);
                });

                stage.appendChild(groupEl);
            });
        }

        // --- DRAG & DROP LOGIC ---
        window.addEventListener('dragover', (e) => { e.preventDefault(); document.getElementById('drop-zone').style.display = 'flex'; });
        window.addEventListener('dragleave', (e) => { e.preventDefault(); if(e.target.id==='drop-zone') document.getElementById('drop-zone').style.display = 'none'; });
        window.addEventListener('drop', (e) => {
            e.preventDefault();
            document.getElementById('drop-zone').style.display = 'none';
            
            const files = Array.from(e.dataTransfer.files);
            if (files.length > 0) {
                statusText.textContent = `Processing ${files.length} uploads...`;
                statusDot.classList.remove('bg-brand-red', 'bg-green-500');
                statusDot.classList.add('bg-yellow-400');
            }

            files.forEach(file => {
                if (!file.type.startsWith('image/')) return;
                const reader = new FileReader();
                reader.onload = (event) => {
                    const nName = normalize(file.name.split('.')[0]);
                    userImages[nName] = event.target.result;
                    userImages[file.name] = event.target.result; 
                    forceUpdateImages();
                };
                reader.readAsDataURL(file);
            });
        });

        function forceUpdateImages() {
            let matchedCount = 0;
            document.querySelectorAll('.game-card-img').forEach(img => {
                const nName = normalize(img.dataset.gamename);
                let match = null;
                if(userImages[nName]) match = userImages[nName];
                else {
                    for(let key in userImages) {
                        if(key.includes(nName) || nName.includes(key)) {
                            match = userImages[key];
                            break;
                        }
                    }
                }

                if (match) {
                    img.src = match;
                    img.style.display = 'block';
                    matchedCount++;
                }
            });
            statusText.textContent = `Active. Matched ${matchedCount} custom images.`;
            statusDot.classList.remove('bg-yellow-400', 'bg-brand-red');
            statusDot.classList.add('bg-green-500');
        }

        // --- ANIMATION TIMELINE ---
        function createMasterTimeline() {
            const masterTl = gsap.timeline({ repeat: -1 });

            gamesData.forEach(groupData => {
                const groupEl = document.getElementById(`group-${groupData.id}`);
                const titleEl = groupEl.querySelector('.category-title');
                const cards = groupEl.querySelectorAll('.card');
                const centerIndex = Math.floor(groupData.games.length / 2);

                const sequence = gsap.timeline();

                // 1. Activate Group (Visible)
                sequence.set(groupEl, { visibility: 'visible' });

                // 2. Animate Title In
                sequence.fromTo(titleEl, 
                    { opacity: 0, scale: 0.9, y: 20, filter: "blur(10px)" },
                    { opacity: 1, scale: 1, y: 0, filter: "blur(0px)", duration: 0.8, ease: "power3.out" }
                );

                // 3. Intro Cards (Fly up from bottom, stacked)
                // IMPORTANT: We reset the box-shadows here. 
                // Only the center card (which is on top) gets a shadow, making the stack look like "1 card".
                sequence.fromTo(cards, 
                    { 
                        y: 1000, 
                        rotationX: 30, 
                        opacity: 0, 
                        scale: 0.8,
                        boxShadow: (i) => (i === centerIndex) ? SHADOW_STYLE : "none"
                    },
                    { 
                        y: 0, 
                        rotationX: 0, 
                        opacity: 1, 
                        scale: 1, 
                        duration: 1, 
                        stagger: 0.05, 
                        ease: "power4.out" 
                    }, 
                    "-=0.4"
                );

                // 4. FAN OUT (Uniform Pyramid)
                sequence.add("fan");
                
                const xSpacing = 160; 
                
                groupData.games.forEach((_, i) => {
                    const offset = i - centerIndex; 
                    const scaleVal = Math.max(0.7, 1.25 - (Math.abs(offset) * 0.1));
                    const rotation = offset * 3; 

                    const xPos = offset * xSpacing;
                    const yPos = Math.abs(offset) * 15; 

                    sequence.to(cards[i], {
                        x: xPos,
                        y: yPos,
                        rotation: rotation,
                        scale: scaleVal,
                        // Animate shadow IN for all cards as they separate
                        boxShadow: SHADOW_STYLE, 
                        duration: 1.4,
                        ease: "power3.inOut"
                    }, "fan");
                });

                // 5. Hold
                sequence.to({}, { duration: 4 });

                // 6. Exit
                sequence.to(cards, {
                    y: 1000,
                    rotation: (i) => (i - centerIndex) * 5,
                    opacity: 0,
                    duration: 0.8,
                    stagger: 0.03,
                    ease: "power3.in"
                });

                sequence.to(titleEl, { 
                    opacity: 0, 
                    y: -20,
                    filter: "blur(10px)",
                    duration: 0.5 
                }, "-=0.6");
                
                sequence.set(groupEl, { visibility: 'hidden' });

                masterTl.add(sequence);
            });
        }

        // START
        initDOM();
        createMasterTimeline();

    </script>
</body>
</html>
