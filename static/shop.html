<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ryan Retro | Shop</title>
    <meta name="description" content="Ryan Retro Shop - Best Deals on Handhelds, Accessories, and Retro Gear.">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@500;700;800&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: {
                            bg: '#2D1B4E',       // Deep Soft Purple
                            card: '#432C7A',     // Lighter Grape
                            hover: '#5B3EA8',    // Bright Purple
                            accent: '#FFFFFF',   // Pure White
                            muted: '#D4BBFF',    // Soft Lavender Text
                            red: '#FF0000'       // YouTube Red
                        }
                    },
                    fontFamily: {
                        sans: ['"Plus Jakarta Sans"', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <style>
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #2D1B4E; }
        ::-webkit-scrollbar-thumb { background: #432C7A; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #5B3EA8; }

        /* Range Slider Styling */
        input[type=range] {
            -webkit-appearance: none; 
            background: transparent; 
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 16px; width: 16px;
            border-radius: 50%;
            background: #FFFFFF;
            cursor: pointer;
            margin-top: -6px;
            box-shadow: 0 0 10px rgba(255,255,255,0.5);
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%; height: 4px;
            cursor: pointer;
            background: #432C7A;
            border-radius: 2px;
        }

        /* Animations */
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-5px); }
            100% { transform: translateY(0px); }
        }
        .animate-float { animation: float 3s ease-in-out infinite; }
        
        .glass-panel {
            background: rgba(67, 44, 122, 0.4);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
    </style>
</head>
<body class="bg-brand-bg text-brand-accent font-sans antialiased min-h-screen flex flex-col selection:bg-white selection:text-brand-bg">

    <!-- HEADER (Exact Match to Homepage) -->
    <header class="sticky top-0 z-50 bg-brand-bg/95 backdrop-blur-sm border-b border-brand-card">
        <div class="container mx-auto px-4 lg:px-6 h-20 flex justify-between items-center">

            <a href="/" class="flex items-center gap-3 group shrink-0">
                <div class="w-10 h-10 rounded-full overflow-hidden border-2 border-white/20 group-hover:border-white transition-colors">
                    <img src="https://raw.githubusercontent.com/IRyzoI/ryanretro/refs/heads/main/images/ryanretrologo.jpg" class="w-full h-full object-cover">
                </div>
                <span class="font-bold text-lg tracking-tight hidden sm:block">Ryan Retro</span>
            </a>

            <nav class="hidden lg:flex items-center gap-6 bg-brand-card/30 px-6 py-2 rounded-full border border-white/5">
                <a href="/benchmarks" class="text-sm font-bold text-brand-muted hover:text-white transition-colors">Benchmarks</a>
                <a href="/patrons" class="text-sm font-bold text-brand-muted hover:text-white transition-colors">Patrons</a>
                <a href="/reviews" class="text-sm font-bold text-brand-muted hover:text-white transition-colors">Reviews</a>
                <a href="/store" class="text-sm font-bold text-white transition-colors">Shop</a>
            </nav>

            <div class="flex items-center gap-4">
                <div class="hidden md:flex items-center gap-2 pr-4 border-r border-brand-card/50">
                    <a href="https://www.youtube.com/@RyanRetro" target="_blank" class="text-brand-muted hover:text-white transition-colors p-1"><i data-lucide="youtube" class="w-4 h-4"></i></a>
                    <a href="https://x.com/RyanRetroYT" target="_blank" class="text-brand-muted hover:text-white transition-colors p-1"><i data-lucide="twitter" class="w-4 h-4"></i></a>
                    <a href="https://www.instagram.com/ryanretroyoutube/" target="_blank" class="text-brand-muted hover:text-white transition-colors p-1"><i data-lucide="instagram" class="w-4 h-4"></i></a>
                    <a href="https://www.tiktok.com/@ryanretroyoutube" target="_blank" class="text-brand-muted hover:text-white transition-colors p-1">
                        <svg viewBox="0 0 24 24" class="w-4 h-4 fill-current"><path d="M19.59 6.69a4.83 4.83 0 0 1-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 0 1-5.2 1.74 2.89 2.89 0 0 1 2.31-4.64 2.93 2.93 0 0 1 .88.13V9.4a6.84 6.84 0 0 0-1-.05A6.33 6.33 0 0 0 5 20.1a6.34 6.34 0 0 0 10.86-4.43v-7a8.16 8.16 0 0 0 4.77 1.52v-3.4a4.85 4.85 0 0 1-1-.1z"/></svg>
                    </a>
                    <a href="https://discord.gg/RAenS43UV9" target="_blank" class="text-brand-muted hover:text-white transition-colors p-1"><i data-lucide="message-circle" class="w-4 h-4"></i></a>
                    <a href="https://www.facebook.com/RyanRetroYT" target="_blank" class="text-brand-muted hover:text-white transition-colors p-1"><i data-lucide="facebook" class="w-4 h-4"></i></a>
                    <a href="https://www.threads.com/@ryanretroyoutube" target="_blank" class="text-brand-muted hover:text-white transition-colors p-1"><i data-lucide="at-sign" class="w-4 h-4"></i></a>
                </div>

                 <button id="mobile-menu-btn" class="lg:hidden text-white p-2">
                    <i data-lucide="menu" class="w-6 h-6"></i>
                </button>
            </div>
        </div>

        <div id="mobile-menu" class="hidden lg:hidden bg-brand-card border-t border-brand-hover absolute w-full left-0 top-full p-4 flex flex-col gap-4 shadow-xl z-50">
            <div class="grid grid-cols-2 gap-2">
                <a href="/benchmarks" class="p-3 bg-brand-bg rounded-md text-center text-sm font-bold text-white hover:bg-white/5">Benchmarks</a>
                <a href="/patrons" class="p-3 bg-brand-bg rounded-md text-center text-sm font-bold text-white hover:bg-white/5">Patrons</a>
                <a href="/reviews" class="p-3 bg-brand-bg rounded-md text-center text-sm font-bold text-white hover:bg-white/5">Reviews</a>
                <a href="/store" class="p-3 bg-brand-bg rounded-md text-center text-sm font-bold text-white hover:bg-white/5">Shop</a>
            </div>

            <div class="flex justify-center flex-wrap gap-4 pt-4 border-t border-white/10">
                <a href="https://www.youtube.com/@RyanRetro" class="text-brand-muted"><i data-lucide="youtube" class="w-5 h-5"></i></a>
                <a href="https://x.com/RyanRetroYT" class="text-brand-muted"><i data-lucide="twitter" class="w-5 h-5"></i></a>
                <a href="https://www.instagram.com/ryanretroyoutube/" class="text-brand-muted"><i data-lucide="instagram" class="w-5 h-5"></i></a>
                <a href="https://www.tiktok.com/@ryanretroyoutube" class="text-brand-muted"><svg viewBox="0 0 24 24" class="w-5 h-5 fill-current"><path d="M19.59 6.69a4.83 4.83 0 0 1-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 0 1-5.2 1.74 2.89 2.89 0 0 1 2.31-4.64 2.93 2.93 0 0 1 .88.13V9.4a6.84 6.84 0 0 0-1-.05A6.33 6.33 0 0 0 5 20.1a6.34 6.34 0 0 0 10.86-4.43v-7a8.16 8.16 0 0 0 4.77 1.52v-3.4a4.85 4.85 0 0 1-1-.1z"/></svg></a>
                <a href="https://discord.gg/RAenS43UV9" class="text-brand-muted"><i data-lucide="message-circle" class="w-5 h-5"></i></a>
                <a href="https://www.facebook.com/RyanRetroYT" class="text-brand-muted"><i data-lucide="facebook" class="w-5 h-5"></i></a>
                <a href="https://www.threads.com/@ryanretroyoutube" class="text-brand-muted"><i data-lucide="at-sign" class="w-5 h-5"></i></a>
            </div>
        </div>
    </header>

    <main class="flex-grow relative">
        <!-- Support Banner -->
        <div class="container mx-auto px-4 lg:px-6 pt-6">
            <div class="bg-gradient-to-r from-brand-card to-brand-bg border border-white/10 rounded-2xl p-4 md:p-6 flex flex-col md:flex-row items-center gap-4 text-center md:text-left shadow-lg relative overflow-hidden group">
                <div class="absolute inset-0 bg-brand-hover/10 opacity-0 group-hover:opacity-100 transition-opacity"></div>
                <div class="bg-white/10 p-3 rounded-full shrink-0 animate-float">
                    <i data-lucide="heart" class="w-6 h-6 text-brand-red fill-brand-red"></i>
                </div>
                <div class="flex-1 relative z-10">
                    <h3 class="font-bold text-white text-sm uppercase tracking-wide mb-1">Support The Channel</h3>
                    <p class="text-brand-muted text-xs md:text-sm leading-relaxed max-w-2xl">
                        These are affiliate links. Using them costs you nothing, but it helps me keep buying handhelds to review for you! Thank you for your support!
                    </p>
                </div>
                <a href="https://patreon.com/ryanretro" target="_blank" class="shrink-0 bg-white text-brand-bg font-bold text-xs px-4 py-2 rounded-lg hover:bg-brand-muted transition-colors flex items-center gap-2 z-10">
                    Join Patreon <i data-lucide="external-link" class="w-3 h-3"></i>
                </a>
            </div>
        </div>

        <!-- Controls Section -->
        <section class="container mx-auto px-4 lg:px-6 py-8">
            <div class="flex flex-col gap-6">
                <!-- Search & Main Toggles -->
                <div class="flex flex-col md:flex-row gap-4 justify-between items-center">
                    <div class="relative w-full">
                        <input type="text" id="searchInput" placeholder="Search for handhelds, accessories..." class="w-full bg-brand-bg border border-brand-card rounded-xl pl-10 pr-4 py-3 text-sm focus:outline-none focus:border-brand-muted focus:ring-1 focus:ring-brand-muted transition-all placeholder-brand-muted/50 text-white shadow-inner">
                        <i data-lucide="search" class="absolute left-3 top-3.5 w-4 h-4 text-brand-muted"></i>
                    </div>

                    <!-- Filter Toggle -->
                    <button id="toggleFilterBtn" class="flex items-center gap-2 px-6 py-3 bg-brand-card hover:bg-brand-hover text-white rounded-xl text-sm font-bold transition-all border border-white/5 w-full md:w-auto justify-center whitespace-nowrap shadow-lg">
                        <i data-lucide="sliders-horizontal" class="w-4 h-4"></i> Filters & Sort
                        <i data-lucide="chevron-down" class="w-3 h-3 transition-transform" id="filterChevron"></i>
                    </button>
                </div>

                <!-- Expanded Filters Panel -->
                <div id="filterPanel" class="hidden bg-brand-card/50 backdrop-blur-md border border-white/5 rounded-2xl p-6 shadow-xl">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
                        
                        <!-- Col 1: Sort & Currency -->
                        <div class="space-y-6">
                            <div class="space-y-3">
                                <h4 class="text-xs font-bold text-brand-muted uppercase tracking-wider">Sort By</h4>
                                <select id="sortFilter" class="w-full bg-brand-bg border border-white/10 text-white text-sm rounded-lg p-2.5 focus:border-brand-muted focus:outline-none">
                                    <option value="default">Newest Arrivals</option>
                                    <option value="price-asc">Price: Low to High</option>
                                    <option value="price-desc">Price: High to Low</option>
                                </select>
                            </div>
                            <div class="space-y-3">
                                <h4 class="text-xs font-bold text-brand-muted uppercase tracking-wider">Currency</h4>
                                <select id="currencyFilter" class="w-full bg-brand-bg border border-white/10 text-white text-sm rounded-lg p-2.5 focus:border-brand-muted focus:outline-none">
                                    <option value="USD">USD $</option>
                                    <option value="EUR">EUR â‚¬</option>
                                    <option value="GBP">GBP Â£</option>
                                    <option value="KRW">KRW â‚©</option>
                                    <option value="CAD">CAD $</option>
                                    <option value="AUD">AUD $</option>
                                </select>
                            </div>
                        </div>

                         <!-- Col 2: Categories -->
                        <div class="space-y-3">
                            <h4 class="text-xs font-bold text-brand-muted uppercase tracking-wider">Category</h4>
                            <div class="flex flex-col gap-2">
                                <button class="cat-pill w-full text-left px-4 py-2 rounded-lg text-sm font-bold text-brand-muted hover:text-white transition-all data-[active=true]:bg-brand-hover data-[active=true]:text-white data-[active=true]:shadow-md border border-white/5 bg-brand-bg/50" data-cat="all" data-active="true">All Items</button>
                                <button class="cat-pill w-full text-left px-4 py-2 rounded-lg text-sm font-bold text-brand-muted hover:text-white transition-all data-[active=true]:bg-brand-hover data-[active=true]:text-white data-[active=true]:shadow-md border border-white/5 bg-brand-bg/50" data-cat="Handhelds">Handhelds Only</button>
                                <button class="cat-pill w-full text-left px-4 py-2 rounded-lg text-sm font-bold text-brand-muted hover:text-white transition-all data-[active=true]:bg-brand-hover data-[active=true]:text-white data-[active=true]:shadow-md border border-white/5 bg-brand-bg/50" data-cat="Accessories">Accessories Only</button>
                            </div>
                        </div>

                        <!-- Col 3: Tier Slider -->
                        <div class="space-y-3">
                            <div class="flex justify-between items-center">
                                <h4 class="text-xs font-bold text-brand-muted uppercase tracking-wider">Power Tier</h4>
                                <span id="tierLabel" class="text-xs font-bold text-white bg-brand-hover px-2 py-0.5 rounded">ALL</span>
                            </div>
                            <input type="range" id="tierRange" min="0" max="4" value="0" step="1" class="w-full">
                            <div class="flex justify-between text-[10px] text-brand-muted font-bold">
                                <span>ALL</span>
                                <span>PS1</span>
                                <span>GC</span>
                                <span>SW</span>
                                <span>PC</span>
                            </div>
                            <p class="text-[10px] text-brand-muted/60 italic mt-2">Note: Selecting a specific tier will hide all accessories.</p>
                        </div>

                        <!-- Col 4: Budget & Toggles -->
                        <div class="space-y-6">
                            <div class="space-y-3">
                                <div class="flex justify-between items-center">
                                    <h4 class="text-xs font-bold text-brand-muted uppercase tracking-wider">Max Budget</h4>
                                    <span id="budgetLabel" class="text-xs font-bold text-white bg-brand-hover px-2 py-0.5 rounded">$500</span>
                                </div>
                                <input type="range" id="budgetRange" min="0" max="500" value="500" step="10" class="w-full">
                            </div>

                            <!-- Toggles -->
                            <div class="space-y-3">
                                <h4 class="text-xs font-bold text-brand-muted uppercase tracking-wider">Availability</h4>
                                <div class="flex flex-col gap-2">
                                    <label class="flex items-center gap-2 cursor-pointer group">
                                        <div class="relative flex items-center">
                                            <input type="checkbox" id="availCheck" class="peer h-4 w-4 appearance-none rounded border border-white/20 bg-brand-bg checked:bg-brand-hover checked:border-white transition-all">
                                            <i data-lucide="check" class="absolute left-0.5 top-0.5 w-3 h-3 text-white opacity-0 peer-checked:opacity-100 pointer-events-none"></i>
                                        </div>
                                        <span class="text-sm text-brand-muted group-hover:text-white transition-colors">Available Now Only</span>
                                    </label>
                                    <label class="flex items-center gap-2 cursor-pointer group">
                                        <div class="relative flex items-center">
                                            <input type="checkbox" id="officialStoreCheck" class="store-opt peer h-4 w-4 appearance-none rounded border border-white/20 bg-brand-bg checked:bg-brand-hover checked:border-white transition-all" value="official">
                                            <i data-lucide="check" class="absolute left-0.5 top-0.5 w-3 h-3 text-white opacity-0 peer-checked:opacity-100 pointer-events-none"></i>
                                        </div>
                                        <span class="text-sm text-brand-muted group-hover:text-white transition-colors">Official Stores Only</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Product Grid -->
        <section class="container mx-auto px-4 lg:px-6 pb-20 min-h-[50vh]">
            <div id="productGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                <!-- Products injected via JS -->
            </div>
        </section>

        <!-- Modals -->
        
        <!-- Product Detail Modal -->
        <div id="productModal" class="fixed inset-0 z-[100] hidden">
            <div class="absolute inset-0 bg-brand-bg/90 backdrop-blur-md" id="productModalBackdrop"></div>
            <div class="absolute inset-0 flex items-center justify-center p-4">
                <div id="productModalContent" class="bg-brand-card w-full max-w-4xl max-h-[90vh] rounded-3xl border border-white/10 shadow-2xl flex flex-col md:flex-row overflow-hidden transform scale-95 opacity-0 transition-all duration-300">
                    
                    <!-- Image Side -->
                    <div class="w-full md:w-1/2 bg-black/20 p-8 flex items-center justify-center relative group">
                        <img id="modalImg" src="" class="max-h-[300px] md:max-h-[400px] object-contain drop-shadow-2xl transition-transform duration-500 group-hover:scale-105">
                    </div>

                    <!-- Info Side -->
                    <div class="w-full md:w-1/2 p-6 md:p-8 flex flex-col bg-brand-card overflow-y-auto custom-scrollbar">
                        <div class="flex justify-end items-start mb-2">
                            <button id="closeModalBtn" class="text-brand-muted hover:text-white hover:bg-white/10 p-1 rounded-full transition-colors">
                                <i data-lucide="x" class="w-6 h-6"></i>
                            </button>
                        </div>
                        
                        <h2 id="modalTitle" class="text-3xl font-extrabold text-white mb-4 leading-tight">Product Title</h2>
                        <p id="modalDesc" class="text-brand-muted text-sm leading-relaxed mb-8">Description...</p>

                        <div class="space-y-4 mb-8">
                            <h3 class="text-xs font-bold text-white uppercase tracking-wider flex items-center gap-2">
                                <i data-lucide="shopping-bag" class="w-3 h-3 text-brand-muted"></i> Purchase Options
                            </h3>
                            <div id="modalLinks" class="flex flex-col gap-3">
                                <!-- Links injected here -->
                            </div>
                        </div>

                        <div class="mt-auto pt-6 border-t border-white/5">
                            <a id="modalYoutubeLink" href="#" target="_blank" class="flex items-center justify-center gap-3 w-full py-3 bg-brand-red hover:bg-red-600 text-white rounded-xl font-bold text-sm transition-all hover:shadow-lg hover:shadow-red-900/30">
                                <i data-lucide="play" class="w-5 h-5 fill-current"></i>
                                Watch Videos
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <!-- FOOTER (Exact Match to Homepage) -->
    <footer class="bg-brand-bg border-t border-brand-card py-12 text-center mt-auto">
        <div class="container mx-auto px-6">
            <div class="flex justify-center flex-wrap gap-6 mb-6">
                <a href="https://www.youtube.com/@RyanRetro" target="_blank" class="text-brand-muted hover:text-white transition-colors hover:scale-110"><i data-lucide="youtube" class="w-6 h-6"></i></a>
                <a href="https://x.com/RyanRetroYT" target="_blank" class="text-brand-muted hover:text-white transition-colors hover:scale-110"><i data-lucide="twitter" class="w-6 h-6"></i></a>
                <a href="https://www.instagram.com/ryanretroyoutube/" target="_blank" class="text-brand-muted hover:text-white transition-colors hover:scale-110"><i data-lucide="instagram" class="w-6 h-6"></i></a>
                <a href="https://www.tiktok.com/@ryanretroyoutube" target="_blank" class="text-brand-muted hover:text-white transition-colors hover:scale-110"><svg viewBox="0 0 24 24" class="w-6 h-6 fill-current"><path d="M19.59 6.69a4.83 4.83 0 0 1-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 0 1-5.2 1.74 2.89 2.89 0 0 1 2.31-4.64 2.93 2.93 0 0 1 .88.13V9.4a6.84 6.84 0 0 0-1-.05A6.33 6.33 0 0 0 5 20.1a6.34 6.34 0 0 0 10.86-4.43v-7a8.16 8.16 0 0 0 4.77 1.52v-3.4a4.85 4.85 0 0 1-1-.1z"/></svg></a>
                <a href="https://discord.gg/RAenS43UV9" target="_blank" class="text-brand-muted hover:text-white transition-colors hover:scale-110"><i data-lucide="message-circle" class="w-6 h-6"></i></a>
                <a href="https://www.facebook.com/RyanRetroYT" target="_blank" class="text-brand-muted hover:text-white transition-colors hover:scale-110"><i data-lucide="facebook" class="w-6 h-6"></i></a>
                <a href="https://www.threads.com/@ryanretroyoutube" target="_blank" class="text-brand-muted hover:text-white transition-colors hover:scale-110"><i data-lucide="at-sign" class="w-6 h-6"></i></a>
            </div>
            <p class="text-xs text-brand-muted font-bold uppercase tracking-widest">Â© 2026 Ryan Retro</p>
        </div>
    </footer>

    <!-- PRODUCT TEMPLATE (Hidden) -->
    <template id="productCardTemplate">
        <div class="group bg-brand-card rounded-2xl overflow-hidden border border-white/5 hover:border-white/20 transition-all hover:-translate-y-1 hover:shadow-2xl flex flex-col h-full cursor-pointer relative product-card">
            <!-- Image Area -->
            <div class="aspect-[4/3] bg-black/20 p-6 flex items-center justify-center relative overflow-hidden">
                <div class="absolute inset-0 bg-brand-hover/10 opacity-0 group-hover:opacity-100 transition-opacity z-0"></div>
                <img src="" class="card-img w-full h-full object-contain relative z-10 transition-transform duration-500 group-hover:scale-110">
                <!-- Badges removed from card view -->
            </div>
            
            <!-- Content Area -->
            <div class="p-5 flex flex-col flex-grow">
                <div class="flex justify-between items-start mb-2">
                    <span class="card-cat text-[10px] font-bold text-brand-muted uppercase tracking-wider">Handheld</span>
                    <span class="card-price text-sm font-bold text-white bg-white/10 px-2 py-0.5 rounded">$000</span>
                </div>
                <h3 class="card-title font-bold text-white text-lg mb-2 leading-tight group-hover:text-brand-muted transition-colors">Product Name</h3>
                <!-- Description removed -->
                
                <div class="mt-auto pt-4 border-t border-white/5 flex items-center justify-between">
                    <span class="text-[10px] text-brand-muted font-bold flex items-center gap-1">
                        <i data-lucide="store" class="w-3 h-3"></i> <span class="store-count">3 Stores</span>
                    </span>
                    <button class="text-xs font-bold text-white bg-brand-bg px-3 py-1.5 rounded-lg group-hover:bg-brand-hover transition-colors">
                        View Details
                    </button>
                </div>
            </div>
        </div>
    </template>

    <script>
        // Init AOS & Icons
        AOS.init({ once: true, offset: 50, duration: 800 });
        lucide.createIcons();

        // ------------------------------------------------------------------
        // DATA
        // ------------------------------------------------------------------
        const products = [
             { 
              "id": "rp6", 
              "name": "Retroid Pocket 6", 
              "category": "Handhelds", 
              "releaseDate": "2025-01-15", 
              "badge": "Pre-order ðŸ”¥", 
              "tier": 3, 
              "image": "https://raw.githubusercontent.com/IRyzoI/ryanretro/main/images/shop/rp6.png", 
              "description": "The new flagship. Snapdragon 8 Gen 2, 5.5\" 1080p 120Hz AMOLED. Available in Ryan Retro Purple!", 
              "links": [
                { "store": "Official", "url": "https://www.goretroid.com/collections/retro-game-system/products/retroid-pocket-6-handheld?sca_ref=7339476.fIz7oKv7uT", "price": 229.00, "currency": "$" }
              ] 
            },
            { 
              "id": "steam_deck", 
              "name": "Steam Deck", 
              "category": "Handhelds", 
              "releaseDate": "2023-11-16", 
              "tier": 4, 
              "image": "https://m.media-amazon.com/images/I/516sb3osGJL._SL1231_.jpg", 
              "description": "The standard for PC handheld gaming. Play your Steam library on the go.", 
              "links": [
                { "store": "Amazon", "url": "https://amzn.to/3XSu5Fe", "price": 559.00, "currency": "$" }
              ] 
            },
            { 
              "id": "rp5", 
              "name": "Retroid Pocket 5", 
              "category": "Handhelds", 
              "releaseDate": "2024-09-01", 
              "tier": 2, 
              "image": "https://raw.githubusercontent.com/IRyzoI/ryanretro/refs/heads/main/images/carousel/rp5.png", 
              "description": "Snapdragon 865 power in a premium 5.5\" OLED shell.", 
              "links": [
                { "store": "Official", "url": "https://www.goretroid.com/products/retroid-pocket-5-handheld?sca_ref=7339476.fIz7oKv7uT", "price": 199.00, "currency": "$" }, 
                { "store": "AliExpress", "url": "https://s.click.aliexpress.com/e/_c4PGUhcl", "price": 204.00, "currency": "$" }
              ] 
            },
            { 
              "id": "mangmi_air_x", 
              "name": "Mangmi Air X", 
              "category": "Handhelds", 
              "releaseDate": "2026-01-10", 
              "badge": "New Release âœ¨", 
              "tier": 3, 
              "image": "https://raw.githubusercontent.com/IRyzoI/ryanretro/refs/heads/main/images/carousel/mangmiairx.png", 
              "description": "A new contender enters the ring. Ultra-lightweight design meets heavy-hitting performance.", 
              "links": [
                { "store": "Official", "url": "https://mangmi.com/products/mangmi-air-x?sca_ref=9852375.YfyNu8ytC8akr", "price": 89.99, "currency": "$" }
              ] 
            },
            { 
              "id": "rp_mini2", 
              "name": "Retroid Pocket Mini V2", 
              "category": "Handhelds", 
              "releaseDate": "2024-08-15", 
              "tier": 2, 
              "image": "https://raw.githubusercontent.com/IRyzoI/ryanretro/refs/heads/main/images/carousel/rpmini.png", 
              "description": "A compact powerhouse featuring a 3.92\" OLED (1240x1080) and Snapdragon 865.", 
              "links": [
                { "store": "Official", "url": "https://www.goretroid.com/products/retroid-pocket-mini-v2-handheld?sca_ref=7339476.fIz7oKv7uT", "price": 179.00, "currency": "$" }, 
                { "store": "AliExpress", "url": "https://s.click.aliexpress.com/e/_c2viGFHB", "price": 204.00, "currency": "$" }, 
                { "store": "Amazon", "url": "https://amzn.to/4iXk4jH", "price": 229.00, "currency": "$" }
              ] 
            },
            { 
              "id": "ayaneo_pocket_air_mini", 
              "name": "Ayaneo Pocket Air Mini", 
              "category": "Handhelds", 
              "releaseDate": "2025-12-25", 
              "badge": "Premium ðŸ’Ž", 
              "tier": 3, 
              "image": "https://raw.githubusercontent.com/IRyzoI/ryanretro/main/images/shop/ayaneo%20pocket%20air%20mini.png", 
              "description": "Ayaneo's signature OLED quality shrunk down into a pocketable Android form factor.", 
              "links": [
                { "store": "AliExpress", "url": "https://s.click.aliexpress.com/e/_c34ldFrn", "price": 113.49, "currency": "$" }
              ] 
            },
            { 
              "id": "trimui_smart_pro_s", 
              "name": "TrimUI Smart Pro S", 
              "category": "Handhelds", 
              "releaseDate": "2025-12-15", 
              "badge": "Upgrade ðŸš€", 
              "tier": 2, 
              "image": "https://raw.githubusercontent.com/IRyzoI/ryanretro/refs/heads/main/images/carousel/brick.png", // Closest TrimUI match
              "description": "The 'S' stands for Speed. The sequel to the budget king with improved internals for better PSP emulation.", 
              "links": [
                { "store": "AliExpress", "url": "https://s.click.aliexpress.com/e/_c3d4sfRf", "price": 91.85, "currency": "$" }
              ] 
            },
            { 
              "id": "trimui_smart_pro", 
              "name": "TrimUI Smart Pro", 
              "category": "Handhelds", 
              "releaseDate": "2023-11-01", 
              "tier": 1, 
              "image": "https://raw.githubusercontent.com/IRyzoI/ryanretro/refs/heads/main/images/carousel/brick.png", // Closest TrimUI match
              "description": "The 16:9 budget favorite. Excellent screen and ergonomics for wide-screen retro gaming.", 
              "links": [
                { "store": "Amazon", "url": "https://amzn.to/4piaw4j", "price": 89.99, "currency": "$" },
                { "store": "AliExpress", "url": "https://s.click.aliexpress.com/e/_c3po77XX", "price": 57.77, "currency": "$" }
              ] 
            },
            { 
              "id": "rp_classic", 
              "name": "Retroid Pocket Classic", 
              "category": "Handhelds", 
              "releaseDate": "2024-11-20", 
              "tier": 2, 
              "image": "https://raw.githubusercontent.com/IRyzoI/ryanretro/refs/heads/main/images/carousel/rpclassic.png", 
              "description": "Vertical nostalgia meets modern power. Snapdragon G1 Gen 2 with a 4-inch OLED screen.", 
              "links": [
                { "store": "Official", "url": "https://www.goretroid.com/products/retroid-pocket-classic?sca_ref=7339476.fIz7oKv7uT", "price": 129.00, "currency": "$" }, 
                { "store": "AliExpress", "url": "https://s.click.aliexpress.com/e/_c3BX5yfb", "price": 171.62, "currency": "$" }
              ] 
            },
            { 
              "id": "rp_flip2", 
              "name": "Retroid Pocket Flip 2", 
              "category": "Handhelds", 
              "releaseDate": "2024-07-01", 
              "tier": 2, 
              "image": "https://raw.githubusercontent.com/IRyzoI/ryanretro/refs/heads/main/images/carousel/flip2.png", 
              "description": "The clamshell returns. Snapdragon 865 performance.", 
              "links": [
                { "store": "Official", "url": "https://www.goretroid.com/products/retroid-pocket-flip-2?sca_ref=7339476.fIz7oKv7uT", "price": 209.00, "currency": "$" }
              ] 
            },
            { 
              "id": "rpg2", 
              "name": "Retroid Pocket G2", 
              "category": "Handhelds", 
              "releaseDate": "2024-12-01", 
              "tier": 3, 
              "image": "https://raw.githubusercontent.com/IRyzoI/ryanretro/refs/heads/main/images/carousel/rpg2.png", 
              "description": "Premium mid-range Android handheld.", 
              "links": [
                { "store": "Official", "url": "https://www.goretroid.com/products/retroid-pocket-g2-handheld?sca_ref=7339476.fIz7oKv7uT", "price": 219.00, "currency": "$" },
                { "store": "AliExpress", "url": "https://s.click.aliexpress.com/e/_c3a6yCjb", "price": 224.00, "currency": "$" }
              ] 
            },
            { 
              "id": "rg34xx", 
              "name": "Anbernic RG34XX", 
              "category": "Handhelds", 
              "releaseDate": "2026-01-05", 
              "badge": "Hot Item ðŸ”¥", 
              "tier": 1, 
              "image": "https://raw.githubusercontent.com/IRyzoI/ryanretro/refs/heads/main/images/carousel/rg34xx.png", 
              "description": "The classic form factor refined. A perfect pocket companion for 8-bit and 16-bit classics.", 
              "links": [
                { "store": "Amazon", "url": "https://amzn.to/49kYAZJ", "price": 79.98, "currency": "$" },
                { "store": "AliExpress", "url": "https://s.click.aliexpress.com/e/_c3cp23I9", "price": 67.61, "currency": "$" }
              ] 
            },
            { 
              "id": "miyoo_mini_v4", 
              "name": "Miyoo Mini v4", 
              "category": "Handhelds", 
              "releaseDate": "2023-09-01", 
              "tier": 1, 
              "image": "https://raw.githubusercontent.com/IRyzoI/ryanretro/main/images/shop/miyoo%20mini.png", 
              "description": "Tiny horizontal legend.", 
              "links": [
                { "store": "AliExpress", "url": "https://s.click.aliexpress.com/e/_c3b0uLQt", "price": 51, "currency": "$" }
              ] 
            },
            { 
              "id": "miyoo_mini_plus", 
              "name": "Miyoo Mini Plus", 
              "category": "Handhelds", 
              "releaseDate": "2023-03-01", 
              "tier": 1, 
              "image": "https://raw.githubusercontent.com/IRyzoI/ryanretro/main/images/shop/miyoo%20mini%20plus.png", 
              "description": "The vertical standard.", 
              "links": [
                { "store": "AliExpress", "url": "https://s.click.aliexpress.com/e/_c4n4CCil", "price": 69.57, "currency": "$" }
              ] 
            },
            { 
              "id": "anker_power", 
              "name": "Anker 25000mAh Power Bank", 
              "category": "Accessories", 
              "tier": 0, 
              "image": "https://m.media-amazon.com/images/I/71K65j4IrHL._AC_SL1500_.jpg", 
              "description": "140W fast charging.", 
              "links": [
                { "store": "Amazon", "url": "https://amzn.to/3KJgFII", "price": 109.99, "currency": "$" }
              ] 
            },
            { 
              "id": "ugreen_power", 
              "name": "UGreen 25000mAh Power Bank", 
              "category": "Accessories", 
              "tier": 0, 
              "image": "https://m.media-amazon.com/images/I/61zJaUu71qL._AC_SL1500_.jpg", 
              "description": "Reliable 25k bank.", 
              "links": [
                { "store": "Amazon", "url": "https://amzn.to/44p6Iqm", "price": 89.99, "currency": "$" }
              ] 
            },
            { 
              "id": "ugreen_dock", 
              "name": "UGreen 9-in-1 Dock", 
              "category": "Accessories", 
              "tier": 0, 
              "image": "https://m.media-amazon.com/images/I/71riM53nk3L._AC_SL1500_.jpg", 
              "description": "4K@60Hz HDMI.", 
              "links": [
                { "store": "Amazon", "url": "https://amzn.to/4s2934T", "price": 39.99, "currency": "$" }
              ] 
            },
            { 
              "id": "rp_ds_addon", 
              "name": "Retroid Dual Screen Add-on", 
              "category": "Accessories", 
              "tier": 0, 
              "image": "https://www.goretroid.com/cdn/shop/files/1_22073d25-7a85-49cc-b893-fbc79dc3ae63_1024x1024@2x.jpg?v=1749457811", 
              "description": "AMOLED secondary screen.", 
              "links": [
                { "store": "Official", "url": "https://www.goretroid.com/products/retroid-dual-screen-add-on?sca_ref=7339476.fIz7oKv7uT", "price": 69.00, "currency": "$" }
              ] 
            },
            { 
              "id": "gamesir_g8p", 
              "name": "GameSir G8 Plus", 
              "category": "Accessories", 
              "tier": 0, 
              "image": "https://ae-pic-a1.aliexpress-media.com/kf/S3fe49083af5143dfaf0968cf77d823720.jpg_960x960q75.jpg_.avif", 
              "description": "Ultimate controller.", 
              "links": [
                { "store": "Amazon", "url": "https://amzn.to/4q4zTqZ", "price": 79.99, "currency": "$" }
              ] 
            },
            { 
              "id": "odin3", 
              "name": "AYN Odin 3", 
              "category": "Handhelds", 
              "badge": "Pre-order ðŸ”¥", 
              "releaseDate": "2025-02-01", 
              "tier": 3, 
              "image": "https://raw.githubusercontent.com/IRyzoI/ryanretro/refs/heads/main/images/carousel/odin3.png", 
              "description": "Snapdragon 8 Elite flagship.", 
              "links": [
                { "store": "Official", "url": "https://www.ayntec.com/products/ayn-odin-3?sca_ref=8254425.fM33Fgl5td", "price": 329.00, "currency": "$" }
              ] 
            },
            { 
              "id": "odin2_portal", 
              "name": "AYN Odin2 Portal", 
              "category": "Handhelds", 
              "releaseDate": "2024-05-15", 
              "tier": 3, 
              "image": "https://raw.githubusercontent.com/IRyzoI/ryanretro/refs/heads/main/images/carousel/portal.png", 
              "description": "7-inch OLED powerhouse.", 
              "links": [
                { "store": "Official", "url": "https://www.ayntec.com/products/odin2-portal?sca_ref=8254425.fM33Fgl5td", "price": 329.00, "currency": "$" }
              ] 
            },
            { 
              "id": "ayn_thor", 
              "name": "AYN Thor", 
              "category": "Handhelds", 
              "badge": "Pre-order ðŸ”¥", 
              "releaseDate": "2025-03-01", 
              "tier": 3, 
              "image": "https://raw.githubusercontent.com/IRyzoI/ryanretro/main/images/shop/thor.png", 
              "description": "Dual-screen OLED clamshell.", 
              "links": [
                { "store": "Official", "url": "https://www.ayntec.com/products/ayn-thor?sca_ref=8254425.fM33Fgl5td", "price": 299.00, "currency": "$" }
              ] 
            },
            { 
              "id": "sd_card", 
              "name": "SanDisk Extreme 512GB", 
              "category": "Accessories", 
              "tier": 0, 
              "image": "https://m.media-amazon.com/images/I/61MRn7f3m2L.jpg", 
              "description": "Reliable library storage.", 
              "links": [
                { "store": "Amazon", "url": "https://amzn.to/44tg0ln", "price": 59.99, "currency": "$" }
              ] 
            },
            { 
              "id": "anbernic_rg477v", 
              "name": "Anbernic RG477V", 
              "category": "Handhelds", 
              "releaseDate": "2025-12-20", 
              "badge": "New Arrival âœ¨", 
              "tier": 2, 
              "image": "https://raw.githubusercontent.com/IRyzoI/ryanretro/main/images/shop/rg477v.png", 
              "description": "Brand new vertical powerhouse! Get it while it's on discount.", 
              "links": [
                { "store": "AliExpress", "url": "https://s.click.aliexpress.com/e/_c3nmWU5X", "price": 199.00, "currency": "$" }
              ] 
            },
            {
              "id": "trimui_brick_hammer",
              "name": "TrimUI Brick Hammer",
              "category": "Handhelds",
              "releaseDate": "2024-11-15",
              "badge": "Best Value ðŸŽ",
              "tier": 1,
              "image": "https://raw.githubusercontent.com/IRyzoI/ryanretro/refs/heads/main/images/carousel/brick.png", // Using Brick image
              "description": "The premium metal sensation. CNC aluminum shell with a stunning 3.2\" IPS screen.",
              "links": [
                { "store": "Official", "url": "https://www.trimuistore.com/products/trimui-brick-hammer-handheld-game-console?sca_ref=9846443.gwM5071BNJJv", "price": 80.75, "currency": "$", "coupon": "TRIMUIMC15" },
                { "store": "Amazon", "url": "https://amzn.to/3MBZ1qY", "price": 95.99, "currency": "$" },
                { "store": "PowKiddy", "url": "https://powkiddy.com/products/new-trimui-brick-hammer-handheld-console?ref=ryanretro", "price": 80.75, "currency": "$", "coupon": "RYAN" }
              ]
            },
            {
              "id": "trimui_brick",
              "name": "TrimUI Brick",
              "category": "Handhelds",
              "releaseDate": "2024-10-10",
              "badge": "Best Value ðŸŽ",
              "tier": 1,
              "image": "https://raw.githubusercontent.com/IRyzoI/ryanretro/refs/heads/main/images/carousel/brick.png", 
              "description": "Compact vertical perfection. 1024x768 resolution in a lightweight, colorful package.",
              "links": [
                { "store": "Official", "url": "https://www.trimuistore.com/products/trimui-brick-retro-handheld-game-console?sca_ref=9846443.gwM5071BNJJv", "price": 72.75, "currency": "$", "coupon": "TRIMUIMC15" },
                { "store": "Amazon", "url": "https://amzn.to/4j3t2Mw", "price": 73.00, "currency": "$" },
                { "store": "PowKiddy", "url": "https://powkiddy.com/products/trimui-brick-handheld-game-console?ref=ryanretro", "price": 61.75, "currency": "$", "coupon": "RYAN" }
              ]
            }
        ];

        // ------------------------------------------------------------------
        // STATE
        // ------------------------------------------------------------------
        let currentCurrency = 'USD';
        const exchangeRates = { USD: 1, EUR: 0.92, GBP: 0.78, KRW: 1375, CAD: 1.36, AUD: 1.52 };
        const currencySymbols = { USD: '$', EUR: 'â‚¬', GBP: 'Â£', KRW: 'â‚©', CAD: '$', AUD: '$' };
        
        let filters = {
            search: '',
            category: 'all',
            budget: 500,
            tier: 0,
            sort: 'default',
            availableOnly: false,
            officialOnly: false
        };

        const tierMap = { 0: "ALL", 1: "PS1", 2: "GC", 3: "SW", 4: "PC" };

        // ------------------------------------------------------------------
        // HELPERS
        // ------------------------------------------------------------------
        function formatPrice(usdPrice) {
            const rate = exchangeRates[currentCurrency] || 1;
            const symbol = currencySymbols[currentCurrency] || '$';
            const price = usdPrice * rate;
            return currentCurrency === 'KRW' 
                ? `${symbol}${Math.round(price).toLocaleString()}` 
                : `${symbol}${price.toFixed(2)}`;
        }

        function getCheapestPrice(product) {
            if (!product.links || !product.links.length) return 0;
            return Math.min(...product.links.map(l => l.price));
        }

        // ------------------------------------------------------------------
        // RENDERING
        // ------------------------------------------------------------------
        const grid = document.getElementById('productGrid');
        const template = document.getElementById('productCardTemplate');

        function renderProducts() {
            grid.innerHTML = '';
            
            // Filter Logic
            const filtered = products.filter(p => {
                // Search
                if (filters.search && !p.name.toLowerCase().includes(filters.search.toLowerCase())) return false;
                
                // Category
                if (filters.category !== 'all' && p.category !== filters.category) return false;
                
                // Budget
                const cheapest = getCheapestPrice(p);
                if (cheapest > filters.budget) return false;

                // Tier (only applies to handhelds)
                if (filters.tier > 0) {
                    if (p.category !== 'Handhelds') return false;
                    if ((p.tier || 0) < filters.tier) return false;
                }

                // Checkboxes
                if (filters.availableOnly && p.badge && p.badge.toLowerCase().includes('pre-order')) return false;
                if (filters.officialOnly) {
                    const hasOfficial = p.links.some(l => l.store.toLowerCase().includes('official') || l.store.toLowerCase().includes('goretroid') || l.store.toLowerCase().includes('ayntec'));
                    if (!hasOfficial) return false;
                }

                return true;
            });

            // Sort Logic
            filtered.sort((a, b) => {
                const priceA = getCheapestPrice(a);
                const priceB = getCheapestPrice(b);
                
                if (filters.sort === 'price-asc') return priceA - priceB;
                if (filters.sort === 'price-desc') return priceB - priceA;
                
                return 0; 
            });

            if (filtered.length === 0) {
                grid.innerHTML = `
                    <div class="col-span-full py-20 text-center flex flex-col items-center">
                        <i data-lucide="ghost" class="w-12 h-12 text-brand-muted/50 mb-4"></i>
                        <h3 class="text-white font-bold text-lg">No Items Found</h3>
                        <p class="text-brand-muted text-sm">Try adjusting your filters or search.</p>
                    </div>
                `;
                lucide.createIcons();
                return;
            }

            // Render Cards
            filtered.forEach(p => {
                const clone = template.content.cloneNode(true);
                const card = clone.querySelector('.product-card');
                
                // Data binding
                const cheapest = getCheapestPrice(p);
                clone.querySelector('.card-img').src = p.image;
                clone.querySelector('.card-cat').textContent = p.category;
                clone.querySelector('.card-price').textContent = formatPrice(cheapest);
                clone.querySelector('.card-title').textContent = p.name;
                clone.querySelector('.store-count').textContent = `${p.links.length} Link${p.links.length !== 1 ? 's' : ''}`;

                // Click Event
                card.onclick = () => openProductModal(p);

                grid.appendChild(clone);
            });

            lucide.createIcons();
        }

        // ------------------------------------------------------------------
        // MODALS
        // ------------------------------------------------------------------
        
        // Product Modal
        const productModal = document.getElementById('productModal');
        const productModalContent = document.getElementById('productModalContent');
        const productModalBackdrop = document.getElementById('productModalBackdrop');

        function openProductModal(p) {
            // Populate Data
            const modalImg = document.getElementById('modalImg');
            modalImg.src = p.image;
            document.getElementById('modalTitle').textContent = p.name;
            document.getElementById('modalDesc').textContent = p.description;
            document.getElementById('modalYoutubeLink').href = `https://www.youtube.com/@RyanRetro/search?query=${encodeURIComponent(p.name)}`;

            // Click Image to Store Logic (Priority: Official -> Amazon -> AliExpress -> Others)
            let targetLink = null;
            
            // Helper to check store name
            const isStore = (link, name) => link.store.toLowerCase().includes(name);
            const isOfficial = (link) => {
                const s = link.store.toLowerCase();
                return s.includes('official') || s.includes('goretroid') || s.includes('ayntec') || s.includes('trimui') || s.includes('mangmi');
            };

            // Find priority
            targetLink = p.links.find(l => isOfficial(l));
            if (!targetLink) targetLink = p.links.find(l => isStore(l, 'amazon'));
            if (!targetLink) targetLink = p.links.find(l => isStore(l, 'ali'));
            if (!targetLink && p.links.length > 0) targetLink = p.links[0];

            // Apply Click Event
            if (targetLink) {
                modalImg.style.cursor = 'pointer';
                modalImg.onclick = () => window.open(targetLink.url, '_blank');
                modalImg.title = `Buy from ${targetLink.store}`;
            } else {
                modalImg.style.cursor = 'default';
                modalImg.onclick = null;
                modalImg.title = '';
            }

            // Links
            const linksContainer = document.getElementById('modalLinks');
            linksContainer.innerHTML = '';
            
            // Sort links by price
            const sortedLinks = [...p.links].sort((a,b) => a.price - b.price);

            sortedLinks.forEach(l => {
                // Styles based on store
                let bgClass = "bg-brand-bg hover:bg-black";
                let icon = "shopping-bag";
                const s = l.store.toLowerCase();
                
                if (s.includes('official') || s.includes('goretroid') || s.includes('ayntec')) {
                    bgClass = "bg-blue-600 hover:bg-blue-700";
                    icon = "star";
                } else if (s.includes('ali')) {
                    bgClass = "bg-red-600 hover:bg-red-700";
                    icon = "shopping-cart";
                } else if (s.includes('amazon')) {
                    bgClass = "bg-yellow-500 hover:bg-yellow-600 text-black";
                    icon = "package";
                }

                const couponHtml = l.coupon ? 
                    `<div class="flex items-center gap-2 mt-1 cursor-pointer group/coupon" onclick="navigator.clipboard.writeText('${l.coupon}'); alert('Code copied!')">
                        <span class="text-[10px] font-mono bg-white/10 px-2 py-0.5 rounded text-white border border-white/20 group-hover/coupon:border-white transition-colors">CODE: ${l.coupon}</span>
                        <i data-lucide="copy" class="w-3 h-3 text-brand-muted"></i>
                    </div>` : '';

                const el = document.createElement('div');
                el.className = `flex flex-col p-3 rounded-xl border border-white/5 ${bgClass} transition-all group`;
                
                const textColor = bgClass.includes('yellow') ? 'text-black' : 'text-white';
                const subTextColor = bgClass.includes('yellow') ? 'text-black/70' : 'text-brand-muted';

                el.innerHTML = `
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            <i data-lucide="${icon}" class="w-4 h-4 ${textColor}"></i>
                            <span class="font-bold text-sm ${textColor}">${l.store}</span>
                        </div>
                        <span class="font-bold text-sm ${textColor}">${formatPrice(l.price)}</span>
                    </div>
                    ${couponHtml}
                `;
                
                // Click wrapper
                el.style.cursor = 'pointer';
                el.onclick = (e) => {
                    if(!e.target.closest('.group\\/coupon')) window.open(l.url, '_blank');
                };

                linksContainer.appendChild(el);
            });
            lucide.createIcons();

            // Show
            productModal.classList.remove('hidden');
            setTimeout(() => {
                productModalContent.classList.remove('scale-95', 'opacity-0');
                productModalContent.classList.add('scale-100', 'opacity-100');
            }, 10);
        }

        function closeProductModal() {
            productModalContent.classList.remove('scale-100', 'opacity-100');
            productModalContent.classList.add('scale-95', 'opacity-0');
            setTimeout(() => productModal.classList.add('hidden'), 300);
        }

        document.getElementById('closeModalBtn').onclick = closeProductModal;
        productModalBackdrop.onclick = closeProductModal;

        // ------------------------------------------------------------------
        // EVENT LISTENERS
        // ------------------------------------------------------------------
        
        // Filter Panel Toggle
        const filterBtn = document.getElementById('toggleFilterBtn');
        const filterPanel = document.getElementById('filterPanel');
        const filterChevron = document.getElementById('filterChevron');

        filterBtn.onclick = () => {
            filterPanel.classList.toggle('hidden');
            filterChevron.classList.toggle('rotate-180');
        };

        // Inputs
        document.getElementById('searchInput').oninput = (e) => { filters.search = e.target.value; renderProducts(); };
        document.getElementById('sortFilter').onchange = (e) => { filters.sort = e.target.value; renderProducts(); };
        
        // Category Pills
        document.querySelectorAll('.cat-pill').forEach(btn => {
            btn.onclick = () => {
                document.querySelectorAll('.cat-pill').forEach(b => b.setAttribute('data-active', 'false'));
                btn.setAttribute('data-active', 'true');
                filters.category = btn.dataset.cat;
                renderProducts();
            };
        });

        // Sliders
        const tierRange = document.getElementById('tierRange');
        const tierLabel = document.getElementById('tierLabel');
        tierRange.oninput = (e) => {
            filters.tier = parseInt(e.target.value);
            tierLabel.textContent = tierMap[filters.tier];
            renderProducts();
        };

        const budgetRange = document.getElementById('budgetRange');
        const budgetLabel = document.getElementById('budgetLabel');
        budgetRange.oninput = (e) => {
            filters.budget = parseInt(e.target.value);
            budgetLabel.textContent = `$${filters.budget}`;
            renderProducts();
        };

        // Checkboxes
        document.getElementById('availCheck').onchange = (e) => { filters.availableOnly = e.target.checked; renderProducts(); };
        document.getElementById('officialStoreCheck').onchange = (e) => { filters.officialOnly = e.target.checked; renderProducts(); };

        // Currency
        const updateCurrency = (val) => {
            currentCurrency = val;
            renderProducts();
        };

        document.getElementById('currencyFilter').onchange = (e) => updateCurrency(e.target.value);

        // Mobile Menu
        const mobileMenuBtn = document.getElementById('mobile-menu-btn');
        const mobileMenu = document.getElementById('mobile-menu');
        if(mobileMenuBtn) {
            mobileMenuBtn.addEventListener('click', () => {
                mobileMenu.classList.toggle('hidden');
            });
        }

        // Init
        renderProducts();

    </script>
</body>
</html>
