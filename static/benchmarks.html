<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ryan Retro | Benchmarks</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@400;500;700;800&family=Plus+Jakarta+Sans:wght@500;700;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: {
                            bg: '#2D1B4E',       // Deep Soft Purple
                            card: '#432C7A',     // Lighter Grape
                            hover: '#5B3EA8',    // Bright Purple
                            accent: '#FFFFFF',   // Pure White
                            muted: '#D4BBFF',    // Soft Lavender Text
                            red: '#FF0000'       // YouTube Red
                        }
                    },
                    fontFamily: {
                        sans: ['"Plus Jakarta Sans"', 'sans-serif'],
                        mono: ['"JetBrains Mono"', 'monospace'],
                    }
                }
            }
        }
    </script>

    <style>
        /* Custom Scrollbar - Prettier & Non-overlapping */
        .custom-scrollbar::-webkit-scrollbar {
            height: 8px;
            width: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.1);
            border-radius: 4px;
            margin: 2px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            border: 2px solid transparent;
            background-clip: content-box;
            transition: background 0.3s;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
            border: 2px solid transparent;
            background-clip: content-box;
        }

        /* Animations */
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        .animate-float { animation: float 6s ease-in-out infinite; }

        @keyframes popIn { 0% { opacity: 0; transform: scale(0.95); } 100% { opacity: 1; transform: scale(1); } }
        .animate-pop-in { animation: popIn 0.3s cubic-bezier(0.16, 1, 0.3, 1); }

        /* --- BENCHMARK SPECIFIC TABLE STYLES --- */
        :root {
            --first-col-width: 240px; /* Default stretchable width */
        }

        .rr-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            color: white;
            table-layout: fixed; /* Important for resizing to work strictly */
        }

        .rr-table th {
            background: #432C7A; /* brand-card */
            padding: 16px;
            text-align: center;
            font-family: 'Kanit', sans-serif;
            font-weight: 800;
            text-transform: uppercase;
            font-size: 13px;
            letter-spacing: 0.05em;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            position: sticky;
            top: 0;
            z-index: 50;
            vertical-align: bottom;
            color: #D4BBFF; /* brand-muted */
            width: 150px; /* Default for other columns */
        }

        /* The First Column (Game) - Resizable */
        .rr-table th:first-child,
        .rr-table td:first-child {
            text-align: left;
            position: sticky;
            left: 0;
            z-index: 60;
            border-right: 1px solid rgba(255,255,255,0.1);
            width: var(--first-col-width);
            max-width: var(--first-col-width);
            min-width: 100px;
        }

        .rr-table th:first-child {
            background: #432C7A;
            cursor: pointer; /* Keeps sort pointer */
        }

        .rr-table td {
            padding: 12px 16px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            font-family: 'Kanit', sans-serif;
            font-size: 14px;
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .rr-table td:first-child {
            font-family: 'Kanit', sans-serif;
            font-size: 14px;
            font-weight: 700;
            color: white;
            background: #2D1B4E; /* brand-bg */
            z-index: 40;
        }

        /* Resizer Handle */
        .resizer {
            position: absolute;
            right: 0;
            top: 0;
            height: 100%;
            width: 5px;
            cursor: col-resize;
            user-select: none;
            touch-action: none;
            z-index: 100;
            transition: background 0.2s;
        }
        .resizer:hover, .resizer.resizing {
            background: #5B3EA8; /* brand-hover */
        }

        /* Row hover effect */
        .rr-table tbody tr {
            transition: background-color 0.2s;
        }
        .rr-table tbody tr:hover td {
            background: rgba(255,255,255,0.1);
        }
        /* Fix hover for sticky columns */
        .rr-table tbody tr:hover td:first-child {
            background: #432C7A;
        }

        /* Highlight Cells */
        .best-cell {
            background: rgba(74, 222, 128, 0.2) !important;
            color: #4ade80 !important;
            font-weight: bold;
            box-shadow: inset 0 0 0 1px rgba(74, 222, 128, 0.5);
        }
        .runs-great {
            background: rgba(74, 222, 128, 0.2) !important;
            color: #4ade80 !important;
            font-weight: bold;
            box-shadow: inset 0 0 0 1px rgba(74, 222, 128, 0.5);
        }

        /* Sortable */
        th.sortable { cursor: pointer; user-select: none; transition: color 0.2s; }
        th.sortable:hover { color: white; }

        /* Mini Mode */
        .mini-mode .rr-table th, .mini-mode .rr-table td { padding: 8px; font-size: 12px; }
        .mini-mode .chipset-label { display: none; }

        /* Toggle Buttons */
        .toggle-btn {
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 700;
            font-size: 0.75rem; /* text-xs */
            background-color: #2D1B4E; /* brand-bg */
            color: #D4BBFF; /* brand-muted */
            transition: all 0.2s;
            border: 1px solid transparent;
        }
        .toggle-btn:hover {
            color: white;
            background-color: #5B3EA8; /* brand-hover */
        }
        .toggle-btn.active {
            background-color: white;
            color: #2D1B4E; /* brand-bg */
            transform: scale(1.05);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .toggle-btn.off {
            opacity: 0.5;
            text-decoration: line-through;
        }

        /* Specific Color overrides for Mode Buttons */
        .mode-btn-switch.active { background-color: #ef4444; color: white; }
        .mode-btn-windows.active { background-color: #3b82f6; color: white; }
        .mode-btn-combined.active { background-color: #ffffff; color: #2D1B4E; }

        /* Ensure modal uses Kanit */
        #game-details-modal { font-family: 'Kanit', sans-serif; }

    </style>
</head>
<body class="bg-brand-bg text-brand-accent font-sans antialiased min-h-screen flex flex-col selection:bg-white selection:text-brand-bg">

    <header class="sticky top-0 z-50 bg-brand-bg/95 backdrop-blur-sm border-b border-brand-card">
        <div class="container mx-auto px-4 lg:px-6 h-20 flex justify-between items-center">

            <a href="/" class="flex items-center gap-3 group shrink-0">
                <div class="w-10 h-10 rounded-full overflow-hidden border-2 border-white/20 group-hover:border-white transition-colors">
                    <img src="https://raw.githubusercontent.com/IRyzoI/ryanretro/refs/heads/main/images/ryanretrologo.jpg" class="w-full h-full object-cover">
                </div>
                <span class="font-bold text-lg tracking-tight hidden sm:block">Ryan Retro</span>
            </a>

            <nav class="hidden lg:flex items-center gap-6 bg-brand-card/30 px-6 py-2 rounded-full border border-white/5">
                <a href="/benchmarks" class="text-sm font-bold text-brand-muted hover:text-white transition-colors">Benchmarks</a>
                <a href="/patrons" class="text-sm font-bold text-brand-muted hover:text-white transition-colors">Patrons</a>
                <a href="/reviews" class="text-sm font-bold text-brand-muted hover:text-white transition-colors">Reviews</a>
                <a href="/store" class="text-sm font-bold text-brand-muted hover:text-white transition-colors">Shop</a>
            </nav>

            <div class="flex items-center gap-4">
                <div class="hidden md:flex items-center gap-2 pr-4 border-r border-brand-card/50">
                    <a href="https://www.youtube.com/@RyanRetro" target="_blank" class="text-brand-muted hover:text-white transition-colors p-1"><i data-lucide="youtube" class="w-4 h-4"></i></a>
                    <a href="https://x.com/RyanRetroYT" target="_blank" class="text-brand-muted hover:text-white transition-colors p-1"><i data-lucide="twitter" class="w-4 h-4"></i></a>
                    <a href="https://www.instagram.com/ryanretroyoutube/" target="_blank" class="text-brand-muted hover:text-white transition-colors p-1"><i data-lucide="instagram" class="w-4 h-4"></i></a>
                    <a href="https://www.tiktok.com/@ryanretroyoutube" target="_blank" class="text-brand-muted hover:text-white transition-colors p-1">
                        <svg viewBox="0 0 24 24" class="w-4 h-4 fill-current"><path d="M19.59 6.69a4.83 4.83 0 0 1-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 0 1-5.2 1.74 2.89 2.89 0 0 1 2.31-4.64 2.93 2.93 0 0 1 .88.13V9.4a6.84 6.84 0 0 0-1-.05A6.33 6.33 0 0 0 5 20.1a6.34 6.34 0 0 0 10.86-4.43v-7a8.16 8.16 0 0 0 4.77 1.52v-3.4a4.85 4.85 0 0 1-1-.1z"/></svg>
                    </a>
                    <a href="https://discord.gg/RAenS43UV9" target="_blank" class="text-brand-muted hover:text-white transition-colors p-1"><i data-lucide="message-circle" class="w-4 h-4"></i></a>
                    <a href="https://www.facebook.com/RyanRetroYT" target="_blank" class="text-brand-muted hover:text-white transition-colors p-1"><i data-lucide="facebook" class="w-4 h-4"></i></a>
                    <a href="https://www.threads.com/@ryanretroyoutube" target="_blank" class="text-brand-muted hover:text-white transition-colors p-1"><i data-lucide="at-sign" class="w-4 h-4"></i></a>
                </div>

                 <button id="mobile-menu-btn" class="lg:hidden text-white p-2">
                    <i data-lucide="menu" class="w-6 h-6"></i>
                </button>
            </div>
        </div>

        <div id="mobile-menu" class="hidden lg:hidden bg-brand-card border-t border-brand-hover absolute w-full left-0 top-full p-4 flex flex-col gap-4 shadow-xl z-50">
            <div class="grid grid-cols-2 gap-2">
                <a href="/benchmarks" class="p-3 bg-brand-bg rounded-md text-center text-sm font-bold text-white hover:bg-white/5">Benchmarks</a>
                <a href="/patrons" class="p-3 bg-brand-bg rounded-md text-center text-sm font-bold text-white hover:bg-white/5">Patrons</a>
                <a href="/reviews" class="p-3 bg-brand-bg rounded-md text-center text-sm font-bold text-white hover:bg-white/5">Reviews</a>
                <a href="/store" class="p-3 bg-brand-bg rounded-md text-center text-sm font-bold text-white hover:bg-white/5">Shop</a>
            </div>

            <div class="flex justify-center flex-wrap gap-4 pt-4 border-t border-white/10">
                <a href="https://www.youtube.com/@RyanRetro" class="text-brand-muted"><i data-lucide="youtube" class="w-5 h-5"></i></a>
                <a href="https://x.com/RyanRetroYT" class="text-brand-muted"><i data-lucide="twitter" class="w-5 h-5"></i></a>
                <a href="https://www.instagram.com/ryanretroyoutube/" class="text-brand-muted"><i data-lucide="instagram" class="w-5 h-5"></i></a>
                <a href="https://www.tiktok.com/@ryanretroyoutube" class="text-brand-muted"><svg viewBox="0 0 24 24" class="w-5 h-5 fill-current"><path d="M19.59 6.69a4.83 4.83 0 0 1-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 0 1-5.2 1.74 2.89 2.89 0 0 1 2.31-4.64 2.93 2.93 0 0 1 .88.13V9.4a6.84 6.84 0 0 0-1-.05A6.33 6.33 0 0 0 5 20.1a6.34 6.34 0 0 0 10.86-4.43v-7a8.16 8.16 0 0 0 4.77 1.52v-3.4a4.85 4.85 0 0 1-1-.1z"/></svg></a>
                <a href="https://discord.gg/RAenS43UV9" class="text-brand-muted"><i data-lucide="message-circle" class="w-5 h-5"></i></a>
                <a href="https://www.facebook.com/RyanRetroYT" class="text-brand-muted"><i data-lucide="facebook" class="w-5 h-5"></i></a>
                <a href="https://www.threads.com/@ryanretroyoutube" class="text-brand-muted"><i data-lucide="at-sign" class="w-5 h-5"></i></a>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4 lg:px-6 py-8 flex-grow">

        <section class="mb-8" data-aos="fade-up">
            <h1 class="font-extrabold text-3xl md:text-5xl text-white tracking-tight">
                Handheld <span class="text-transparent bg-clip-text bg-gradient-to-r from-yellow-400 to-orange-500">Benchmarks</span>
            </h1>
        </section>

        <!-- Controls Panel -->
        <div id="controlsPanel" class="bg-brand-card rounded-2xl border border-white/5 p-6 mb-8 shadow-xl" data-aos="fade-up">

            <!-- Mode Selection -->
            <div class="flex flex-col md:flex-row flex-wrap items-center justify-between gap-6 mb-6 pb-6 border-b border-white/5">
                <div class="flex items-center gap-3">
                    <span class="font-bold text-xs text-brand-muted uppercase tracking-widest">System:</span>
                    <button class="toggle-btn mode-toggle mode-btn-combined active" data-mode="combined">ALL</button>
                    <button class="toggle-btn mode-toggle mode-btn-switch" data-mode="switch">Switch</button>
                    <button class="toggle-btn mode-toggle mode-btn-windows" data-mode="windows">Windows</button>
                </div>

                <div class="flex items-center gap-3">
                     <span class="font-bold text-xs text-brand-muted uppercase tracking-widest">View:</span>
                     <button id="toggleMiniMode" class="toggle-btn feat-mini"><i data-lucide="smartphone" class="w-3 h-3 inline mr-1"></i> Compact</button>
                </div>
            </div>

            <!-- Devices Selection -->
            <div class="flex flex-col md:flex-row flex-wrap items-center gap-4 mb-8">
                <span class="font-bold text-xs text-brand-muted uppercase tracking-widest shrink-0">Devices:</span>
                <div class="flex flex-wrap gap-2">
                    <button class="toggle-btn active device-toggle" data-col-index="1"><span class="w-2 h-2 rounded-full bg-green-500 inline-block mr-1"></span> Retroid Pocket 5</button>
                    <button class="toggle-btn active device-toggle" data-col-index="2"><span class="w-2 h-2 rounded-full bg-yellow-400 inline-block mr-1"></span> Retroid Pocket G2</button>
                    <button class="toggle-btn active device-toggle" data-col-index="3"><span class="w-2 h-2 rounded-full bg-blue-400 inline-block mr-1"></span> AYN Odin 2 Portal</button>
                    <button class="toggle-btn active device-toggle" data-col-index="4"><span class="w-2 h-2 rounded-full bg-orange-400 inline-block mr-1"></span> Konkr Pocket Fit</button>
                    <button class="toggle-btn off device-toggle" data-col-index="5"><span class="w-2 h-2 rounded-full bg-pink-400 inline-block mr-1"></span> Samsung Fold 7</button>
                    <button class="toggle-btn active device-toggle" data-col-index="6"><span class="w-2 h-2 rounded-full bg-purple-400 inline-block mr-1"></span> AYN Odin 3</button>
                    <button class="toggle-btn active device-toggle" data-col-index="7"><span class="w-2 h-2 rounded-full bg-cyan-400 inline-block mr-1"></span> Steam Deck</button>
                </div>
            </div>

            <!-- Feature Toggles -->
            <div class="bg-brand-bg/30 rounded-xl p-4 border border-white/5 flex flex-wrap items-center justify-center gap-3">
                <button id="toggleHighlight" class="toggle-btn feat-highlight"><i data-lucide="zap" class="w-3 h-3 inline mr-1"></i> Highlight Best</button>
                <button id="toggleColorMode" class="toggle-btn feat-ranking"><i data-lucide="bar-chart" class="w-3 h-3 inline mr-1"></i> Ranking Mode</button>
                <button id="toggleValueMode" class="toggle-btn feat-value"><i data-lucide="dollar-sign" class="w-3 h-3 inline mr-1"></i> Value Mode</button>
                <button id="toggleRunsGreat" class="toggle-btn feat-great"><i data-lucide="check-circle" class="w-3 h-3 inline mr-1"></i> Runs Great</button>
            </div>
        </div>

        <!-- Benchmark Table Card -->
        <div id="benchCard" class="bg-brand-bg rounded-2xl border border-white/5 shadow-xl overflow-hidden mb-8" data-aos="fade-up" data-aos-delay="100">
            <!-- Added pr-1 to container to prevent overlap of vertical scrollbar -->
            <div class="overflow-x-auto custom-scrollbar w-full max-h-[800px] pr-1">

                <table class="rr-table" data-mode="combined">
                    <thead>
                        <tr>
                            <th class="sortable relative" data-col="0">Game <div class="resizer"></div></th>
                            <th data-col-index="1"><span class="text-green-400">Retroid Pocket 5</span><div class="text-[10px] text-brand-muted font-normal mt-1 chipset-label">SD 865</div></th>
                            <th data-col-index="2"><span class="text-yellow-400">Retroid Pocket G2</span><div class="text-[10px] text-brand-muted font-normal mt-1 chipset-label">G2 Gen 2</div></th>
                            <th data-col-index="3"><span class="text-blue-400">AYN Odin 2 Portal</span><div class="text-[10px] text-brand-muted font-normal mt-1 chipset-label">8 Gen 2</div></th>
                            <th data-col-index="4"><span class="text-orange-400">Konkr Pocket Fit</span><div class="text-[10px] text-brand-muted font-normal mt-1 chipset-label">G3 Gen 3</div></th>
                            <th data-col-index="5"><span class="text-pink-400">Samsung Fold 7</span><div class="text-[10px] text-brand-muted font-normal mt-1 chipset-label">8 Elite</div></th>
                            <th data-col-index="6"><span class="text-purple-400">AYN Odin 3</span><div class="text-[10px] text-brand-muted font-normal mt-1 chipset-label">8 Elite</div></th>
                            <th data-col-index="7"><span class="text-cyan-400">Steam Deck</span><div class="text-[10px] text-brand-muted font-normal mt-1 chipset-label">AMD APU</div></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td>Captain Toad: Treasure Tracker</td><td>45</td><td>75</td><td>80</td><td>155</td><td>75</td><td>160</td><td>Untested</td></tr>
                        <tr><td>Cuphead</td><td>130</td><td>175</td><td>-</td><td>280</td><td>140</td><td>318</td><td>60</td></tr>
                        <tr><td>Cyberpunk 2077</td><td>-</td><td>11</td><td>15</td><td>16</td><td>7</td><td>14</td><td>30</td></tr>
                        <tr><td>Donut County</td><td>38</td><td>80</td><td>76</td><td>156</td><td>75</td><td>85</td><td>Untested</td></tr>
                        <tr><td>Elden Ring</td><td>11</td><td>15</td><td>19</td><td>25</td><td>5</td><td>30</td><td>40</td></tr>
                        <tr><td>FIFA 18</td><td>60</td><td>73</td><td>86</td><td>150</td><td>82</td><td>100</td><td>Untested</td></tr>
                        <tr><td>Golf Story</td><td>126</td><td>126</td><td>175</td><td>185</td><td>180</td><td>240</td><td>Untested</td></tr>
                        <tr><td>Gris</td><td>61</td><td>115</td><td>110</td><td>260</td><td>126</td><td>130</td><td>Untested</td></tr>
                        <tr><td>GTA V</td><td>20</td><td>44</td><td>47</td><td>57</td><td>-</td><td>67</td><td>76</td></tr>
                        <tr><td>Hades 2</td><td>51</td><td>67</td><td>-</td><td>124</td><td>105</td><td>190</td><td>150</td></tr>
                        <tr><td>Hollow Knight Silksong</td><td>80</td><td>120</td><td>-</td><td>190</td><td>122</td><td>220</td><td>250</td></tr>
                        <tr><td>Megabonk</td><td>-</td><td>40</td><td>-</td><td>68</td><td>40</td><td>90</td><td>240</td></tr>
                        <tr><td>Monster Boy and the Cursed Kingdom</td><td>115</td><td>100</td><td>160</td><td>165</td><td>120</td><td>220</td><td>250</td></tr>
                        <tr><td>Need for Speed Rivals</td><td>-</td><td>30</td><td>30</td><td>30</td><td>30</td><td>30</td><td>30</td></tr>
                        <tr><td>Pokémon Sword (Battle)</td><td>40</td><td>70</td><td>84</td><td>123</td><td>95</td><td>130</td><td>Untested</td></tr>
                        <tr><td>Pokémon Sword (Open)</td><td>30</td><td>33</td><td>50</td><td>53</td><td>50</td><td>68</td><td>Untested</td></tr>
                        <tr><td>Skyrim</td><td>25</td><td>36</td><td>57</td><td>57</td><td>47</td><td>57</td><td>60</td></tr>
                        <tr><td>Slay the Spire</td><td>110</td><td>115</td><td>142</td><td>145</td><td>200</td><td>240</td><td>Untested</td></tr>
                        <tr><td>Tennis in the Face</td><td>124</td><td>106</td><td>124</td><td>124</td><td>124</td><td>125</td><td>Untested</td></tr>
                        <tr><td>Tomb Raider</td><td>-</td><td>-</td><td>-</td><td>-</td><td>87</td><td>-</td><td>148</td></tr>
                        <tr><td>Traveller’s Rest</td><td>-</td><td>40</td><td>30</td><td>50</td><td>40</td><td>70</td><td>78</td></tr>
                        <tr><td>Zelda: Breath of the Wild</td><td>25</td><td>41</td><td>37</td><td>48</td><td>38</td><td>45</td><td>Untested</td></tr>
                        <tr><td>Zelda: Echoes of Wisdom</td><td>38</td><td>35</td><td>58</td><td>55</td><td>-</td><td>82</td><td>Untested</td></tr>
                        <tr><td>Zelda: Tears of the Kingdom</td><td>22</td><td>35</td><td>44</td><td>46</td><td>-</td><td>-</td><td>Untested</td></tr>
                        <tr><td>The Witcher 3</td><td>14</td><td>30</td><td>42</td><td>35</td><td>41</td><td>75</td><td>Untested</td></tr>
                    </tbody>
                </table>

                <table class="rr-table hidden" data-mode="switch">
                    <thead>
                        <tr>
                            <th class="sortable relative" data-col="0">Game <div class="resizer"></div></th>
                            <th data-col-index="1"><span class="text-green-400">Retroid Pocket 5</span><div class="text-[10px] text-brand-muted font-normal mt-1 chipset-label">SD 865</div></th>
                            <th data-col-index="2"><span class="text-yellow-400">Retroid Pocket G2</span><div class="text-[10px] text-brand-muted font-normal mt-1 chipset-label">G2 Gen 2</div></th>
                            <th data-col-index="3"><span class="text-blue-400">AYN Odin 2 Portal</span><div class="text-[10px] text-brand-muted font-normal mt-1 chipset-label">8 Gen 2</div></th>
                            <th data-col-index="4"><span class="text-orange-400">Konkr Pocket Fit</span><div class="text-[10px] text-brand-muted font-normal mt-1 chipset-label">G3 Gen 3</div></th>
                            <th data-col-index="5"><span class="text-pink-400">Samsung Fold 7</span><div class="text-[10px] text-brand-muted font-normal mt-1 chipset-label">8 Elite</div></th>
                            <th data-col-index="6"><span class="text-purple-400">AYN Odin 3</span><div class="text-[10px] text-brand-muted font-normal mt-1 chipset-label">8 Elite</div></th>
                            <th data-col-index="7"><span class="text-cyan-400">Steam Deck</span><div class="text-[10px] text-brand-muted font-normal mt-1 chipset-label">AMD APU</div></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td>Captain Toad: Treasure Tracker</td><td>45</td><td>75</td><td>80</td><td>155</td><td>75</td><td>160</td><td>Untested</td></tr>
                        <tr><td>Donut County</td><td>38</td><td>80</td><td>76</td><td>156</td><td>75</td><td>85</td><td>Untested</td></tr>
                        <tr><td>FIFA 18</td><td>60</td><td>73</td><td>86</td><td>150</td><td>82</td><td>100</td><td>Untested</td></tr>
                        <tr><td>Golf Story</td><td>126</td><td>126</td><td>175</td><td>185</td><td>180</td><td>240</td><td>Untested</td></tr>
                        <tr><td>Gris</td><td>61</td><td>115</td><td>110</td><td>260</td><td>126</td><td>130</td><td>Untested</td></tr>
                        <tr><td>Pokémon Sword (Battle)</td><td>40</td><td>70</td><td>84</td><td>123</td><td>95</td><td>130</td><td>Untested</td></tr>
                        <tr><td>Pokémon Sword (Open)</td><td>30</td><td>33</td><td>50</td><td>53</td><td>50</td><td>68</td><td>Untested</td></tr>
                        <tr><td>Slay the Spire</td><td>110</td><td>115</td><td>142</td><td>145</td><td>200</td><td>240</td><td>Untested</td></tr>
                        <tr><td>Tennis in the Face</td><td>124</td><td>106</td><td>124</td><td>124</td><td>124</td><td>125</td><td>Untested</td></tr>
                        <tr><td>Zelda: Breath of the Wild</td><td>25</td><td>41</td><td>37</td><td>48</td><td>38</td><td>45</td><td>Untested</td></tr>
                        <tr><td>Zelda: Echoes of Wisdom</td><td>38</td><td>35</td><td>58</td><td>55</td><td>-</td><td>82</td><td>Untested</td></tr>
                        <tr><td>Zelda: Tears of the Kingdom</td><td>22</td><td>35</td><td>44</td><td>46</td><td>-</td><td>-</td><td>Untested</td></tr>
                        <tr><td>The Witcher 3</td><td>14</td><td>30</td><td>42</td><td>35</td><td>41</td><td>75</td><td>Untested</td></tr>
                    </tbody>
                </table>

                <table class="rr-table hidden" data-mode="windows">
                    <thead>
                        <tr>
                            <th class="sortable relative" data-col="0">Game <div class="resizer"></div></th>
                            <th data-col-index="1"><span class="text-green-400">Retroid Pocket 5</span><div class="text-[10px] text-brand-muted font-normal mt-1 chipset-label">SD 865</div></th>
                            <th data-col-index="2"><span class="text-yellow-400">Retroid Pocket G2</span><div class="text-[10px] text-brand-muted font-normal mt-1 chipset-label">G2 Gen 2</div></th>
                            <th data-col-index="3"><span class="text-blue-400">AYN Odin 2 Portal</span><div class="text-[10px] text-brand-muted font-normal mt-1 chipset-label">8 Gen 2</div></th>
                            <th data-col-index="4"><span class="text-orange-400">Konkr Pocket Fit</span><div class="text-[10px] text-brand-muted font-normal mt-1 chipset-label">G3 Gen 3</div></th>
                            <th data-col-index="5"><span class="text-pink-400">Samsung Fold 7</span><div class="text-[10px] text-brand-muted font-normal mt-1 chipset-label">8 Elite</div></th>
                            <th data-col-index="6"><span class="text-purple-400">AYN Odin 3</span><div class="text-[10px] text-brand-muted font-normal mt-1 chipset-label">8 Elite</div></th>
                            <th data-col-index="7"><span class="text-cyan-400">Steam Deck</span><div class="text-[10px] text-brand-muted font-normal mt-1 chipset-label">AMD APU</div></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td>Cuphead</td><td>130</td><td>175</td><td>-</td><td>280</td><td>140</td><td>318</td><td>60</td></tr>
                        <tr><td>Cyberpunk 2077</td><td>-</td><td>11</td><td>15</td><td>16</td><td>7</td><td>14</td><td>30</td></tr>
                        <tr><td>Elden Ring</td><td>11</td><td>15</td><td>19</td><td>25</td><td>5</td><td>30</td><td>40</td></tr>
                        <tr><td>GTA V</td><td>20</td><td>44</td><td>47</td><td>57</td><td>-</td><td>67</td><td>76</td></tr>
                        <tr><td>Hades 2</td><td>51</td><td>67</td><td>-</td><td>124</td><td>105</td><td>190</td><td>150</td></tr>
                        <tr><td>Hollow Knight Silksong</td><td>80</td><td>120</td><td>-</td><td>190</td><td>122</td><td>220</td><td>250</td></tr>
                        <tr><td>Megabonk</td><td>-</td><td>40</td><td>-</td><td>68</td><td>40</td><td>90</td><td>240</td></tr>
                        <tr><td>Monster Boy and the Cursed Kingdom</td><td>115</td><td>100</td><td>160</td><td>165</td><td>120</td><td>220</td><td>250</td></tr>
                        <tr><td>Need for Speed Rivals</td><td>-</td><td>30</td><td>30</td><td>30</td><td>30</td><td>30</td><td>30</td></tr>
                        <tr><td>Skyrim</td><td>25</td><td>36</td><td>57</td><td>57</td><td>47</td><td>57</td><td>60</td></tr>
                        <tr><td>Tomb Raider</td><td>-</td><td>-</td><td>-</td><td>-</td><td>87</td><td>-</td><td>148</td></tr>
                        <tr><td>Traveller’s Rest</td><td>-</td><td>40</td><td>30</td><td>50</td><td>40</td><td>70</td><td>78</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- Legend Footer -->
            <div class="bg-black/20 p-4 border-t border-white/5 flex flex-col md:flex-row justify-between items-center gap-4 text-xs font-mono text-brand-muted">
                <div class="flex items-center gap-3">
                    <span>RANKING:</span>
                    <div class="flex items-center gap-1"><span class="w-3 h-3 rounded-sm bg-red-500"></span> Low</div>
                    <div class="flex items-center gap-1"><span class="w-3 h-3 rounded-sm bg-yellow-400"></span> Mid</div>
                    <div class="flex items-center gap-1"><span class="w-3 h-3 rounded-sm bg-green-400"></span> High</div>
                </div>
                <div>Values represent Average FPS estimates.</div>
            </div>
        </div>

        <!-- Notes Section -->
        <div class="mt-8 text-center" data-aos="fade-up">
            <button id="toggleNotes" class="bg-brand-card hover:bg-brand-hover border border-white/5 text-white px-6 py-3 rounded-xl font-bold text-xs transition-all">
                <i data-lucide="info" class="inline w-4 h-4 mr-2"></i> SHOW NOTES
            </button>

            <div id="notesContent" class="hidden mt-6 bg-brand-card border border-white/5 rounded-2xl p-8 text-left max-w-4xl mx-auto shadow-xl">
                 <div class="grid md:grid-cols-2 gap-8 mb-8">
                     <div>
                         <h3 class="font-bold text-yellow-400 text-sm mb-2 flex items-center gap-2"><i data-lucide="eye" class="w-4 h-4"></i> Performance Measurement</h3>
                         <p class="text-brand-muted text-sm leading-relaxed">
                           Please note that these tests utilize "eyeballed" FPS averages observed during active gameplay. They were not captured using scientific frame-time analysis tools.
                         </p>
                     </div>
                     <div>
                        <h3 class="font-bold text-green-400 text-sm mb-2 flex items-center gap-2"><i data-lucide="dollar-sign" class="w-4 h-4"></i> Value Mode</h3>
                        <p class="text-brand-muted text-sm leading-relaxed">
                           Value Mode displays the "Price per Frame" for each device. This is calculated by taking the cost of the handheld at the time of filming and dividing it by the average FPS ($/FPS).
                        </p>
                     </div>
                     <div>
                        <h3 class="font-bold text-blue-400 text-sm mb-2 flex items-center gap-2"><i data-lucide="check-circle" class="w-4 h-4"></i> Runs Great</h3>
                        <p class="text-brand-muted text-sm leading-relaxed">
                           The "Runs Great" highlight indicates that the handheld achieved the expected playable target for that title (typically 30 FPS for AAA/3D, 60 FPS for 2D).
                        </p>
                     </div>
                 </div>

                 <div class="mt-8 pt-8 border-t border-white/5">
                     <h3 class="font-bold text-purple-400 text-sm mb-4">Device Specs & Pricing (Time of Filming)</h3>
                     <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 text-xs">
                         <div class="bg-brand-bg/50 p-4 rounded-xl border border-white/5 hover:bg-white/5 transition-colors">
                             <span class="text-green-400 font-bold block mb-1 text-sm">Retroid Pocket 5 ($199)</span>
                             <div class="text-brand-muted flex flex-col gap-1">
                                <span>Chip: Snapdragon 865</span>
                                <span>RAM: 8GB</span>
                             </div>
                         </div>
                         <div class="bg-brand-bg/50 p-4 rounded-xl border border-white/5 hover:bg-white/5 transition-colors">
                             <span class="text-yellow-400 font-bold block mb-1 text-sm">Retroid Pocket G2 ($219)</span>
                             <div class="text-brand-muted flex flex-col gap-1">
                                <span>Chip: Snapdragon G2 Gen 2</span>
                                <span>RAM: 8GB</span>
                             </div>
                         </div>
                         <div class="bg-brand-bg/50 p-4 rounded-xl border border-white/5 hover:bg-white/5 transition-colors">
                             <span class="text-blue-400 font-bold block mb-1 text-sm">AYN Odin 2 Portal ($329)</span>
                             <div class="text-brand-muted flex flex-col gap-1">
                                <span>Chip: Snapdragon 8 Gen 2</span>
                                <span>RAM: 8GB</span>
                             </div>
                         </div>
                         <div class="bg-brand-bg/50 p-4 rounded-xl border border-white/5 hover:bg-white/5 transition-colors">
                             <span class="text-orange-400 font-bold block mb-1 text-sm">Konkr Pocket Fit ($329)</span>
                             <div class="text-brand-muted flex flex-col gap-1">
                                <span>Chip: Snapdragon G3 Gen 3</span>
                                <span>RAM: 12GB</span>
                             </div>
                         </div>
                         <div class="bg-brand-bg/50 p-4 rounded-xl border border-white/5 hover:bg-white/5 transition-colors">
                             <span class="text-pink-400 font-bold block mb-1 text-sm">Samsung Fold 7 ($1719)</span>
                             <div class="text-brand-muted flex flex-col gap-1">
                                <span>Chip: Snapdragon 8 Elite</span>
                                <span>RAM: 12GB</span>
                             </div>
                         </div>
                         <div class="bg-brand-bg/50 p-4 rounded-xl border border-white/5 hover:bg-white/5 transition-colors">
                             <span class="text-purple-400 font-bold block mb-1 text-sm">AYN Odin 3 ($449)</span>
                             <div class="text-brand-muted flex flex-col gap-1">
                                <span>Chip: Snapdragon 8 Elite</span>
                                <span>RAM: 16GB</span>
                             </div>
                         </div>
                         <div class="bg-brand-bg/50 p-4 rounded-xl border border-white/5 hover:bg-white/5 transition-colors">
                             <span class="text-cyan-400 font-bold block mb-1 text-sm">Steam Deck ($399)</span>
                             <div class="text-brand-muted flex flex-col gap-1">
                                <span>Chip: AMD Custom APU</span>
                                <span>RAM: 16GB</span>
                             </div>
                         </div>
                     </div>
                 </div>
            </div>
        </div>

    </main>

    <footer class="bg-brand-bg border-t border-brand-card py-12 text-center">
        <div class="container mx-auto px-6">
            <div class="flex justify-center flex-wrap gap-6 mb-6">
                <a href="https://www.youtube.com/@RyanRetro" target="_blank" class="text-brand-muted hover:text-white transition-colors hover:scale-110"><i data-lucide="youtube" class="w-6 h-6"></i></a>
                <a href="https://x.com/RyanRetroYT" target="_blank" class="text-brand-muted hover:text-white transition-colors hover:scale-110"><i data-lucide="twitter" class="w-6 h-6"></i></a>
                <a href="https://www.instagram.com/ryanretroyoutube/" target="_blank" class="text-brand-muted hover:text-white transition-colors hover:scale-110"><i data-lucide="instagram" class="w-6 h-6"></i></a>
                <a href="https://www.tiktok.com/@ryanretroyoutube" target="_blank" class="text-brand-muted hover:text-white transition-colors hover:scale-110"><svg viewBox="0 0 24 24" class="w-6 h-6 fill-current"><path d="M19.59 6.69a4.83 4.83 0 0 1-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 0 1-5.2 1.74 2.89 2.89 0 0 1 2.31-4.64 2.93 2.93 0 0 1 .88.13V9.4a6.84 6.84 0 0 0-1-.05A6.33 6.33 0 0 0 5 20.1a6.34 6.34 0 0 0 10.86-4.43v-7a8.16 8.16 0 0 0 4.77 1.52v-3.4a4.85 4.85 0 0 1-1-.1z"/></svg></a>
                <a href="https://discord.gg/RAenS43UV9" target="_blank" class="text-brand-muted hover:text-white transition-colors hover:scale-110"><i data-lucide="message-circle" class="w-6 h-6"></i></a>
                <a href="https://www.facebook.com/RyanRetroYT" target="_blank" class="text-brand-muted hover:text-white transition-colors hover:scale-110"><i data-lucide="facebook" class="w-6 h-6"></i></a>
                <a href="https://www.threads.com/@ryanretroyoutube" target="_blank" class="text-brand-muted hover:text-white transition-colors hover:scale-110"><i data-lucide="at-sign" class="w-6 h-6"></i></a>
            </div>
            <p class="text-xs text-brand-muted font-bold uppercase tracking-widest">© 2026 Ryan Retro</p>
        </div>
    </footer>

    <!-- Benchmark Detail Modal -->
    <div id="game-details-modal" class="fixed inset-0 z-[100] hidden flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-brand-bg/90 backdrop-blur-sm" id="game-modal-bg"></div>
        <div id="game-card-wrapper" class="relative bg-brand-card border-2 border-white/20 rounded-3xl w-full max-w-2xl shadow-2xl animate-pop-in flex flex-col max-h-[90vh] overflow-hidden">
            <div class="flex justify-between items-center p-4 border-b border-white/10 bg-black/20 shrink-0">
                <span class="font-bold text-brand-muted text-xs pl-2 tracking-widest uppercase">BENCHMARK DETAILS</span>
                <div class="flex gap-2">
                    <button id="screenshot-game-modal" class="text-white/70 hover:text-white hover:bg-white/10 p-2 rounded-lg transition-colors flex items-center gap-2" title="Save Card">
                        <i data-lucide="camera" class="w-5 h-5"></i>
                        <span class="font-bold text-xs hidden sm:inline">SAVE CARD</span>
                    </button>
                    <button id="close-game-modal" class="text-white/70 hover:text-white hover:bg-red-500/20 p-2 rounded-lg transition-colors">
                        <i data-lucide="x" class="w-5 h-5"></i>
                    </button>
                </div>
            </div>
            <div id="game-modal-content" class="overflow-y-auto custom-scrollbar p-6 md:p-8 grow text-white">
                </div>
        </div>
    </div>

    <script>
        lucide.createIcons();
        AOS.init({ once: true, offset: 50, duration: 800 });

        // --- BENCHMARK LOGIC ---
        const DEVICE_COUNT = 7;
        const prices = {
            1: 199,  // RP5
            2: 219,  // RPG2
            3: 329,  // Odin 2 Portal
            4: 329,  // Konkr
            5: 1719, // Fold 7
            6: 449,  // Odin 3
            7: 399   // Steam Deck
        };
        const deviceNames = {
            1: "Retroid Pocket 5",
            2: "Retroid Pocket G2",
            3: "AYN Odin 2 Portal",
            4: "Konkr Pocket Fit",
            5: "Samsung Fold 7",
            6: "AYN Odin 3",
            7: "Steam Deck"
        };
        const deviceColors = {
            1: "text-green-400",
            2: "text-yellow-400",
            3: "text-blue-400",
            4: "text-orange-400",
            5: "text-pink-400",
            6: "text-purple-400",
            7: "text-cyan-400"
        };

        let activeMode = 'combined';
        let highlightOn = false;
        let colorModeOn = false;
        let valueModeOn = false;
        let runsGreatOn = false;
        let miniModeOn = false;
        const columnVisibility = { 1: true, 2: true, 3: true, 4: true, 5: false, 6: true, 7: true };

        const tables = document.querySelectorAll('.rr-table');
        const benchCard = document.getElementById('benchCard');
        const controlsPanel = document.getElementById('controlsPanel');

        function getActiveTable() {
            return document.querySelector(`.rr-table[data-mode="${activeMode}"]`);
        }

        function updateTableVisibility() {
            tables.forEach(t => t.classList.add('hidden'));
            getActiveTable().classList.remove('hidden');
        }

        function clearEffects() {
            document.querySelectorAll('.best-cell').forEach(el => el.classList.remove('best-cell'));
            document.querySelectorAll('.runs-great').forEach(el => el.classList.remove('runs-great'));
            document.querySelectorAll('.rr-table td').forEach(el => {
                el.style.color = '';
                el.style.fontWeight = '';
                if (el.dataset.original) {
                    el.innerHTML = el.dataset.original;
                    delete el.dataset.original;
                }
            });
        }

        function updateColumnVisibility() {
            tables.forEach(table => {
                const headRow = table.querySelector('thead tr');
                const bodyRows = table.querySelectorAll('tbody tr');

                // Headers
                for (let i = 1; i <= DEVICE_COUNT; i++) {
                    const th = headRow.querySelector(`th[data-col-index="${i}"]`);
                    if (th) th.style.display = columnVisibility[i] ? '' : 'none';
                }

                // Cells
                bodyRows.forEach(row => {
                    const cells = row.children;
                    for (let i = 1; i <= DEVICE_COUNT; i++) {
                        if (cells[i]) cells[i].style.display = columnVisibility[i] ? '' : 'none';
                    }
                });
            });

            if (highlightOn) applyHighlight();
            if (colorModeOn) applyColorMode();
            if (valueModeOn) applyValueMode();
            if (runsGreatOn) applyRunsGreat();
        }

        function applyHighlight() {
            clearEffects();
            const table = getActiveTable();
            const rows = table.querySelectorAll('tbody tr');

            rows.forEach(row => {
                let maxVal = -Infinity;
                let cells = [];

                for (let i = 1; i <= DEVICE_COUNT; i++) {
                    if (!columnVisibility[i]) continue;
                    const cell = row.children[i];
                    if(!cell) continue;
                    const val = parseFloat(cell.innerText);
                    if (!isNaN(val)) {
                        if (val > maxVal) maxVal = val;
                        cells.push(cell);
                    }
                }

                if (maxVal > 0) {
                    cells.forEach(cell => {
                        if (parseFloat(cell.innerText) === maxVal) {
                            cell.classList.add('best-cell');
                        }
                    });
                }
            });
        }

        function applyColorMode() {
            clearEffects();
            const table = getActiveTable();
            const rows = table.querySelectorAll('tbody tr');

            rows.forEach(row => {
                let vals = [];
                for (let i = 1; i <= DEVICE_COUNT; i++) {
                    if (!columnVisibility[i]) continue;
                    const cell = row.children[i];
                    if(!cell) continue;
                    const val = parseFloat(cell.innerText);
                    if (!isNaN(val)) vals.push(val);
                }

                if (vals.length === 0) return;
                const min = Math.min(...vals);
                const max = Math.max(...vals);
                const range = max - min || 1;

                for (let i = 1; i <= DEVICE_COUNT; i++) {
                    if (!columnVisibility[i]) continue;
                    const cell = row.children[i];
                    if(!cell) continue;
                    const val = parseFloat(cell.innerText);
                    if (isNaN(val)) continue;

                    const t = (val - min) / range;
                    if (t < 0.33) {
                        cell.style.color = '#f87171'; // Red
                    } else if (t < 0.66) {
                        cell.style.color = '#facc15'; // Yellow
                    } else {
                        cell.style.color = '#4ade80'; // Green
                        cell.style.fontWeight = 'bold';
                    }
                }
            });
        }

        function applyValueMode() {
            clearEffects();
            const table = getActiveTable();
            const rows = table.querySelectorAll('tbody tr');

            rows.forEach(row => {
                let minCost = Infinity;
                let calculatedCosts = {};

                for (let i = 1; i <= DEVICE_COUNT; i++) {
                    if (!columnVisibility[i]) continue;
                    const cell = row.children[i];
                    if(!cell) continue;

                    if (!cell.dataset.original) {
                        cell.dataset.original = cell.innerText.trim();
                    }

                    const val = parseFloat(cell.dataset.original);
                    if (!isNaN(val) && val > 0) {
                        const cost = prices[i] / val;
                        calculatedCosts[i] = cost;
                        if (cost < minCost) minCost = cost;
                    }
                }

                for (let i = 1; i <= DEVICE_COUNT; i++) {
                    if (!columnVisibility[i]) continue;
                    const cell = row.children[i];
                    if(!cell) continue;

                    const val = parseFloat(cell.dataset.original);
                    if (!isNaN(val) && val > 0) {
                        const cost = prices[i] / val;
                        const isBest = (Math.abs(cost - minCost) < 0.0001);

                        if (isBest) {
                            cell.innerHTML = `<span class="text-green-400 font-bold">$${cost.toFixed(2)}</span>`;
                            cell.classList.add('best-cell');
                        } else {
                            cell.innerHTML = `<span class="text-yellow-400">$${cost.toFixed(2)}</span>`;
                        }
                    }
                }
            });
        }

        function applyRunsGreat() {
            clearEffects();
            const table = getActiveTable();
            const rows = table.querySelectorAll('tbody tr');

            rows.forEach(row => {
                const nameCell = row.children[0];
                const gameName = nameCell.innerText.trim();

                const demanding = [
                    'Elden Ring','Cyberpunk 2077','Need for Speed Rivals',
                    'Pokémon Sword (Open)','Pokémon Sword (Battle)',
                    'Zelda: Breath of the Wild','Zelda: Tears of the Kingdom','The Witcher 3'
                ].includes(gameName);

                const threshold = demanding ? 30 : 60;

                for (let i = 1; i <= DEVICE_COUNT; i++) {
                    if (!columnVisibility[i]) continue;
                    const cell = row.children[i];
                    if(!cell) continue;
                    const val = parseFloat(cell.innerText);
                    if (!isNaN(val) && val >= threshold) {
                        cell.classList.add('runs-great');
                    }
                }
            });
        }

        // --- HANDLERS ---

        // Modes
        document.querySelectorAll('.mode-toggle').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.mode-toggle').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                activeMode = btn.dataset.mode;
                updateTableVisibility();

                // Re-apply current feature
                if (highlightOn) applyHighlight();
                if (colorModeOn) applyColorMode();
                if (valueModeOn) applyValueMode();
                if (runsGreatOn) applyRunsGreat();
            });
        });

        // Device Toggles
        document.querySelectorAll('.device-toggle').forEach(btn => {
            btn.addEventListener('click', () => {
                const idx = parseInt(btn.dataset.colIndex);
                if (btn.classList.contains('active')) {
                    btn.classList.remove('active');
                    btn.classList.add('off');
                    columnVisibility[idx] = false;
                } else {
                    btn.classList.remove('off');
                    btn.classList.add('active');
                    columnVisibility[idx] = true;
                }
                updateColumnVisibility();
            });
        });

        // Feature Toggles (Radio behavior)
        const feats = ['highlight', 'ranking', 'value', 'great'];
        feats.forEach(f => {
            document.querySelector(`.feat-${f}`).addEventListener('click', (e) => {
                const btn = e.target.closest('button');
                const wasActive = btn.classList.contains('active');

                // Reset all
                feats.forEach(x => {
                    document.querySelector(`.feat-${x}`).classList.remove('active');
                    if(x === 'highlight') highlightOn = false;
                    if(x === 'ranking') colorModeOn = false;
                    if(x === 'value') valueModeOn = false;
                    if(x === 'great') runsGreatOn = false;
                });

                clearEffects();

                if (!wasActive) {
                    btn.classList.add('active');
                    if(f === 'highlight') { highlightOn = true; applyHighlight(); }
                    if(f === 'ranking') { colorModeOn = true; applyColorMode(); }
                    if(f === 'value') { valueModeOn = true; applyValueMode(); }
                    if(f === 'great') { runsGreatOn = true; applyRunsGreat(); }
                }
            });
        });

        // Mini Mode Toggle
        document.getElementById('toggleMiniMode').addEventListener('click', function() {
            this.classList.toggle('active');
            miniModeOn = !miniModeOn;
            if(miniModeOn) benchCard.classList.add('mini-mode');
            else benchCard.classList.remove('mini-mode');
        });

        // Notes Toggle
        document.getElementById('toggleNotes').addEventListener('click', () => {
            document.getElementById('notesContent').classList.toggle('hidden');
        });

        // Mobile Menu
        const mobileMenuBtn = document.getElementById('mobile-menu-btn');
        const mobileMenu = document.getElementById('mobile-menu');
        if(mobileMenuBtn) {
            mobileMenuBtn.addEventListener('click', () => {
                mobileMenu.classList.toggle('hidden');
            });
        }

        // Sorting Logic
        document.querySelectorAll('th.sortable').forEach(th => {
            th.addEventListener('click', function(e) {
                if (e.target.classList.contains('resizer')) return; // Ignore clicks on resizer

                const table = th.closest('table');
                const tbody = table.querySelector('tbody');
                const rowsArray = Array.from(tbody.rows);
                const colIndex = Array.from(th.parentNode.children).indexOf(th);
                const isAsc = th.dataset.sortDir === 'asc';

                table.querySelectorAll('th').forEach(h => h.removeAttribute('data-sort-dir'));
                th.dataset.sortDir = isAsc ? 'desc' : 'asc';

                rowsArray.sort((a, b) => {
                    const cellA = a.children[colIndex];
                    const cellB = b.children[colIndex];

                    const getCleanVal = (cell) => {
                        let val = cell.innerText.trim();
                        if (val.startsWith('$')) val = val.substring(1);
                        if (val === '-' || val.toLowerCase() === 'untested') return -1;
                        const n = parseFloat(val);
                        return isNaN(n) ? val : n;
                    };

                    const valA = getCleanVal(cellA);
                    const valB = getCleanVal(cellB);

                    if (typeof valA === 'number' && typeof valB === 'number') {
                        return isAsc ? valB - valA : valA - valB;
                    } else {
                        return isAsc ? valB.toString().localeCompare(valA) : valA.toString().localeCompare(valB);
                    }
                });
                tbody.append(...rowsArray);
            });
        });

        // --- RESIZABLE COLUMN LOGIC ---
        document.querySelectorAll('.resizer').forEach(resizer => {
            let startX, startWidth;
            const th = resizer.parentElement;

            resizer.addEventListener('mousedown', initResize);

            function initResize(e) {
                startX = e.clientX;
                startWidth = parseInt(window.getComputedStyle(th).width, 10);
                resizer.classList.add('resizing');
                document.documentElement.addEventListener('mousemove', doResize);
                document.documentElement.addEventListener('mouseup', stopResize);
                e.preventDefault(); // Prevent text selection
            }

            function doResize(e) {
                const width = startWidth + (e.clientX - startX);
                if (width > 80) { // Minimum width constraint
                    document.documentElement.style.setProperty('--first-col-width', `${width}px`);
                }
            }

            function stopResize() {
                resizer.classList.remove('resizing');
                document.documentElement.removeEventListener('mousemove', doResize);
                document.documentElement.removeEventListener('mouseup', stopResize);
            }
        });

        // --- GAME MODAL LOGIC ---

        const modal = document.getElementById('game-details-modal');
        const modalContent = document.getElementById('game-modal-content');
        const closeBtn = document.getElementById('close-game-modal');
        const bg = document.getElementById('game-modal-bg');

        // Add Click listeners to all rows
        function attachRowListeners() {
            document.querySelectorAll('.rr-table tbody tr').forEach(row => {
                row.addEventListener('click', (e) => {
                    // Prevent modal opening if clicking the first column (likely resizing intent/misclick)
                    // or better, just if clicking resizer (handled in sortable logic)
                    // But if user clicks text in 1st col, open modal.
                    openBenchmarkModal(row)
                });
            });
        }

        function openBenchmarkModal(row) {
            const gameName = row.children[0].innerText.trim();

            const GAME_COVERS = {
              "Captain Toad: Treasure Tracker": "https://static.wikia.nocookie.net/nintendo/images/e/e9/Captain_Toad_Treasure_Switch_EU.jpg/revision/latest?cb=20190915115715&path-prefix=en",
              "Golf Story": "https://images.launchbox-app.com/e31a54d2-7ba1-443d-864e-cb9a680f6e75.jpg",
              "Pokémon Sword (Battle)": "https://archives.bulbagarden.net/media/upload/thumb/4/47/Sword_EN_boxart.png/640px-Sword_EN_boxart.png",
              "Pokémon Sword (Open)": "https://archives.bulbagarden.net/media/upload/thumb/4/47/Sword_EN_boxart.png/640px-Sword_EN_boxart.png",
              "Zelda: Breath of the Wild": "https://images-na.ssl-images-amazon.com/images/I/91DgUPPHMGL._SL1500_.jpg",
              "Zelda: Tears of the Kingdom": "https://static.wikia.nocookie.net/nintendo/images/2/2a/The_Legend_of_Zelda_Tears_of_the_Kingdom_box_art_South_Korea.png/revision/latest/scale-to-width-down/250?cb=20240130073833&path-prefix=en",
              "Zelda: Echoes of Widsom": "https://static.honestgamers.com/images/games/19/84/17/17189/5.jpg",
              "Cuphead": "https://shared.fastly.steamstatic.com/store_item_assets/steam/apps/268910/library_600x900.jpg",
              "Cyberpunk 2077": "https://shared.fastly.steamstatic.com/store_item_assets/steam/apps/1091500/library_600x900.jpg",
              "Donut County": "https://shared.fastly.steamstatic.com/store_item_assets/steam/apps/702670/library_600x900.jpg",
              "Elden Ring": "https://shared.fastly.steamstatic.com/store_item_assets/steam/apps/1245620/library_600x900.jpg",
              "FIFA 18": "https://static.wikia.nocookie.net/nintendo/images/f/fb/FIFA_18_%28NA_-_Final%29.png/revision/latest?cb=20170914032140&path-prefix=en",
              "Gris": "https://shared.fastly.steamstatic.com/store_item_assets/steam/apps/683320/library_600x900.jpg",
              "GTA V": "https://shared.fastly.steamstatic.com/store_item_assets/steam/apps/271590/library_600x900.jpg",
              "Hades 2": "https://shared.fastly.steamstatic.com/store_item_assets/steam/apps/1145350/library_600x900.jpg",
              "Hollow Knight Silksong": "https://shared.fastly.steamstatic.com/store_item_assets/steam/apps/1030300/library_600x900.jpg",
              "Monster Boy and the Cursed Kingdom": "https://shared.fastly.steamstatic.com/store_item_assets/steam/apps/449610/library_600x900.jpg",
              "Need for Speed Rivals": "https://shared.fastly.steamstatic.com/store_item_assets/steam/apps/1262600/library_600x900.jpg",
              "Skyrim": "https://shared.fastly.steamstatic.com/store_item_assets/steam/apps/489830/library_600x900.jpg",
              "Slay the Spire": "https://shared.fastly.steamstatic.com/store_item_assets/steam/apps/646570/library_600x900.jpg",
              "Tennis in the Face": "https://prod-images.blacknut.net/65fae0a22227219ef319e43d_sm.jpg",
              "Tomb Raider": "https://shared.fastly.steamstatic.com/store_item_assets/steam/apps/203160/library_600x900.jpg",
              "Traveller’s Rest": "https://shared.fastly.steamstatic.com/store_item_assets/steam/apps/1139980/library_600x900.jpg",
              "The Witcher 3": "https://shared.fastly.steamstatic.com/store_item_assets/steam/apps/292030/library_600x900.jpg",
              "Megabonk": "https://gfn.ru/media/images/box_art_image-megabonk-b6f8044a.original.jpg",
            };

            let boxArtUrl = GAME_COVERS[gameName];
            if (!boxArtUrl) {
                const suffix = " Box Art";
                boxArtUrl = `https://tse2.mm.bing.net/th?q=${encodeURIComponent(gameName + suffix)}&w=300&h=450&c=7&rs=1&p=0`;
            }

            const initials = gameName.split(' ').map(n=>n[0]).join('').substring(0,2).toUpperCase();
            const fallbackArt = `https://placehold.co/300x450/211136/FFF?text=${initials}`;

            let resultsHtml = '';
            for(let i=1; i<=DEVICE_COUNT; i++) {
                if(!columnVisibility[i]) continue;
                const cell = row.children[i];
                if(!cell) continue;

                let val = cell.innerText.trim();
                if(cell.dataset.original) val = cell.dataset.original;

                const deviceName = deviceNames[i];
                const colorClass = deviceColors[i];

                resultsHtml += `
                    <div class="flex justify-between items-center p-3 bg-brand-bg/50 rounded-lg border border-white/5">
                        <span class="font-bold text-sm ${colorClass}">${deviceName}</span>
                        <span class="font-mono font-bold text-white text-lg">${val} <span class="text-xs text-brand-muted font-normal font-sans">FPS</span></span>
                    </div>
                `;
            }

            modalContent.innerHTML = `
                <div class="flex flex-col md:flex-row gap-6">
                    <div class="w-full md:w-1/3">
                        <div class="rounded-xl overflow-hidden shadow-2xl border border-white/10 aspect-[2/3] bg-black/50 relative group">
                            <img src="${boxArtUrl}" crossorigin="anonymous" class="w-full h-full object-cover" onerror="this.src='${fallbackArt}'">
                        </div>
                    </div>
                    <div class="w-full md:w-2/3 flex flex-col">
                        <h2 class="font-extrabold text-3xl text-white mb-1 leading-tight">${gameName}</h2>
                        <span class="text-brand-muted text-xs font-bold uppercase tracking-widest mb-6">Benchmark Results</span>

                        <div class="grid grid-cols-1 gap-2 overflow-y-auto max-h-[400px] pr-2 custom-scrollbar">
                            ${resultsHtml}
                        </div>
                    </div>
                </div>
            `;

            modal.classList.remove('hidden');
            lucide.createIcons();
        }

        const closeModal = () => modal.classList.add('hidden');
        closeBtn.addEventListener('click', closeModal);
        bg.addEventListener('click', closeModal);

        // Screenshot Feature
        document.getElementById('screenshot-game-modal').addEventListener('click', function() {
            const btn = this;
            const originalIcon = btn.innerHTML;
            btn.innerHTML = `<i data-lucide="loader" class="w-5 h-5 animate-spin"></i>`;
            lucide.createIcons();

            const captureContainer = document.createElement('div');
            Object.assign(captureContainer.style, {
                position: 'fixed', top: '-9999px', left: '-9999px', width: '800px',
                backgroundColor: '#2D1B4E', padding: '40px', borderRadius: '20px', zIndex: '-1'
            });

            const content = document.getElementById('game-modal-content').innerHTML;
            captureContainer.innerHTML = `
                <div class="relative bg-[#432C7A] border-2 border-white/20 rounded-3xl p-8 shadow-2xl flex flex-col text-white font-sans">
                    ${content}
                    <div class="mt-8 pt-4 border-t border-white/10 flex justify-between items-center">
                        <div class="flex items-center gap-2">
                            <span class="font-bold text-xl tracking-tight">Ryan Retro</span>
                        </div>
                        <span class="font-mono text-white/50 text-xs">ryanretro.com</span>
                    </div>
                </div>
            `;
            document.body.appendChild(captureContainer);

            html2canvas(captureContainer, {
                backgroundColor: '#2D1B4E', scale: 2, useCORS: true, allowTaint: true, logging: false, width: 800, windowWidth: 800
            }).then(canvas => {
                document.body.removeChild(captureContainer);
                const link = document.createElement('a');
                link.download = 'RyanRetro-Benchmark.png';
                link.href = canvas.toDataURL('image/png');
                link.click();
                btn.innerHTML = originalIcon;
                lucide.createIcons();
            }).catch(err => {
                console.error("Capture failed:", err);
                document.body.removeChild(captureContainer);
                btn.innerHTML = originalIcon;
                lucide.createIcons();
                alert("Capture failed. Try again.");
            });
        });

        // Init visibility & listeners
        attachRowListeners();
        updateTableVisibility();
        updateColumnVisibility();

    </script>
</body>
</html>
