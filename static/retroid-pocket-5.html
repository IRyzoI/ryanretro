<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale-1.0">
    <title>Retroid Pocket 5 Compatibility | Ryan Retro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Roboto:wght@400;700&display=swap');
        .retro-font { font-family: 'Press Start 2P', cursive; }
        .pixel-border { border: 4px solid #000; box-shadow: 8px 8px 0 rgba(0,0,0,0.2); }
        .perf-perfect { color: #4ade80; } .perf-great { color: #38bdf8; } .perf-good { color: #facc15; }
        .perf-playable { color: #fb923c; } .perf-unplayable { color: #f87171; }
        .form-input {
            background-color: #374151; border: 2px solid #1f2937;
            border-radius: 0.25rem; padding: 0.5rem 0.75rem;
            color: #d1d5db; width: 100%; transition: border-color 0.2s;
        }
        .form-input:focus { outline: none; border-color: #facc15; }
    </style>
</head>

<body class="bg-gray-900 text-white">
    <header class="bg-black py-6">
        <div class="container mx-auto px-4">
            <a href="index.html" class="flex items-center">
                <img src="https://huggingface.co/spaces/IRyzoI/RyanRetro/resolve/main/images/ryan%20retro%20logo.png" alt="Ryan Retro Logo" class="w-12 h-12 rounded-full mr-4">
                <span class="retro-font text-yellow-400 text-xl">RYAN RETRO</span>
            </a>
        </div>
    </header>

    <main class="py-12">
        <div class="container mx-auto px-4">
            <div class="max-w-full mx-auto">
                <div class="flex items-center mb-8">
                    <span class="bg-red-500 text-black text-xs px-2 py-1 rounded retro-font mr-4">HANDHELD</span>
                    <h1 class="retro-font text-3xl md:text-4xl">Retroid Pocket 5</h1>
                </div>

<div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-12">
    <div class="md:col-span-2" data-aos="fade-right">
        <div class="bg-gray-800 rounded-lg overflow-hidden pixel-border h-full flex items-center justify-center p-4">
            <img src="https://huggingface.co/spaces/IRyzoI/RyanRetro/resolve/main/images/rp5.png" alt="Retroid Pocket 5" class="w-full h-auto object-contain">
        </div>
    </div>

    <div class="md:col-span-1 bg-gray-800 p-8 rounded-lg pixel-border flex flex-col justify-center" data-aos="fade-left">
        <h2 class="retro-font text-xl mb-4 text-center">Device Overview</h2>
        <div class="flex flex-col gap-4">
            <a href="YOUR_AFFILIATE_LINK_HERE" target="_blank" class="bg-green-600 hover:bg-green-700 text-white px-4 py-3 rounded pixel-btn retro-font text-xs flex items-center justify-center">
                <i data-feather="shopping-cart" class="mr-2 w-4 h-4"></i> PURCHASE
            </a>
            <a href="#videos-section" class="bg-red-600 hover:bg-red-700 text-white px-4 py-3 rounded pixel-btn retro-font text-xs flex items-center justify-center">
                <i data-feather="youtube" class="mr-2 w-4 h-4"></i> VIDEOS
            </a>
            <a href="#compatibility" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-3 rounded pixel-btn retro-font text-xs flex items-center justify-center">
               <i data-feather="list" class="mr-2 w-4 h-4"></i> PLAY GAMES
            </a>
        </div>
    </div>
</div>

<section id="videos-section"></section>

                <!-- Added id for jump link; content unchanged -->
                <div id="compatibility" class="bg-gray-800 p-8 rounded-lg pixel-border mb-12">
                    <h2 class="retro-font text-2xl mb-6">Game Compatibility</h2>

                    <div id="filter-container" class="mb-4 flex flex-wrap gap-2">
                        <button data-filter="all" class="filter-btn bg-yellow-400 text-black px-4 py-2 rounded-md retro-font text-xs">All Systems</button>
                        <button data-filter="switch" class="filter-btn bg-gray-600 hover:bg-gray-500 text-white px-4 py-2 rounded-md retro-font text-xs">Switch</button>
                        <button data-filter="ps2" class="filter-btn bg-gray-600 hover:bg-gray-500 text-white px-4 py-2 rounded-md retro-font text-xs">PS2</button>
                        <button data-filter="windows" class="filter-btn bg-gray-600 hover:bg-gray-500 text-white px-4 py-2 rounded-md retro-font text-xs">Windows</button>
                        <button data-filter="gamecube" class="filter-btn bg-gray-600 hover:bg-gray-500 text-white px-4 py-2 rounded-md retro-font text-xs">GameCube</button>
                    </div>

                    <div class="mb-6">
                        <input type="text" id="game-search-box" class="form-input" placeholder="Search for a game...">
                    </div>

                    <div class="overflow-x-auto">
                        <table id="compatibility-table" class="min-w-full text-sm text-left text-gray-300">
                            <thead class="bg-gray-700 text-gray-100 retro-font text-xs uppercase tracking-wider cursor-pointer">
                                <tr>
                                    <th class="p-3" data-sort="game">Game <span class="sort-indicator"></span></th>
                                    <th class="p-3" data-sort="system">System <span class="sort-indicator"></span></th>
                                    <th class="p-3" data-sort="performance">Performance <span class="sort-indicator"></span></th>
                                    <th class="p-3" data-sort="emulator">Emulator <span class="sort-indicator"></span></th>
                                    <th class="p-3 min-w-[300px]" data-sort="notes">Notes <span class="sort-indicator"></span></th>
                                    <th class="p-3" data-sort="date added">Date <span class="sort-indicator"></span></th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-700 align-baseline">
                            </tbody>
                        </table>
                    </div>
                </div>

                <div id="pagination-controls" class="mt-6 flex items-center justify-center gap-4">
                    <button id="prev-btn" class="bg-gray-600 hover:bg-gray-500 text-white px-4 py-2 rounded-md retro-font text-xs disabled:opacity-50" disabled>Previous</button>
                    <span id="page-info" class="retro-font text-sm text-yellow-400">Page 1 of 1</span>
                    <button id="next-btn" class="bg-gray-600 hover:bg-gray-500 text-white px-4 py-2 rounded-md retro-font text-xs disabled:opacity-50" disabled>Next</button>
                </div>

                <div class="text-center mt-6">
                    <div class="text-center mt-6">
                        <button id="add-entry-btn" class="bg-yellow-400 hover:bg-yellow-500 text-black px-6 py-3 rounded retro-font">ADD YOUR ENTRY</button>
                    </div>
                </div>

                <div id="add-entry-form-container" class="bg-gray-800 p-8 rounded-lg pixel-border mb-12 hidden" data-aos="fade-up">
                    <h2 class="retro-font text-2xl mb-6 text-yellow-400">Add New Compatibility Entry</h2>
                    <form id="compatibility-form">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                            <div>
                                <label for="system" class="block mb-2 font-bold">System</label>
                                <select id="system" class="form-input" required>
                                    <option value="switch">Nintendo Switch</option>
                                    <option value="ps2">PlayStation 2</option>
                                    <option value="windows">Windows</option>
                                    <option value="gamecube">GameCube</option>
                                </select>
                            </div>
                            <div>
                                <label for="device" class="block mb-2 font-bold">Handheld Device</label>
                                <select id="device" class="form-input" required>
                                    <option selected>Retroid Pocket 5</option>
                                    <option>Ayn Odin 2</option>
                                </select>
                            </div>
                            <div>
                                <label for="game" class="block mb-2 font-bold">Game Name</label>
                                <input type="text" id="game" class="form-input" required list="game-suggestions">
                                <datalist id="game-suggestions"></datalist>
                            </div>
                            <div>
                                <label for="performance" class="block mb-2 font-bold">Performance</label>
                                <select id="performance" class="form-input" required>
                                    <option>Perfect</option>
                                    <option>Great</option>
                                    <option>Good</option>
                                    <option>Playable</option>
                                    <option>Unplayable</option>
                                </select>
                            </div>
                            <div>
                                <label for="emulator" class="block mb-2 font-bold">Emulator</label>
                                <input type="text" id="emulator" class="form-input" list="emulator-suggestions">
                                <datalist id="emulator-suggestions"></datalist>
                            </div>
                            <div>
                                <label for="driver" class="block mb-2 font-bold">Driver</label>
                                <input type="text" id="driver" class="form-input" list="driver-suggestions">
                                <datalist id="driver-suggestions"></datalist>
                            </div>
                        </div>
                        <div class="mb-6">
                            <label for="notes" class="block mb-2 font-bold">Notes</label>
                            <textarea id="notes" rows="3" class="form-input"></textarea>
                        </div>
                        <div class="flex items-center justify-end gap-4">
                            <button type="button" id="cancel-btn" class="bg-gray-600 hover:bg-gray-500 text-white px-6 py-3 rounded retro-font">CANCEL</button>
                            <button type="submit" class="bg-green-500 hover:bg-green-600 text-black px-6 py-3 rounded retro-font">SUBMIT</button>
                        </div>
                    </form>
                </div>

            </div>
        </div>
    </main>

    <footer class="bg-black py-8">
        <div class="container mx-auto px-4 text-center text-gray-500 text-sm">
            <p>© 2025 Ryan Retro. All rights reserved.</p>
        </div>
    </footer>

<script>
    AOS.init();
    feather.replace();

    document.addEventListener('DOMContentLoaded', function () {
        // --- PAGE CONFIGURATION ---
        const CURRENT_DEVICE = "Retroid Pocket 5";
        const SYSTEMS_TO_FETCH = ["switch", "ps2", "windows", "gamecube"];
        const rowsPerPage = 15;

        // --- GLOBAL & STATE VARIABLES ---
        let deviceSpecificGames = [];
        let currentlyDisplayedGames = [];
        let currentPage = 1;
        let sortColumn = 'game';
        let sortDirection = 'asc';

        // --- ELEMENT SELECTIONS ---
        const tableBody = document.querySelector('#compatibility-table tbody');
        const tableHead = document.querySelector('#compatibility-table thead');
        const searchBox = document.getElementById('game-search-box');
        const filterContainer = document.getElementById('filter-container');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const pageInfo = document.getElementById('page-info');
        const addEntryBtn = document.getElementById('add-entry-btn');
        const formContainer = document.getElementById('add-entry-form-container');
        const cancelBtn = document.getElementById('cancel-btn');
        const compatibilityForm = document.getElementById('compatibility-form');
        const emulatorDatalist = document.getElementById('emulator-suggestions');
        const driverDatalist = document.getElementById('driver-suggestions');

        const performanceClassMap = { 'Perfect': 'perf-perfect', 'Great': 'perf-great', 'Good': 'perf-good', 'Playable': 'perf-playable', 'Unplayable': 'perf-unplayable' };

        function formatSystemName(systemSlug) {
            const nameMap = { 'switch': 'Switch', 'ps2': 'PS2', 'windows': 'Windows', 'gamecube': 'GameCube' };
            return nameMap[systemSlug] || systemSlug;
        }

        // NEW: populate datalists
        function populateDatalists(games) {
            const uniqueGames = [...new Set(games.map(g => g.game).filter(Boolean))];
            const uniqueEmulators = [...new Set(games.map(g => g.emulator).filter(Boolean))];
            const uniqueDrivers = [...new Set(games.map(g => g.driver).filter(Boolean))];

            const gameDatalist = document.getElementById('game-suggestions');
            gameDatalist.innerHTML = '';
            uniqueGames.forEach(name => {
                const option = document.createElement('option');
                option.value = name;
                gameDatalist.appendChild(option);
            });

            const emulatorDatalist = document.getElementById('emulator-suggestions');
            emulatorDatalist.innerHTML = '';
            uniqueEmulators.forEach(name => {
                const option = document.createElement('option');
                option.value = name;
                emulatorDatalist.appendChild(option);
            });

            const driverDatalist = document.getElementById('driver-suggestions');
            driverDatalist.innerHTML = '';
            uniqueDrivers.forEach(name => {
                const option = document.createElement('option');
                option.value = name;
                driverDatalist.appendChild(option);
            });
        }

        async function loadAndPrepareData() {
            tableBody.innerHTML = `<tr><td colspan="6" class="p-4 text-center">Loading...</td></tr>`;
            try {
                const fetchPromises = SYSTEMS_TO_FETCH.map(system => fetch(`/api/compatibility/${system}`).then(res => res.ok ? res.json() : []));
                const results = await Promise.all(fetchPromises);
                const masterGameList = results.flat();
                deviceSpecificGames = masterGameList.filter(game => game && game.device === CURRENT_DEVICE);
                currentlyDisplayedGames = deviceSpecificGames;

                populateDatalists(deviceSpecificGames);

                if (deviceSpecificGames.length === 0) {
                     tableBody.innerHTML = `<tr><td colspan="6" class="p-4 text-center">No reports found for ${CURRENT_DEVICE}.</td></tr>`;
                     updatePaginationControls();
                     return;
                }
                currentPage = 1;
                displayCurrentPage();
            } catch (error) { console.error("Failed to load data:", error); }
        }

        function displayCurrentPage() {
    tableBody.innerHTML = '';

    // A list of all possible "special" columns you might want to add to the notes.
    // You can add or remove any headers from this list in the future!
    const detailHeaders = [
        'driver', 
        'dx wrapper', 
        'game resolution', 
        'gpu driver', 
        'dxvk version', 
        'vkd3d version'
    ];

    // A helper function to make header names look nice (e.g., 'dxvk version' -> 'DXVK Version')
    const formatHeader = (header) => {
        return header.split(' ').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ');
    };
    
    currentlyDisplayedGames.sort((a, b) => {
        const valA = (a[sortColumn] || '').toLowerCase();
        const valB = (b[sortColumn] || '').toLowerCase();
        if (valA < valB) return sortDirection === 'asc' ? -1 : 1;
        if (valA > valB) return sortDirection === 'asc' ? 1 : -1;
        return 0;
    });

    updateSortIndicators();
    const startIndex = (currentPage - 1) * rowsPerPage;
    const paginatedItems = currentlyDisplayedGames.slice(startIndex, endIndex);

    for (const game of paginatedItems) {
        let detailsHTML = '';
        // Loop through our list of special headers
        detailHeaders.forEach(header => {
            // Check if the game entry has this header and it's not empty or just a hyphen
            if (game[header] && game[header].trim() !== '-' && game[header].trim() !== '') {
                detailsHTML += `<strong class="text-yellow-400">${formatHeader(header)}:</strong> ${game[header]}<br>`;
            }
        });

        // Combine the details with the original notes
        let notesContent = '';
        if (detailsHTML) {
            notesContent += `<div class="mb-2">${detailsHTML}</div>`;
            if (game.notes) {
                 notesContent += `<hr class="border-gray-600 my-2">${game.notes}`;
            }
        } else {
            notesContent = game.notes || '';
        }
        
        const perfClass = performanceClassMap[game.performance] || '';
        const newRow = document.createElement('tr');
        newRow.innerHTML = `
            <td class="p-3 font-bold">${game.game || 'Unknown'}</td>
            <td class="p-3">${formatSystemName(game.system)}</td>
            <td class="p-3 font-bold ${perfClass}">${game.performance || ''}</td>
            <td class="p-3">${game.emulator || ''}</td>
            <td class="p-3 min-w-[250px]">${notesContent}</td>
            <td class="p-3">${game['date added'] || ''}</td>
        `;
        tableBody.appendChild(newRow);
    }
    updatePaginationControls();
}

        function updatePaginationControls() {
            const totalPages = Math.ceil(currentlyDisplayedGames.length / rowsPerPage) || 1;
            pageInfo.textContent = `Page ${currentPage} of ${totalPages}`;
            prevBtn.disabled = currentPage === 1;
            nextBtn.disabled = currentPage === totalPages;
        }

        function updateSortIndicators() {
            tableHead.querySelectorAll('th').forEach(th => {
                const indicator = th.querySelector('.sort-indicator');
                if (th.dataset.sort === sortColumn) {
                    indicator.textContent = sortDirection === 'asc' ? ' ▲' : ' ▼';
                } else {
                    indicator.textContent = '';
                }
            });
        }

        tableHead.addEventListener('click', (event) => {
            const th = event.target.closest('th');
            if (!th) return;
            const newSortColumn = th.dataset.sort;
            if (!newSortColumn) return;
            if (sortColumn === newSortColumn) {
                sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                sortColumn = newSortColumn;
                sortDirection = 'asc';
            }
            currentPage = 1;
            displayCurrentPage();
        });

        function applyFilters() {
            const activeFilter = filterContainer.querySelector('.bg-yellow-400').dataset.filter;
            const searchTerm = searchBox.value.toLowerCase();
            let filteredGames = deviceSpecificGames;
            if (activeFilter !== 'all') {
                filteredGames = filteredGames.filter(game => game.system && game.system.toLowerCase() === activeFilter);
            }
            if (searchTerm) {
                filteredGames = filteredGames.filter(game => game.game && game.game.toLowerCase().includes(searchTerm));
            }
            currentlyDisplayedGames = filteredGames;
            currentPage = 1;
            displayCurrentPage();
        }
        filterContainer.addEventListener('click', (event) => {
            if (event.target.tagName !== 'BUTTON') return;
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.replace('bg-yellow-400','bg-gray-600'));
            event.target.classList.replace('bg-gray-600', 'bg-yellow-400');
            applyFilters();
        });
        searchBox.addEventListener('input', applyFilters);

        prevBtn.addEventListener('click', () => { if (currentPage > 1) { currentPage--; displayCurrentPage(); } });
        nextBtn.addEventListener('click', () => { if (currentPage < Math.ceil(currentlyDisplayedGames.length / rowsPerPage)) { currentPage++; displayCurrentPage(); } });

        addEntryBtn.addEventListener('click', () => {
            formContainer.classList.remove('hidden');
            formContainer.scrollIntoView({ behavior: 'smooth', block: 'center' });
        });

        cancelBtn.addEventListener('click', () => {
            formContainer.classList.add('hidden');
        });

        compatibilityForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const system = document.getElementById('system').value;
            const newEntry = {
                device: document.getElementById('device').value,
                game: document.getElementById('game').value,
                performance: document.getElementById('performance').value,
                driver: document.getElementById('driver').value,
                emulator: document.getElementById('emulator').value,
                notes: document.getElementById('notes').value,
                update_version: "1.0"
            };
            try {
                await fetch(`/api/compatibility/${system}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(newEntry)
                });
                formContainer.classList.add('hidden');
                compatibilityForm.reset();
                await loadAndPrepareData();
            } catch (error) {
                console.error("Failed to submit entry:", error);
                alert("There was an error submitting your entry.");
            }
        });

        loadAndPrepareData();
    });
</script>
</body>
</html>
