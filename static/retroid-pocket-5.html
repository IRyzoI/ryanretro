<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale-1.0">
    <title>Retroid Pocket 5 Compatibility | Ryan Retro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Roboto:wght@400;700&display=swap');
        .retro-font { font-family: 'Press Start 2P', cursive; }
        .pixel-border { border: 4px solid #000; box-shadow: 8px 8px 0 rgba(0,0,0,0.2); }
        .perf-perfect { color: #4ade80; } .perf-great { color: #38bdf8; } .perf-good { color: #facc15; }
        .perf-playable { color: #fb923c; } .perf-unplayable { color: #f87171; }
        .form-input {
            background-color: #374151; border: 2px solid #1f2937;
            border-radius: 0.25rem; padding: 0.5rem 0.75rem;
            color: #d1d5db; width: 100%; transition: border-color 0.2s;
        }
        .form-input:focus { outline: none; border-color: #facc15; }
    </style>
</head>
<body class="bg-gray-900 text-white">
    <header class="bg-black py-6">
        <div class="container mx-auto px-4">
            <a href="index.html" class="flex items-center">
                <img src="https://huggingface.co/spaces/IRyzoI/RyanRetro/resolve/main/images/ryan%20retro%20logo.png" alt="Ryan Retro Logo" class="w-12 h-12 rounded-full mr-4">
                <span class="retro-font text-yellow-400 text-xl">RYAN RETRO</span>
            </a>
        </div>
    </header>

    <main class="py-12">
        <div class="container mx-auto px-4">
            <div class="max-w-full mx-auto">
                <div class="flex items-center mb-8">
                    <span class="bg-red-500 text-black text-xs px-2 py-1 rounded retro-font mr-4">HANDHELD</span>
                    <h1 class="retro-font text-3xl md:text-4xl">Retroid Pocket 5</h1>
                </div>
                <div class="bg-gray-800 rounded-lg overflow-hidden pixel-border mb-12">
                    <img src="https://huggingface.co/spaces/IRyzoI/RyanRetro/resolve/main/images/rp5.png" alt="Retroid Pocket 5" class="w-full h-full object-cover">
                </div>

                <div class="bg-gray-800 p-8 rounded-lg pixel-border mb-12">
                    <h2 class="retro-font text-2xl mb-6">Game Compatibility</h2>

                    <div id="filter-container" class="mb-4 flex flex-wrap gap-2">
                        <button data-filter="all" class="filter-btn bg-yellow-400 text-black px-4 py-2 rounded-md retro-font text-xs">All Systems</button>
                        <button data-filter="switch" class="filter-btn bg-gray-600 hover:bg-gray-500 text-white px-4 py-2 rounded-md retro-font text-xs">Switch</button>
                        <button data-filter="ps2" class="filter-btn bg-gray-600 hover:bg-gray-500 text-white px-4 py-2 rounded-md retro-font text-xs">PS2</button>
                        <button data-filter="windows" class="filter-btn bg-gray-600 hover:bg-gray-500 text-white px-4 py-2 rounded-md retro-font text-xs">Windows</button>
                        <button data-filter="gamecube" class="filter-btn bg-gray-600 hover:bg-gray-500 text-white px-4 py-2 rounded-md retro-font text-xs">GameCube</button>
                    </div>

                    <div class="mb-6">
                        <input type="text" id="game-search-box" class="form-input" placeholder="Search for a game...">
                    </div>

                    <div class="overflow-x-auto">
                        <table id="compatibility-table" class="min-w-full text-sm text-left text-gray-300">
<thead class="bg-gray-700 text-gray-100 retro-font text-xs uppercase tracking-wider cursor-pointer">
    <tr>
        <th class="p-3" data-sort="game">Game <span class="sort-indicator"></span></th>
        <th class="p-3" data-sort="system">System <span class="sort-indicator"></span></th>
        <th class="p-3" data-sort="performance">Performance <span class="sort-indicator"></span></th>
<th class="p-3" data-sort="emulator">Emulator <span class="sort-indicator"></span></th>
<th class="p-3" data-sort="driver">Driver <span class="sort-indicator"></span></th>
        <th class="p-3 min-w-[250px]" data-sort="notes">Notes <span class="sort-indicator"></span></th>
        <th class="p-3" data-sort="date added">Date <span class="sort-indicator"></span></th>
    </tr>
</thead>
                            <tbody class="divide-y divide-gray-700 align-baseline">
                                </tbody>
                        </table>
                    </div>
                  </div> <div id="pagination-controls" class="mt-6 flex items-center justify-center gap-4">
                        <button id="prev-btn" class="bg-gray-600 hover:bg-gray-500 text-white px-4 py-2 rounded-md retro-font text-xs disabled:opacity-50" disabled>Previous</button>
                        <span id="page-info" class="retro-font text-sm text-yellow-400">Page 1 of 1</span>
                        <button id="next-btn" class="bg-gray-600 hover:bg-gray-500 text-white px-4 py-2 rounded-md retro-font text-xs disabled:opacity-50" disabled>Next</button>
                    </div>

                    <div class="text-center mt-6">
                    <div class="text-center mt-6">
                        <button id="add-entry-btn" class="bg-yellow-400 hover:bg-yellow-500 text-black px-6 py-3 rounded retro-font">ADD YOUR ENTRY</button>
                    </div>
                </div>

                <div id="add-entry-form-container" class="bg-gray-800 p-8 rounded-lg pixel-border mb-12 hidden" data-aos="fade-up">
                    <h2 class="retro-font text-2xl mb-6 text-yellow-400">Add New Compatibility Entry</h2>
                    <form id="compatibility-form">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                            <div>
                                <label for="system" class="block mb-2 font-bold">System</label>
                                <select id="system" class="form-input" required>
                                    <option value="switch">Nintendo Switch</option>
                                    <option value="ps2">PlayStation 2</option>
                                    <option value="windows">Windows</option>
                                    <option value="gamecube">GameCube</option>
                                </select>
                            </div>
                            <div>
                                <label for="device" class="block mb-2 font-bold">Handheld Device</label>
                                <select id="device" class="form-input" required>
                                    <option selected>Retroid Pocket 5</option>
                                    <option>Ayn Odin 2</option>
                                </select>
                            </div>
<div>
    <label for="game" class="block mb-2 font-bold">Game Name</label>
    <input type="text" id="game" class="form-input" required list="game-suggestions">
    <datalist id="game-suggestions"></datalist>
</div>
                            <div>
                                <label for="performance" class="block mb-2 font-bold">Performance</label>
                                <select id="performance" class="form-input" required>
                                    <option>Perfect</option>
                                    <option>Great</option>
                                    <option>Good</option>
                                    <option>Playable</option>
                                    <option>Unplayable</option>
                                </select>
                            </div>
<div>
    <label for="emulator" class="block mb-2 font-bold">Emulator</label>
    <input type="text" id="emulator" class="form-input" list="emulator-suggestions">
    <datalist id="emulator-suggestions"></datalist>
</div>
<div>
    <label for="driver" class="block mb-2 font-bold">Driver</label>
    <input type="text" id="driver" class="form-input" list="driver-suggestions">
    <datalist id="driver-suggestions"></datalist>
</div>
                        </div>
                        <div class="mb-6">
                            <label for="notes" class="block mb-2 font-bold">Notes</label>
                            <textarea id="notes" rows="3" class="form-input"></textarea>
                        </div>
                        <div class="flex items-center justify-end gap-4">
                            <button type="button" id="cancel-btn" class="bg-gray-600 hover:bg-gray-500 text-white px-6 py-3 rounded retro-font">CANCEL</button>
                            <button type="submit" class="bg-green-500 hover:bg-green-600 text-black px-6 py-3 rounded retro-font">SUBMIT</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </main>

    <footer class="bg-black py-8">
        <div class="container mx-auto px-4 text-center text-gray-500 text-sm">
            <p>Â© 2025 Ryan Retro. All rights reserved.</p>
        </div>
    </footer>

  <div id="details-modal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50">
    <div id="modal-content" class="bg-gray-800 p-8 rounded-lg pixel-border w-full max-w-md text-white" data-aos="fade-up">
        <h2 id="modal-game-name" class="retro-font text-2xl text-yellow-400 mb-6"></h2>

        <div id="modal-details" class="space-y-3 text-gray-300">
            </div>

        <button id="modal-close-btn" class="mt-8 w-full bg-red-600 hover:bg-red-700 text-white px-6 py-3 rounded pixel-btn retro-font text-sm">
            CLOSE
        </button>
    </div>
</div>

<script>
    AOS.init({ once: true });
    feather.replace();

    document.addEventListener('DOMContentLoaded', function () {
        const CURRENT_DEVICE = "Retroid Pocket 5";
        const SYSTEMS_TO_FETCH = ["switch", "ps2", "windows", "gamecube"];
        const rowsPerPage = 15;
        let deviceSpecificGames = [], currentlyDisplayedGames = [], currentPage = 1, sortColumn = 'game', sortDirection = 'asc';

        // --- ELEMENT SELECTIONS (with new modal elements) ---
        const tableBody = document.querySelector('#compatibility-table tbody');
        const tableHead = document.querySelector('#compatibility-table thead');
        const detailsModal = document.getElementById('details-modal');
        const modalContent = document.getElementById('modal-content');
        const modalGameName = document.getElementById('modal-game-name');
        const modalDetails = document.getElementById('modal-details');
        const modalCloseBtn = document.getElementById('modal-close-btn');
        // (Other elements as before)
        const searchBox = document.getElementById('game-search-box'), filterContainer = document.getElementById('filter-container'),
              prevBtn = document.getElementById('prev-btn'), nextBtn = document.getElementById('next-btn'),
              pageInfo = document.getElementById('page-info'), addEntryBtn = document.getElementById('add-entry-btn');

        const performanceClassMap = { 'Perfect': 'perf-perfect', 'Great': 'perf-great', 'Good': 'perf-good', 'Playable': 'perf-playable', 'Unplayable': 'perf-unplayable' };

        function formatSystemName(systemSlug) {
            const nameMap = { 'switch': 'Switch', 'ps2': 'PS2', 'windows': 'Windows', 'gamecube': 'GameCube' };
            return nameMap[systemSlug] || systemSlug;
        }
        
        async function loadAndPrepareData() {
            // This function remains the same
            tableBody.innerHTML = `<tr><td colspan="6" class="p-4 text-center">Loading...</td></tr>`;
            try {
                const fetchPromises = SYSTEMS_TO_FETCH.map(system => fetch(`/api/compatibility/${system}`).then(res => res.ok ? res.json() : []));
                const results = await Promise.all(fetchPromises);
                const masterGameList = results.flat();
                deviceSpecificGames = masterGameList.filter(game => game && game.device && game.device.trim() === CURRENT_DEVICE);
                currentlyDisplayedGames = deviceSpecificGames;
                if (deviceSpecificGames.length === 0) {
                    tableBody.innerHTML = `<tr><td colspan="6" class="p-4 text-center">No reports found.</td></tr>`;
                    updatePaginationControls(); return;
                }
                currentPage = 1;
                displayCurrentPage();
            } catch (error) { console.error("Failed to load data:", error); }
        }

        function displayCurrentPage() {
            tableBody.innerHTML = '';
            currentlyDisplayedGames.sort((a, b) => (a[sortColumn] || '').toLowerCase().localeCompare((b[sortColumn] || '').toLowerCase()) * (sortDirection === 'asc' ? 1 : -1));
            updateSortIndicators();
            const startIndex = (currentPage - 1) * rowsPerPage;
            const paginatedItems = currentlyDisplayedGames.slice(startIndex, endIndex);

            for (const game of paginatedItems) {
                const perfClass = performanceClassMap[game.performance] || '';
                const newRow = document.createElement('tr');
                newRow.className = 'hover:bg-gray-700/50 cursor-pointer'; // Add cursor-pointer

                // --- MODIFIED: Store the game's data directly on the row ---
                newRow.dataset.gameDetails = JSON.stringify(game);

                newRow.innerHTML = `
                    <td class="p-3 font-bold">${game.game || 'Unknown'}</td>
                    <td class="p-3">${formatSystemName(game.system)}</td>
                    <td class="p-3 font-bold ${perfClass}">${game.performance || ''}</td>
                    <td class="p-3">${game.emulator || ''}</td>
                    <td class="p-3 min-w-[250px]">${game.notes || ''}</td>
                    <td class="p-3">${game['date added'] || ''}</td>
                `;
                tableBody.appendChild(newRow);
            }
            updatePaginationControls();
        }

        // --- NEW: Event listener to open the modal when a row is clicked ---
        tableBody.addEventListener('click', (event) => {
            const row = event.target.closest('tr');
            if (!row || !row.dataset.gameDetails) return;

            const gameData = JSON.parse(row.dataset.gameDetails);
            const perfClass = performanceClassMap[gameData.performance] || '';
            
            modalGameName.textContent = gameData.game;
            modalDetails.innerHTML = `
                <p><strong>System:</strong> ${formatSystemName(gameData.system)}</p>
                <p><strong>Performance:</strong> <span class="${perfClass}">${gameData.performance}</span></p>
                <p><strong>Emulator:</strong> ${gameData.emulator || 'N/A'}</p>
                <p><strong>Driver:</strong> ${gameData.driver || 'N/A'}</p>
                <p><strong>Date Added:</strong> ${gameData['date added'] || 'N/A'}</p>
                <p class="mt-4"><strong>Notes:</strong><br>${gameData.notes || 'No notes available.'}</p>
            `;

            detailsModal.classList.remove('hidden');
        });

        // --- NEW: Functions to close the modal ---
        function closeModal() {
            detailsModal.classList.add('hidden');
        }
        modalCloseBtn.addEventListener('click', closeModal);
        detailsModal.addEventListener('click', (event) => {
            // Close if the click is on the dark background, not the content box
            if (event.target === detailsModal) {
                closeModal();
            }
        });
        
        // (All other functions and event listeners for sorting, filtering, etc., remain here)
        function updatePaginationControls() { /* ... */ }
        function updateSortIndicators() { /* ... */ }
        tableHead.addEventListener('click', (event) => { /* ... */ });
        // ...and so on.

        // --- INITIALIZE EVERYTHING ---
        loadAndPrepareData();
        // Add other initializations if you have them (like for the form)
    });
</script>
</body>
</html>