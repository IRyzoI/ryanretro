<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Title and Thumbnail Grabber</title>
    <style>
        :root {
            --bg-color: #f4f4f9;
            --container-bg: #ffffff;
            --text-color: #333333;
            --title-color: #111111;
            --input-border: #dddddd;
            --input-bg: #ffffff;
            --accent-color: #ff0000;
            --accent-hover: #cc0000;
            --btn-text: #ffffff;
            --shadow: rgba(0,0,0,0.1);
        }

        [data-theme="dark"] {
            --bg-color: #121212;
            --container-bg: #1e1e1e;
            --text-color: #e0e0e0;
            --title-color: #ffffff;
            --input-border: #333333;
            --input-bg: #2d2d2d;
            --accent-color: #ff0000;
            --accent-hover: #cc0000;
            --shadow: rgba(0,0,0,0.5);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
            transition: background-color 0.3s, color 0.3s;
        }

        .container {
            background: var(--container-bg);
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 20px var(--shadow);
            width: 100%;
            max-width: 600px;
            text-align: center;
            position: relative;
            transition: background-color 0.3s, box-shadow 0.3s;
        }

        /* Minimal Theme Toggle */
        .theme-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            cursor: pointer;
            padding: 8px;
            color: var(--text-color);
            transition: color 0.3s, transform 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }
        
        .theme-toggle:hover {
            background-color: rgba(128,128,128, 0.1);
            transform: scale(1.1);
        }

        .theme-toggle svg {
            width: 20px;
            height: 20px;
            fill: none;
            stroke: currentColor;
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
        }

        h1 { 
            margin-bottom: 1.5rem; 
            color: var(--title-color); 
            margin-top: 0;
            font-size: 1.8rem;
        }

        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            flex-direction: column;
        }
        
        @media (min-width: 480px) {
            .input-group {
                flex-direction: row;
            }
        }

        input {
            flex: 1;
            padding: 12px;
            border: 2px solid var(--input-border);
            background-color: var(--input-bg);
            color: var(--text-color);
            border-radius: 8px;
            font-size: 16px;
            outline: none;
            transition: border-color 0.3s, background-color 0.3s;
        }

        input:focus { border-color: var(--accent-color); }

        .btn-primary {
            padding: 12px 24px;
            background-color: var(--accent-color);
            color: var(--btn-text);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: 16px;
            transition: background 0.3s;
        }

        .btn-primary:hover { background-color: var(--accent-hover); }

        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn-secondary {
            padding: 10px 20px;
            background-color: #3b82f6; /* Blue */
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            font-size: 14px;
            transition: opacity 0.2s;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }
        
        .btn-secondary:hover { opacity: 0.9; }

        .btn-dark-secondary {
            background-color: #4b5563; /* Gray */
        }

        /* Error Message */
        .error-message {
            color: #ef4444;
            background-color: rgba(239, 68, 68, 0.1);
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 15px;
            font-size: 14px;
            display: none;
            border: 1px solid rgba(239, 68, 68, 0.2);
        }

        /* Results Section */
        #result {
            display: none; /* Hidden by default */
            margin-top: 20px;
            text-align: left;
            animation: fadeIn 0.5s;
        }

        .thumb-preview {
            width: 100%;
            border-radius: 8px;
            margin-bottom: 15px;
            box-shadow: 0 2px 10px var(--shadow);
            background-color: #eee;
            /* Force 16:9 Aspect Ratio to crop black bars */
            aspect-ratio: 16 / 9;
            object-fit: cover; 
            object-position: center;
        }

        /* Video Header Layout */
        .video-header {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 8px;
            margin-bottom: 10px;
            text-align: left;
        }

        .video-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--title-color);
            line-height: 1.4;
            margin: 0;
        }

        /* Metadata Badge Row */
        .meta-row {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            align-items: center;
        }
        
        .meta-badge {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-color);
            opacity: 0.8;
            background: var(--input-bg);
            padding: 4px 10px;
            border-radius: 4px;
            border: 1px solid var(--input-border);
            white-space: nowrap;
        }

        .views-badge {
            font-weight: 500;
            opacity: 0.7;
        }
        
        .video-meta {
            font-size: 0.9rem;
            color: var(--text-color);
            opacity: 0.7;
            margin-bottom: 15px;
            margin-top: 5px;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Spinner */
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
            display: none; /* Hidden by default */
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>

<div class="container">
    <button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle Dark Mode" id="themeBtn">
        <!-- Default Icon (Moon) -->
        <svg viewBox="0 0 24 24">
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
        </svg>
    </button>

    <h1>YouTube Title & Thumbnail Grabber</h1>
    
    <div class="input-group">
        <input type="text" id="urlInput" placeholder="Paste YouTube URL here..." onkeypress="handleKeyPress(event)">
        <button class="btn-primary" onclick="grabInfo()">
            <span id="btnText">Grab</span>
            <span id="loadingSpinner" class="spinner"></span>
        </button>
    </div>

    <div id="errorMsg" class="error-message"></div>

    <div id="result">
        <img id="thumbImg" class="thumb-preview" src="" alt="Thumbnail" crossorigin="anonymous">
        
        <div class="video-header">
            <div id="videoTitle" class="video-title"></div>
            <div class="meta-row">
                <div id="authorName" class="meta-badge"></div>
                <div id="viewCount" class="meta-badge views-badge"></div>
            </div>
        </div>

        <div id="videoID" class="video-meta"></div>
        
        <div class="btn-group">
            <button class="btn-secondary" onclick="downloadImageOnly()">
                Download Thumbnail
            </button>
            <button class="btn-secondary btn-dark-secondary" onclick="downloadCombined()">
                Download Title + Thumbnail
            </button>
        </div>
    </div>
</div>

<script>
    // --- State ---
    let currentVideoId = '';
    let currentTitle = '';
    let currentAuthor = '';
    let currentViews = '';
    
    // Icons
    const moonIcon = '<svg viewBox="0 0 24 24"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>';
    const sunIcon = '<svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>';

    // --- Theme Logic ---
    function toggleTheme() {
        const body = document.body;
        const btn = document.getElementById('themeBtn');
        const isDark = body.getAttribute('data-theme') === 'dark';
        
        if (isDark) {
            body.removeAttribute('data-theme');
            btn.innerHTML = moonIcon;
            localStorage.setItem('theme', 'light');
        } else {
            body.setAttribute('data-theme', 'dark');
            btn.innerHTML = sunIcon;
            localStorage.setItem('theme', 'dark');
        }
    }

    // Init Theme
    const storedTheme = localStorage.getItem('theme');
    const systemPrefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;

    if (storedTheme === 'dark' || (!storedTheme && systemPrefersDark)) {
        // Apply dark mode if saved OR if system prefers it and no save exists
        document.body.setAttribute('data-theme', 'dark');
        document.getElementById('themeBtn').innerHTML = sunIcon;
    } else {
        document.getElementById('themeBtn').innerHTML = moonIcon;
    }

    function handleKeyPress(event) {
        if (event.key === 'Enter') {
            grabInfo();
        }
    }

    // --- Helper: Format Views ---
    function formatViews(num) {
        if (!num) return '';
        return parseInt(num).toLocaleString('en-US') + " views";
    }

    // --- Main Logic ---
    async function grabInfo() {
        const urlInput = document.getElementById('urlInput').value;
        const resultDiv = document.getElementById('result');
        const titleEl = document.getElementById('videoTitle');
        const authorNameEl = document.getElementById('authorName');
        const viewCountEl = document.getElementById('viewCount');
        const metaEl = document.getElementById('videoID');
        const imgEl = document.getElementById('thumbImg');
        const errorEl = document.getElementById('errorMsg');
        const btnText = document.getElementById('btnText');
        const spinner = document.getElementById('loadingSpinner');

        // Reset UI
        errorEl.style.display = 'none';
        resultDiv.style.display = 'none';
        viewCountEl.style.display = 'none';
        
        if (!urlInput) {
            showError("Please enter a URL!");
            return;
        }

        // 1. Extract Video ID
        const videoId = extractVideoID(urlInput);
        if (!videoId) {
            showError("Invalid YouTube URL. Please double check the link.");
            return;
        }
        currentVideoId = videoId;

        // Start Loading
        btnText.style.display = 'none';
        spinner.style.display = 'inline-block';

        // 2. Fetch Data (Parallel for speed)
        // NoEmbed for Title/Author, RYD for View Count
        const thumbnailFetch = new Promise((resolve) => {
             // Image logic is synchronous basically
             const url = `https://img.youtube.com/vi/${videoId}/maxresdefault.jpg`;
             resolve(url);
        });

        const metadataFetch = fetch(`https://noembed.com/embed?url=${urlInput}`).then(r => r.json());
        
        // We use the Return YouTube Dislike API to get view counts (public endpoint)
        const statsFetch = fetch(`https://returnyoutubedislikeapi.com/votes?videoId=${videoId}`)
                            .then(r => r.json())
                            .catch(() => null); // Fail silently if this API is down

        try {
            const [data, stats] = await Promise.all([metadataFetch, statsFetch]);

            // Stop Loading
            btnText.style.display = 'inline';
            spinner.style.display = 'none';
            
            if (data.error) {
                 showError("Could not find video details. It might be private or invalid.");
                 return;
            }

            // Store data
            currentTitle = data.title || "Unknown Title";
            currentAuthor = data.author_name || "Unknown";
            
            // Handle Views
            currentViews = "";
            if (stats && stats.viewCount) {
                currentViews = formatViews(stats.viewCount);
                viewCountEl.textContent = currentViews;
                viewCountEl.style.display = 'block';
            }

            const thumbnailUrl = `https://img.youtube.com/vi/${videoId}/maxresdefault.jpg`;

            // Update UI
            titleEl.textContent = currentTitle;
            metaEl.textContent = `ID: ${videoId}`;
            authorNameEl.textContent = currentAuthor;
            
            // Handle Image Fallback
            imgEl.onload = () => {
                // If the natural width is 120 (YouTube's missing image placeholder size), fallback
                if (imgEl.naturalWidth === 120) {
                     imgEl.src = `https://img.youtube.com/vi/${videoId}/hqdefault.jpg`;
                }
            };
            imgEl.onerror = function() {
                // Fallback to HQ which often has black bars, but our CSS will crop it!
                this.src = `https://img.youtube.com/vi/${videoId}/hqdefault.jpg`;
            };
            
            // Set source to trigger load
            imgEl.src = thumbnailUrl;
            
            // Show result
            resultDiv.style.display = "block";

        } catch (error) {
            console.error(error);
            btnText.style.display = 'inline';
            spinner.style.display = 'none';
            showError("Network error fetching data. Please try again.");
        }
    }

    // --- Download Logic ---

    async function downloadImageOnly() {
        if(!currentVideoId) return;
        const imgEl = document.getElementById('thumbImg');
        // We use fetch to get the blob to force download instead of opening in tab
        try {
            const response = await fetch(imgEl.src);
            const blob = await response.blob();
            triggerDownload(blob, `thumbnail_${currentVideoId}.jpg`);
        } catch (e) {
            // Fallback for CORS issues
            window.open(imgEl.src, '_blank');
        }
    }

    async function downloadCombined() {
        if(!currentVideoId || !currentTitle) return;

        const imgEl = document.getElementById('thumbImg');
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        const isDark = document.body.getAttribute('data-theme') === 'dark';

        // Create a new image object to ensure we draw correctly on canvas
        const img = new Image();
        img.crossOrigin = "anonymous"; // Vital for CORS
        img.src = imgEl.src;

        img.onload = () => {
            // FORCE HD RESOLUTION (1280px wide)
            const OUTPUT_WIDTH = 1280; 
            const targetAspect = 16 / 9;
            
            const sourceW = img.naturalWidth;
            const sourceH = img.naturalHeight;
            const sourceAspect = sourceW / sourceH;
            
            let drawX = 0, drawY = 0, drawW = sourceW, drawH = sourceH;

            // Smart Crop: Remove black bars from 4:3 images to fit 16:9
            if (sourceAspect < targetAspect) {
                // Source is taller (e.g. 4:3), crop top/bottom
                drawH = sourceW / targetAspect;
                drawY = (sourceH - drawH) / 2;
            } 
            else if (sourceAspect > targetAspect) {
                // Source is wider, crop sides
                drawW = sourceH * targetAspect;
                drawX = (sourceW - drawW) / 2;
            }

            // Destination Dimensions
            const outW = OUTPUT_WIDTH;
            const outImageH = outW / targetAspect; // 720px
            const textAreaHeight = 150; // Total H = 870px
            
            canvas.width = outW;
            canvas.height = outImageH + textAreaHeight;

            // 1. Draw Background
            ctx.fillStyle = isDark ? "#1e1e1e" : "#ffffff";
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // 2. Draw Thumbnail (Upscaling if source is small)
            ctx.drawImage(img, drawX, drawY, drawW, drawH, 0, 0, outW, outImageH);

            // 3. Draw Text Section
            const padding = 50;
            const textStartX = padding;
            
            // A. Draw Title
            ctx.fillStyle = isDark ? "#ffffff" : "#000000";
            // Title Font
            let titleFontSize = 48;
            ctx.font = `bold ${titleFontSize}px Arial, sans-serif`;
            ctx.textBaseline = "top";
            
            // Calculate Title Y position (approx 30px padding from image bottom)
            let titleY = outImageH + 30;
            
            const maxWidth = outW - (padding * 2);
            
            // Check if title fits, scale down if needed
            let metrics = ctx.measureText(currentTitle);
            if (metrics.width > maxWidth) {
                 titleFontSize = 38;
                 ctx.font = `bold ${titleFontSize}px Arial, sans-serif`;
            }
            
            ctx.fillText(currentTitle, textStartX, titleY, maxWidth);

            // B. Draw Metadata (Channel Name • Views)
            // Metadata Font
            const metaFontSize = 28;
            ctx.font = `500 ${metaFontSize}px Arial, sans-serif`;
            ctx.fillStyle = isDark ? "#b0b0b0" : "#555555"; // Lighter grey for meta
            
            // Metadata Y position (below title)
            let metaY = titleY + titleFontSize + 15;
            
            let metaText = currentAuthor;
            if (currentViews) {
                metaText += ` • ${currentViews}`;
            }
            
            ctx.fillText(metaText, textStartX, metaY, maxWidth);

            // 4. Convert to Blob and Download
            canvas.toBlob((blob) => {
                triggerDownload(blob, `combined_${currentVideoId}.png`);
            });
        };
        
        img.onerror = () => {
            alert("Could not load image for processing.");
        };
    }

    function triggerDownload(blob, filename) {
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        window.URL.revokeObjectURL(url);
    }

    function showError(message) {
        const errorEl = document.getElementById('errorMsg');
        errorEl.textContent = message;
        errorEl.style.display = 'block';
    }

    function extractVideoID(url) {
        const regExp = /^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#&?]*).*/;
        const match = url.match(regExp);
        return (match && match[7].length == 11) ? match[7] : false;
    }
</script>

</body>
</html>
