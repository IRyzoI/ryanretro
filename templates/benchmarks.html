{% extends "layout.html" %}

{% block title %}Value Benchmarks{% endblock %}

{% block head_styles %}
<style>
    /* --- BENCHMARK SPECIFIC STYLES --- */
    
    /* Scrollbar override for the table container */
    .custom-scrollbar::-webkit-scrollbar { height: 8px; width: 8px; }
    .custom-scrollbar::-webkit-scrollbar-track { background: #1f2937; border-radius: 10px; }
    .custom-scrollbar::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 10px; }
    .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #6b7280; }

    /* Table Specifics */
    .rr-table {
      width: 100%;
      border-collapse: separate; 
      border-spacing: 0;
    }
    .rr-table th {
      position: sticky;
      top: 0;
      z-index: 10;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      font-size: 0.75rem;
      border-bottom: 4px solid #000;
    }
    .rr-table td {
      border-bottom: 1px solid #374151;
      padding: 0.75rem 1rem;
      white-space: nowrap;
    }

    /* Vertical column dividers */
    .rr-table tbody tr td:not(:first-child) {
      border-left: 1px solid #374151;
    }
    .rr-table tbody tr:last-child td {
      border-bottom: none;
    }
    
    /* Device Header Colors */
    .th-device { background-color: #1f2937; color: #fff; vertical-align: bottom; padding: 1rem; }
    
    /* Sortable Headers */
    .rr-table th.sortable { cursor: pointer; user-select: none; }
    .rr-table th.sortable::after { content: ''; margin-left: 5px; opacity: 0.5; }
    .rr-table th.sortable[data-sort-dir="asc"]::after { content: '▲'; }
    .rr-table th.sortable[data-sort-dir="desc"]::after { content: '▼'; }

    /* Highlight best value cell */
    .rr-table td.best-cell {
      background-color: rgba(74, 222, 128, 0.2) !important;
      color: #4ade80 !important;
      font-weight: 700;
      border-left: 2px solid #4ade80;
    }

    /* Runs Great highlight */
    .rr-table td.runs-great {
      background-color: rgba(16, 185, 129, 0.18) !important;
      box-shadow: inset 0 0 0 1px rgba(16, 185, 129, 0.9);
      color: #6ee7b7;
      font-weight: 700;
    }

    /* Mini mode for mobile */
    .mini-mode .rr-table th, 
    .mini-mode .rr-table td {
      padding: 0.5rem 0.5rem;
      font-size: 0.7rem;
    }
    .mini-mode .rr-table th.th-device {
      padding-top: 0.25rem;
      padding-bottom: 0.25rem;
      vertical-align: middle;
    }
    .mini-mode .chipset-label { display: none; }
    .mini-mode .rr-table th span.mb-1 { margin-bottom: 0; }

    /* Toggle Button States */
    .toggle-btn.off { opacity: 0.5; filter: grayscale(100%); }
    .toggle-btn.on { opacity: 1; filter: none; border-color: #facc15; color: #facc15; }

    /* --- RESTORE NOTE COLORS --- */
    /* This ensures colors show up even when Dark Mode tries to force white text */
    #notesContent h3.text-yellow-400 { color: #facc15 !important; }
    #notesContent h3.text-blue-400 { color: #60a5fa !important; }
    #notesContent h3.text-green-400 { color: #4ade80 !important; }
    #notesContent h3.text-purple-400 { color: #c084fc !important; }
</style>
{% endblock %}

{% block content %}
<div class="bg-overlay"></div>

<div class="py-10 md:py-14 w-full">
    <div class="mx-auto w-full max-w-[1900px] px-2 sm:px-4">
      
      <div class="text-center mb-10" data-aos="fade-down">
        <h1 class="retro-font text-3xl md:text-5xl text-yellow-400 mb-4 text-shadow">BENCHMARKS</h1>
        <p class="text-gray-500 dark:text-gray-400 text-sm md:text-base max-w-2xl mx-auto">
          Comparing average FPS across popular handhelds. Toggle devices and modes below to compare the power of the Snapdragon chipsets.
        </p>
      </div>

      <div class="bg-gray-800 pixel-border rounded-lg p-6 mb-8" data-aos="fade-up">
        
        <div class="flex flex-wrap items-center justify-center gap-3 mb-6 border-b border-gray-700 pb-6">
          <span class="retro-font text-xs text-gray-400 mr-2">SYSTEM:</span>
          <button class="mode-toggle px-4 py-2 rounded pixel-btn retro-font text-xs bg-yellow-400 text-black shadow-lg ring-2 ring-yellow-300" data-mode="combined">ALL</button>
          <button class="mode-toggle px-4 py-2 rounded pixel-btn retro-font text-xs bg-gray-700 text-gray-300 hover:bg-gray-600" data-mode="switch">SWITCH</button>
          <button class="mode-toggle px-4 py-2 rounded pixel-btn retro-font text-xs bg-gray-700 text-gray-300 hover:bg-gray-600" data-mode="windows">WINDOWS</button>
        </div>

        <div class="flex flex-wrap items-center justify-center gap-2 mb-6">
          <span class="retro-font text-xs text-gray-400 mr-2 w-full md:w-auto text-center md:text-left mb-2 md:mb-0">DEVICES:</span>
          
          <button type="button" class="device-toggle toggle-btn on border border-gray-600 bg-gray-900 px-3 py-2 rounded text-xs font-bold flex items-center gap-2 transition-all" data-col-index="1">
            <span class="w-2 h-2 rounded-full bg-green-500"></span> RP5
          </button>
          <button type="button" class="device-toggle toggle-btn on border border-gray-600 bg-gray-900 px-3 py-2 rounded text-xs font-bold flex items-center gap-2 transition-all" data-col-index="2">
            <span class="w-2 h-2 rounded-full bg-yellow-400"></span> RPG2
          </button>
          <button type="button" class="device-toggle toggle-btn on border border-gray-600 bg-gray-900 px-3 py-2 rounded text-xs font-bold flex items-center gap-2 transition-all" data-col-index="3">
            <span class="w-2 h-2 rounded-full bg-blue-400"></span> Odin 2 Portal
          </button>
          <button type="button" class="device-toggle toggle-btn on border border-gray-600 bg-gray-900 px-3 py-2 rounded text-xs font-bold flex items-center gap-2 transition-all" data-col-index="4">
            <span class="w-2 h-2 rounded-full bg-orange-400"></span> Konkr
          </button>
          <button type="button" class="device-toggle toggle-btn off border border-gray-700 text-gray-600 px-3 py-2 rounded text-xs font-bold flex items-center gap-2 transition-all" data-col-index="5">
            <span class="w-2 h-2 rounded-full" style="background-color: #374151;"></span> Fold 7
          </button>
          <button type="button" class="device-toggle toggle-btn on border border-gray-600 bg-gray-900 px-3 py-2 rounded text-xs font-bold flex items-center gap-2 transition-all" data-col-index="6">
            <span class="w-2 h-2 rounded-full bg-purple-400"></span> Odin 3
          </button>
          <button type="button" class="device-toggle toggle-btn on border border-gray-600 bg-gray-900 px-3 py-2 rounded text-xs font-bold flex items-center gap-2 transition-all" data-col-index="7">
            <span class="w-2 h-2 rounded-full bg-cyan-400"></span> Steam Deck
          </button>
        </div>

        <div class="flex flex-wrap items-center justify-center gap-3">
          <button id="toggleHighlight" class="px-3 py-1.5 rounded border border-emerald-500 text-emerald-400 hover:bg-emerald-500 hover:text-black transition text-xs font-bold flex items-center gap-2">
            <i data-feather="zap" class="w-3 h-3"></i> Highlight Best
          </button>
          <button id="toggleColorMode" class="px-3 py-1.5 rounded border border-fuchsia-500 text-fuchsia-400 hover:bg-fuchsia-500 hover:text-black transition text-xs font-bold flex items-center gap-2">
            <i data-feather="bar-chart" class="w-3 h-3"></i> Ranking Mode
          </button>
          <button id="toggleValueMode" class="px-3 py-1.5 rounded border border-yellow-500 text-yellow-400 hover:bg-yellow-500 hover:text-black transition text-xs font-bold flex items-center gap-2">
            <i data-feather="dollar-sign" class="w-3 h-3"></i> Value Mode
          </button>
          <button id="toggleRunsGreat" class="px-3 py-1.5 rounded border border-green-400 text-green-300 hover:bg-green-400 hover:text-black transition text-xs font-bold flex items-center gap-2">
            <i data-feather="check-circle" class="w-3 h-3"></i> Runs Great
          </button>
          <button id="toggleMiniMode" class="px-3 py-1.5 rounded border border-sky-500 text-sky-400 hover:bg-sky-500 hover:text-black transition text-xs font-bold flex items-center gap-2">
            <i data-feather="smartphone" class="w-3 h-3"></i> Mini View
          </button>
        </div>
      </div>

      <div id="benchCard" class="bg-gray-800 pixel-border rounded-lg overflow-hidden shadow-2xl" data-aos="fade-up" data-aos-delay="100">
        <div class="overflow-x-auto custom-scrollbar w-full">
          
          <table class="rr-table w-full text-left" data-mode="combined">
            <thead class="bg-black text-yellow-400 retro-font">
              <tr>
                <th class="p-4 min-w-[200px] sortable bg-gray-900 z-20">Game</th>
                <th class="th-device device-col-1 sortable min-w-[140px] text-center border-l border-gray-800">
                  <span class="text-green-400 block mb-1">Retroid Pocket 5</span>
                  <span class="text-[12px] text-gray-500 font-sans chipset-label">865</span>
                </th>
                <th class="th-device device-col-2 sortable min-w-[140px] text-center border-l border-gray-800">
                  <span class="text-yellow-400 block mb-1">Retroid Pocket G2</span>
                  <span class="text-[12px] text-gray-500 font-sans chipset-label">G2 Gen 2</span>
                </th>
                <th class="th-device device-col-3 sortable min-w-[140px] text-center border-l border-gray-800">
                  <span class="text-blue-400 block mb-1">AYN Odin 2 Portal</span>
                  <span class="text-[12px] text-gray-500 font-sans chipset-label">8 Gen 2</span>
                </th>
                <th class="th-device device-col-4 sortable min-w-[140px] text-center border-l border-gray-800">
                  <span class="text-orange-400 block mb-1">Konkr Pocket Fit</span>
                  <span class="text-[12px] text-gray-500 font-sans chipset-label">G3 Gen 3</span>
                </th>
                <th class="th-device device-col-5 sortable min-w-[140px] text-center border-l border-gray-800">
                  <span class="text-pink-400 block mb-1">Samsung Fold 7</span>
                  <span class="text-[12px] text-gray-500 font-sans chipset-label">8 Elite</span>
                </th>
                <th class="th-device device-col-6 sortable min-w-[140px] text-center border-l border-gray-800">
                  <span class="text-purple-400 block mb-1">AYN Odin 3</span>
                  <span class="text-[12px] text-gray-500 font-sans chipset-label">8 Elite</span>
                </th>
                <th class="th-device device-col-7 sortable min-w-[140px] text-center border-l border-gray-800">
                  <span class="text-cyan-400 block mb-1">Steam Deck</span>
                  <span class="text-[12px] text-gray-500 font-sans chipset-label">AMD APU</span>
                </th>
              </tr>
            </thead>
            <tbody class="text-sm font-mono text-gray-300 divide-y divide-gray-700 bg-gray-900">
              <tr class="hover:bg-gray-800 transition-colors even:bg-gray-800/30">
                <td class="font-bold text-white bg-gray-800/50">Captain Toad: Treasure Tracker</td>
                <td class="text-center">45</td><td class="text-center">75</td><td class="text-center">80</td><td class="text-center">155</td><td class="text-center">75</td><td class="text-center">160</td><td class="text-center">Untested</td>
              </tr>
              <tr class="hover:bg-gray-800 transition-colors even:bg-gray-800/30">
                <td class="font-bold text-white bg-gray-800/50">Cuphead</td>
                <td class="text-center">130</td><td class="text-center">175</td><td class="text-center">-</td><td class="text-center">280</td><td class="text-center">140</td><td class="text-center">318</td><td class="text-center">60</td>
              </tr>
              <tr class="hover:bg-gray-800 transition-colors even:bg-gray-800/30">
                <td class="font-bold text-white bg-gray-800/50">Cyberpunk 2077</td>
                <td class="text-center">-</td><td class="text-center">11</td><td class="text-center">15</td><td class="text-center">16</td><td class="text-center">7</td><td class="text-center">14</td><td class="text-center">30</td>
              </tr>
              <tr class="hover:bg-gray-800 transition-colors even:bg-gray-800/30">
                <td class="font-bold text-white bg-gray-800/50">Donut County</td>
                <td class="text-center">38</td><td class="text-center">80</td><td class="text-center">76</td><td class="text-center">156</td><td class="text-center">75</td><td class="text-center">85</td><td class="text-center">Untested</td>
              </tr>
              <tr class="hover:bg-gray-800 transition-colors even:bg-gray-800/30">
                <td class="font-bold text-white bg-gray-800/50">Elden Ring</td>
                <td class="text-center">11</td><td class="text-center">15</td><td class="text-center">19</td><td class="text-center">25</td><td class="text-center">5</td><td class="text-center">30</td><td class="text-center">40</td>
              </tr>
              <tr class="hover:bg-gray-800 transition-colors even:bg-gray-800/30">
                <td class="font-bold text-white bg-gray-800/50">FIFA 18</td>
                <td class="text-center">60</td><td class="text-center">73</td><td class="text-center">86</td><td class="text-center">150</td><td class="text-center">82</td><td class="text-center">100</td><td class="text-center">Untested</td>
              </tr>
              <tr class="hover:bg-gray-800 transition-colors even:bg-gray-800/30">
                <td class="font-bold text-white bg-gray-800/50">Golf Story</td>
                <td class="text-center">126</td><td class="text-center">126</td><td class="text-center">175</td><td class="text-center">185</td><td class="text-center">180</td><td class="text-center">240</td><td class="text-center">Untested</td>
              </tr>
              <tr class="hover:bg-gray-800 transition-colors even:bg-gray-800/30">
                <td class="font-bold text-white bg-gray-800/50">Gris</td>
                <td class="text-center">61</td><td class="text-center">115</td><td class="text-center">110</td><td class="text-center">260</td><td class="text-center">126</td><td class="text-center">130</td><td class="text-center">Untested</td>
              </tr>
              <tr class="hover:bg-gray-800 transition-colors even:bg-gray-800/30">
                <td class="font-bold text-white bg-gray-800/50">GTA V</td>
                <td class="text-center">20</td><td class="text-center">44</td><td class="text-center">47</td><td class="text-center">57</td><td class="text-center">-</td><td class="text-center">67</td><td class="text-center">76</td>
              </tr>
              <tr class="hover:bg-gray-800 transition-colors even:bg-gray-800/30">
                <td class="font-bold text-white bg-gray-800/50">Hades 2</td>
                <td class="text-center">51</td><td class="text-center">67</td><td class="text-center">-</td><td class="text-center">124</td><td class="text-center">105</td><td class="text-center">190</td><td class="text-center">150</td>
              </tr>
              <tr class="hover:bg-gray-800 transition-colors even:bg-gray-800/30">
                <td class="font-bold text-white bg-gray-800/50">Hollow Knight Silksong</td>
                <td class="text-center">80</td><td class="text-center">120</td><td class="text-center">-</td><td class="text-center">190</td><td class="text-center">122</td><td class="text-center">220</td><td class="text-center">250</td>
              </tr>
              <tr class="hover:bg-gray-800 transition-colors even:bg-gray-800/30">
                <td class="font-bold text-white bg-gray-800/50">Megabonk</td>
                <td class="text-center">-</td><td class="text-center">40</td><td class="text-center">-</td><td class="text-center">68</td><td class="text-center">40</td><td class="text-center">90</td><td class="text-center">240</td>
              </tr>
              <tr class="hover:bg-gray-800 transition-colors even:bg-gray-800/30">
                <td class="font-bold text-white bg-gray-800/50">Monster Boy and the Cursed Kingdom</td>
                <td class="text-center">115</td><td class="text-center">100</td><td class="text-center">160</td><td class="text-center">165</td><td class="text-center">120</td><td class="text-center">220</td><td class="text-center">250</td>
              </tr>
              <tr class="hover:bg-gray-800 transition-colors even:bg-gray-800/30">
                <td class="font-bold text-white bg-gray-800/50">Need for Speed Rivals</td>
                <td class="text-center">-</td><td class="text-center">30</td><td class="text-center">30</td><td class="text-center">30</td><td class="text-center">30</td><td class="text-center">30</td><td class="text-center">30</td>
              </tr>
              <tr class="hover:bg-gray-800 transition-colors even:bg-gray-800/30">
                <td class="font-bold text-white bg-gray-800/50">Pokémon Sword (In Battle)</td>
                <td class="text-center">40</td><td class="text-center">70</td><td class="text-center">84</td><td class="text-center">123</td><td class="text-center">95</td><td class="text-center">130</td><td class="text-center">Untested</td>
              </tr>
              <tr class="hover:bg-gray-800 transition-colors even:bg-gray-800/30">
                <td class="font-bold text-white bg-gray-800/50">Pokémon Sword (Open Areas)</td>
                <td class="text-center">30</td><td class="text-center">33</td><td class="text-center">50</td><td class="text-center">53</td><td class="text-center">50</td><td class="text-center">68</td><td class="text-center">Untested</td>
              </tr>
              <tr class="hover:bg-gray-800 transition-colors even:bg-gray-800/30">
                <td class="font-bold text-white bg-gray-800/50">Skyrim</td>
                <td class="text-center">25</td><td class="text-center">36</td><td class="text-center">57</td><td class="text-center">57</td><td class="text-center">47</td><td class="text-center">57</td><td class="text-center">60</td>
              </tr>
              <tr class="hover:bg-gray-800 transition-colors even:bg-gray-800/30">
                <td class="font-bold text-white bg-gray-800/50">Slay the Spire</td>
                <td class="text-center">110</td><td class="text-center">115</td><td class="text-center">142</td><td class="text-center">145</td><td class="text-center">200</td><td class="text-center">240</td><td class="text-center">Untested</td>
              </tr>
              <tr class="hover:bg-gray-800 transition-colors even:bg-gray-800/30">
                <td class="font-bold text-white bg-gray-800/50">Tennis in the Face</td>
                <td class="text-center">124</td><td class="text-center">106</td><td class="text-center">124</td><td class="text-center">124</td><td class="text-center">124</td><td class="text-center">125</td><td class="text-center">Untested</td>
              </tr>
              <tr class="hover:bg-gray-800 transition-colors even:bg-gray-800/30">
                <td class="font-bold text-white bg-gray-800/50">The Legend of Zelda: Breath of the Wild</td>
                <td class="text-center">25</td><td class="text-center">41</td><td class="text-center">37</td><td class="text-center">48</td><td class="text-center">38</td><td class="text-center">45</td><td class="text-center">Untested</td>
              </tr>
              <tr class="hover:bg-gray-800 transition-colors even:bg-gray-800/30">
                <td class="font-bold text-white bg-gray-800/50">The Legend of Zelda: Echoes of Wisdom</td>
                <td class="text-center">38</td><td class="text-center">35</td><td class="text-center">58</td><td class="text-center">55</td><td class="text-center">-</td><td class="text-center">82</td><td class="text-center">Untested</td>
              </tr>
              <tr class="hover:bg-gray-800 transition-colors even:bg-gray-800/30">
                <td class="font-bold text-white bg-gray-800/50">The Legend of Zelda: Tears of the Kingdom</td>
                <td class="text-center">22</td><td class="text-center">35</td><td class="text-center">44</td><td class="text-center">46</td><td class="text-center">-</td><td class="text-center">-</td><td class="text-center">Untested</td>
              </tr>
              <tr class="hover:bg-gray-800 transition-colors even:bg-gray-800/30">
                <td class="font-bold text-white bg-gray-800/50">The Witcher 3</td>
                <td class="text-center">14</td><td class="text-center">30</td><td class="text-center">42</td><td class="text-center">35</td><td class="text-center">41</td><td class="text-center">75</td><td class="text-center">Untested</td>
              </tr>
              <tr class="hover:bg-gray-800 transition-colors even:bg-gray-800/30">
                <td class="font-bold text-white bg-gray-800/50">Traveller’s Rest</td>
                <td class="text-center">-</td><td class="text-center">40</td><td class="text-center">30</td><td class="text-center">50</td><td class="text-center">40</td><td class="text-center">70</td><td class="text-center">78</td>
              </tr>
            </tbody>
          </table>

        </div>
        
        <div class="bg-gray-950 p-4 border-t border-gray-700 flex flex-col md:flex-row justify-between items-center gap-4">
          <div class="flex items-center gap-3 text-xs">
            <span class="text-gray-400">FPS RANKING:</span>
            <div class="flex items-center gap-1"><span class="w-3 h-3 rounded-sm bg-red-500"></span><span class="text-gray-500">Bad</span></div>
            <div class="flex items-center gap-1"><span class="w-3 h-3 rounded-sm bg-orange-400"></span></div>
            <div class="flex items-center gap-1"><span class="w-3 h-3 rounded-sm bg-amber-300"></span></div>
            <div class="flex items-center gap-1"><span class="w-3 h-3 rounded-sm bg-yellow-200"></span><span class="text-gray-500">Mid</span></div>
            <div class="flex items-center gap-1"><span class="w-3 h-3 rounded-sm bg-lime-300"></span></div>
            <div class="flex items-center gap-1"><span class="w-3 h-3 rounded-sm bg-green-400"></span></div>
            <div class="flex items-center gap-1"><span class="w-3 h-3 rounded-sm bg-emerald-400"></span><span class="text-gray-500">Good</span></div>
          </div>
          <div class="text-xs text-gray-500 text-center md:text-right">
            Values represent average FPS. Tested in identical conditions.
          </div>
        </div>
      </div>

      <div class="mt-12 text-center" data-aos="fade-up">
        <button id="toggleNotes" class="px-6 py-3 bg-gray-700 hover:bg-gray-600 text-white rounded pixel-btn retro-font text-[10px] md:text-xs border-2 border-black flex items-center justify-center gap-3 mx-auto shadow-[4px_4px_0_0_rgba(0,0,0,0.5)]">
          <i data-feather="info" class="w-4 h-4"></i>
          <span>SHOW NOTES</span>
        </button>
        
        <div id="notesContent" class="hidden mt-8 text-left bg-gray-900 border-4 border-black p-6 md:p-8 rounded-lg max-w-4xl mx-auto shadow-[8px_8px_0_0_rgba(0,0,0,0.2)]">
          <div class="space-y-6">
            <section>
              <h3 class="retro-font text-yellow-400 text-xs md:text-sm mb-3 flex items-center gap-2">
                <i data-feather="eye" class="w-4 h-4"></i> PERFORMANCE MEASUREMENT
              </h3>
              <p class="text-gray-400 text-sm leading-relaxed">
                Please note that these tests utilize "eyeballed" FPS averages observed during active gameplay. They were not captured using scientific frame-time analysis tools or specialized benchmarking software. These values should be viewed as rough guidelines and performance estimates rather than precise scientific measurements.
              </p>
            </section>

            <div class="grid md:grid-cols-2 gap-8">
              <section>
                <h3 class="retro-font text-blue-400 text-xs mb-3 flex items-center gap-2">
                  <i data-feather="dollar-sign" class="w-4 h-4"></i> VALUE MODE
                </h3>
                <p class="text-gray-400 text-sm leading-relaxed">
                  Value Mode displays the "Price per Frame" for each device. This is calculated by taking the cost of the handheld at the time of filming and dividing it by the average FPS achieved in that specific game ($/FPS). Lower values indicate better cost-to-performance efficiency.
                </p>
              </section>

              <section>
                <h3 class="retro-font text-green-400 text-xs mb-3 flex items-center gap-2">
                  <i data-feather="check-circle" class="w-4 h-4"></i> RUNS GREAT
                </h3>
                <p class="text-gray-400 text-sm leading-relaxed">
                  The "Runs Great" highlight indicates that the handheld achieved the expected playable target for that title. This threshold is typically 30 FPS for demanding AAA/3D games and 60 FPS for lighter or 2D titles.
                </p>
              </section>
            </div>

            <section class="border-t border-gray-700 pt-6">
              <h3 class="retro-font text-purple-400 text-xs md:text-sm mb-4 flex items-center gap-2">
                <i data-feather="cpu" class="w-4 h-4"></i> HANDHELD SPECIFICATIONS
              </h3>
              <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 text-[10px] md:text-xs">
                <div class="bg-gray-800/50 p-3 rounded border border-gray-700">
                  <span class="text-green-400 block mb-1">Retroid Pocket 5</span>
                  <p class="text-gray-300 font-bold mb-1">Snapdragon 865</p>
                  <p class="text-gray-400">8GB RAM / 128GB Storage</p>
                  <p class="text-gray-400 mt-1">$199</p>
                </div>
                <div class="bg-gray-800/50 p-3 rounded border border-gray-700">
                  <span class="text-yellow-400 block mb-1">Retroid Pocket G2</span>
                  <p class="text-gray-300 font-bold mb-1">Snapdragon G2 Gen 2</p>
                  <p class="text-gray-400">8GB RAM / 128GB Storage</p>
                  <p class="text-gray-400 mt-1">$219</p>
                </div>
                <div class="bg-gray-800/50 p-3 rounded border border-gray-700">
                  <span class="text-blue-400 block mb-1">AYN Odin 2 Portal</span>
                  <p class="text-gray-300 font-bold mb-1">Snapdragon 8 Gen 2</p>
                  <p class="text-gray-400">8GB RAM / 128GB Storage</p>
                  <p class="text-gray-400 mt-1">$329</p>
                </div>
                <div class="bg-gray-800/50 p-3 rounded border border-gray-700">
                  <span class="text-orange-400 block mb-1">Konkr Pocket Fit</span>
                  <p class="text-gray-300 font-bold mb-1">Snapdragon G3 Gen 3</p>
                  <p class="text-gray-400">12GB RAM / 256GB Storage</p>
                  <p class="text-gray-400 mt-1">$329</p>
                </div>
                <div class="bg-gray-800/50 p-3 rounded border border-gray-700">
                  <span class="text-pink-400 block mb-1">Samsung Fold 7</span>
                  <p class="text-gray-300 font-bold mb-1">Snapdragon 8 Elite</p>
                  <p class="text-gray-400">12GB RAM / 512GB Storage</p>
                  <p class="text-gray-400 mt-1">$1719</p>
                </div>
                <div class="bg-gray-800/50 p-3 rounded border border-gray-700">
                  <span class="text-purple-400 block mb-1">AYN Odin 3</span>
                  <p class="text-gray-300 font-bold mb-1">Snapdragon 8 Elite</p>
                  <p class="text-gray-400">16GB RAM / 512GB Storage</p>
                  <p class="text-gray-400 mt-1">$449</p>
                </div>
                <div class="bg-gray-800/50 p-3 rounded border border-gray-700">
                  <span class="text-cyan-400 block mb-1">Steam Deck</span>
                  <p class="text-gray-300 font-bold mb-1">AMD Custom APU</p>
                  <p class="text-gray-400">16GB RAM / 512GB Storage</p>
                  <p class="text-gray-400 mt-1">$399</p>
                </div>
              </div>
              <p class="text-gray-600 text-[16px] mt-4 tracking-tighter">
                Note: All prices shown were accurate at the time of filming and may have changed.
              </p>
            </section>
          </div>
        </div>
      </div>

    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', () => {
      // --- BENCHMARK LOGIC ---
      const DEVICE_COUNT = 7;
      // Provided Prices (at time of filming)
      const prices = {
        1: 199,  // RP5
        2: 219,  // RPG2
        3: 329,  // Odin 2 Portal
        4: 329,  // Konkr
        5: 1719, // Fold 7
        6: 449,  // Odin 3
        7: 399   // Steam Deck
      };

      // State
      let activeMode = 'combined';
      let highlightOn = false;
      let colorModeOn = false;
      let valueModeOn = false;
      let runsGreatOn = false;
      let miniModeOn = false;
      const columnVisibility = { 1: true, 2: true, 3: true, 4: true, 5: false, 6: true, 7: true };

      // Selectors
      const tables = document.querySelectorAll('.rr-table');
      const modeButtons = document.querySelectorAll('.mode-toggle');
      const deviceButtons = document.querySelectorAll('.device-toggle');
      const highlightBtn = document.getElementById('toggleHighlight');
      const colorBtn = document.getElementById('toggleColorMode');
      const valueBtn = document.getElementById('toggleValueMode');
      const runsBtn = document.getElementById('toggleRunsGreat');
      const miniBtn = document.getElementById('toggleMiniMode');
      const benchCard = document.getElementById('benchCard');
      const notesBtn = document.getElementById('toggleNotes');
      const notesContent = document.getElementById('notesContent');

      // Notes Toggle
      if(notesBtn) {
        notesBtn.addEventListener('click', () => {
          const isHidden = notesContent.classList.contains('hidden');
          if (isHidden) {
            notesContent.classList.remove('hidden');
            notesBtn.querySelector('span').innerText = 'HIDE NOTES';
            notesContent.scrollIntoView({ behavior: 'smooth', block: 'start' });
          } else {
            notesContent.classList.add('hidden');
            notesBtn.querySelector('span').innerText = 'SHOW NOTES';
          }
        });
      }

      function getActiveTable() {
        return document.querySelector(`.rr-table[data-mode="${activeMode}"]`);
      }

      function updateTableVisibility() {
        tables.forEach(t => t.style.display = 'none');
        getActiveTable().style.display = 'table';
      }

      function clearEffects() {
        document.querySelectorAll('.best-cell').forEach(el => el.classList.remove('best-cell'));
        document.querySelectorAll('.runs-great').forEach(el => el.classList.remove('runs-great'));
        document.querySelectorAll('.rr-table td').forEach(el => {
          el.style.color = '';
          el.style.fontWeight = '';
          if (el.dataset.original) {
            el.innerHTML = el.dataset.original; 
            if(!el.dataset.original.includes('<')) el.innerText = el.dataset.original;
            delete el.dataset.original;
          }
        });
      }

      function updateColumnVisibility() {
        tables.forEach(table => {
          const headRow = table.querySelector('thead tr');
          const bodyRows = table.querySelectorAll('tbody tr');

          for (let i = DEVICE_COUNT; i >= 1; i--) {
            const th = headRow.children[i];
            if (th) th.style.display = columnVisibility[i] ? '' : 'none';
          }

          bodyRows.forEach(row => {
            for (let i = DEVICE_COUNT; i >= 1; i--) {
              const td = row.children[i];
              if (td) td.style.display = columnVisibility[i] ? '' : 'none';
            }
          });
        });
        
        if (highlightOn) applyHighlight();
        if (colorModeOn) applyColorMode();
        if (valueModeOn) applyValueMode();
        if (runsGreatOn) applyRunsGreat();
      }

      function applyHighlight() {
        clearEffects();
        const table = getActiveTable();
        const rows = table.querySelectorAll('tbody tr');

        rows.forEach(row => {
          let maxVal = -Infinity;
          let cells = [];

          for (let i = 1; i <= DEVICE_COUNT; i++) {
            if (!columnVisibility[i]) continue;
            const cell = row.children[i];
            const val = parseFloat(cell.innerText);
            if (!isNaN(val)) {
              if (val > maxVal) maxVal = val;
              cells.push(cell);
            }
          }

          if (maxVal > 0) {
            cells.forEach(cell => {
              if (parseFloat(cell.innerText) === maxVal) {
                cell.classList.add('best-cell');
              }
            });
          }
        });
      }

      function applyColorMode() {
        clearEffects();
        const table = getActiveTable();
        const rows = table.querySelectorAll('tbody tr');
        
        rows.forEach(row => {
          let vals = [];
          for (let i = 1; i <= DEVICE_COUNT; i++) {
            if (!columnVisibility[i]) continue;
            const val = parseFloat(row.children[i].innerText);
            if (!isNaN(val)) vals.push(val);
          }

          if (vals.length === 0) return;
          const min = Math.min(...vals);
          const max = Math.max(...vals);
          const range = max - min || 1;

          for (let i = 1; i <= DEVICE_COUNT; i++) {
            if (!columnVisibility[i]) continue;
            const cell = row.children[i];
            const val = parseFloat(cell.innerText);
            if (isNaN(val)) continue;

            const t = (val - min) / range;
            if (t < 0.33) {
              cell.style.color = '#f87171';
            } else if (t < 0.66) {
              cell.style.color = '#facc15';
            } else {
              cell.style.color = '#4ade80';
              cell.style.fontWeight = 'bold';
            }
          }
        });
      }

      function applyValueMode() {
        clearEffects();
        const table = getActiveTable();
        const rows = table.querySelectorAll('tbody tr');

        rows.forEach(row => {
          let minCost = Infinity;
          let calculatedCosts = {};

          // First pass: Find minimum cost among visible columns
          for (let i = 1; i <= DEVICE_COUNT; i++) {
            const cell = row.children[i];
            // Ensure dataset.original is set
            const originalText = cell.dataset.original || cell.innerText.trim();
            if (!cell.dataset.original) {
              cell.dataset.original = originalText;
            }

            if (!columnVisibility[i]) continue;

            const val = parseFloat(originalText);

            if (!isNaN(val) && val > 0) {
              const cost = prices[i] / val;
              calculatedCosts[i] = cost;
              if (cost < minCost) {
                minCost = cost;
              }
            }
          }

          // Second pass: Apply styling
          for (let i = 1; i <= DEVICE_COUNT; i++) {
            const cell = row.children[i];
            const originalText = cell.dataset.original;
            const val = parseFloat(originalText);

            if (!isNaN(val) && val > 0) {
              const cost = prices[i] / val;
              
              // Check if best value (must be visible to be minCost, but if hidden we still calculate)
              const isBest = (calculatedCosts[i] !== undefined && Math.abs(cost - minCost) < 0.0001);

              if (isBest) {
                cell.innerHTML = `<span class="text-green-400 font-bold">$${cost.toFixed(2)}</span>`;
                cell.classList.add('best-cell');
              } else {
                cell.innerHTML = `<span class="text-yellow-400 font-bold">$${cost.toFixed(2)}</span>`;
              }
            }
          }
        });
      }

      function applyRunsGreat() {
        clearEffects();
        const table = getActiveTable();
        const rows = table.querySelectorAll('tbody tr');

        rows.forEach(row => {
          const nameCell = row.children[0];
          const gameName = nameCell.dataset.fullName || nameCell.innerText.trim();
          
          const demanding = (
            gameName === 'Elden Ring' || 
            gameName === 'Cyberpunk 2077' || 
            gameName === 'Need for Speed Rivals' ||
            gameName === 'Pokémon Sword (Open Areas)' ||
            gameName === 'Pokémon Sword (In Battle)' ||
            gameName === 'The Legend of Zelda: Breath of the Wild' ||
            gameName === 'The Legend of Zelda: Tears of the Kingdom' ||
            gameName === 'The Witcher 3'
          );
          const threshold = demanding ? 30 : 60;

          for (let i = 1; i <= DEVICE_COUNT; i++) {
            if (!columnVisibility[i]) continue;
            const cell = row.children[i];
            const val = parseFloat(cell.innerText);
            if (!isNaN(val) && val >= threshold) {
              cell.classList.add('runs-great');
            }
          }
        });
      }

      function updateGameNamesForMiniMode() {
        const rows = document.querySelectorAll('.rr-table tbody tr');
        rows.forEach(row => {
          const cell = row.children[0]; 
          if (!cell.dataset.fullName) {
            cell.dataset.fullName = cell.innerText.trim();
          }

          if (miniModeOn) {
            const originalName = cell.dataset.fullName;
            if (originalName === 'Monster Boy and the Cursed Kingdom') {
              cell.innerText = 'Monster Boy';
            } else if (originalName === 'Captain Toad: Treasure Tracker') {
              cell.innerText = 'Captain Toad';
            } else if (originalName.startsWith('The Legend of Zelda: ')) {
              cell.innerText = originalName.replace('The Legend of Zelda: ', '');
            }
          } else {
            if (cell.dataset.fullName) {
              cell.innerText = cell.dataset.fullName;
            }
          }
        });
      }

      // Universal reset for filter buttons
      function resetFilterButtons() {
        const btns = [highlightBtn, colorBtn, valueBtn, runsBtn];
        btns.forEach(b => {
          b.classList.remove('bg-emerald-500', 'bg-fuchsia-500', 'bg-yellow-500', 'bg-green-500', 'text-black', 'shadow-lg');
          const originalBorder = b.id === 'toggleHighlight' ? 'border-emerald-500 text-emerald-400' :
                                 b.id === 'toggleColorMode' ? 'border-fuchsia-500 text-fuchsia-400' :
                                 b.id === 'toggleValueMode' ? 'border-yellow-500 text-yellow-400' :
                                 'border-green-400 text-green-300';
          b.className = `px-3 py-1.5 rounded border transition text-xs font-bold flex items-center gap-2 ${originalBorder}`;
        });
      }

      // Mode Toggles
      modeButtons.forEach(btn => {
        btn.addEventListener('click', () => {
          modeButtons.forEach(b => {
            b.className = 'mode-toggle px-4 py-2 rounded pixel-btn retro-font text-xs bg-gray-700 text-gray-300 hover:bg-gray-600';
          });

          const mode = btn.dataset.mode;
          let activeClass = '';

          if (mode === 'combined') {
            activeClass = 'bg-yellow-400 text-black shadow-lg ring-2 ring-yellow-300';
          } else if (mode === 'switch') {
            activeClass = 'bg-red-600 text-white shadow-lg ring-2 ring-red-400';
          } else if (mode === 'windows') {
            activeClass = 'bg-blue-600 text-white shadow-lg ring-2 ring-blue-400';
          }

          btn.className = `mode-toggle px-4 py-2 rounded pixel-btn retro-font text-xs ${activeClass}`;
          
          activeMode = mode;
          updateTableVisibility();
          
          if (highlightOn) applyHighlight();
          if (colorModeOn) applyColorMode();
          if (valueModeOn) applyValueMode();
          if (runsGreatOn) applyRunsGreat();
          
          if (miniModeOn) updateGameNamesForMiniMode();
        });
      });

      // Device Toggles
      deviceButtons.forEach(btn => {
        btn.addEventListener('click', () => {
          const idx = parseInt(btn.dataset.colIndex);
          const isOn = !btn.classList.contains('off');
          
          if (isOn) {
            btn.classList.add('off', 'border-gray-700', 'text-gray-600');
            btn.classList.remove('on', 'border-gray-600', 'bg-gray-900');
            btn.querySelector('span').style.backgroundColor = '#374151';
            columnVisibility[idx] = false;
          } else {
            btn.classList.remove('off', 'border-gray-700', 'text-gray-600');
            btn.classList.add('on', 'border-gray-600', 'bg-gray-900');
            const colors = ['', 'bg-green-500', 'bg-yellow-400', 'bg-blue-400', 'bg-orange-400', 'bg-pink-400', 'bg-purple-400', 'bg-cyan-400'];
            btn.querySelector('span').style.backgroundColor = '';
            btn.querySelector('span').className = `w-2 h-2 rounded-full ${colors[idx]}`;
            columnVisibility[idx] = true;
          }
          updateColumnVisibility();
        });
      });

      // Feature Toggles
      highlightBtn.addEventListener('click', () => {
        const state = !highlightOn;
        resetFilterButtons();
        clearEffects();
        highlightOn = state; colorModeOn = false; valueModeOn = false; runsGreatOn = false;
        if (highlightOn) {
          applyHighlight();
          highlightBtn.classList.add('bg-emerald-500', 'text-black', 'shadow-lg');
          highlightBtn.classList.remove('border-emerald-500', 'text-emerald-400');
        }
      });

      colorBtn.addEventListener('click', () => {
        const state = !colorModeOn;
        resetFilterButtons();
        clearEffects();
        colorModeOn = state; highlightOn = false; valueModeOn = false; runsGreatOn = false;
        if (colorModeOn) {
          applyColorMode();
          colorBtn.classList.add('bg-fuchsia-500', 'text-black', 'shadow-lg');
          colorBtn.classList.remove('border-fuchsia-500', 'text-fuchsia-400');
        }
      });

      valueBtn.addEventListener('click', () => {
        const state = !valueModeOn;
        resetFilterButtons();
        clearEffects();
        valueModeOn = state; highlightOn = false; colorModeOn = false; runsGreatOn = false;
        if (valueModeOn) {
          applyValueMode();
          valueBtn.classList.add('bg-yellow-500', 'text-black', 'shadow-lg');
          valueBtn.classList.remove('border-yellow-500', 'text-yellow-400');
        }
      });

      runsBtn.addEventListener('click', () => {
        const state = !runsGreatOn;
        resetFilterButtons();
        clearEffects();
        runsGreatOn = state; highlightOn = false; colorModeOn = false; valueModeOn = false;
        if (runsGreatOn) {
          applyRunsGreat();
          runsBtn.classList.add('bg-green-500', 'text-black', 'shadow-lg');
          runsBtn.classList.remove('border-green-400', 'text-green-300');
        }
      });

      miniBtn.addEventListener('click', () => {
        miniModeOn = !miniModeOn;
        if (miniModeOn) {
          benchCard.classList.add('mini-mode');
          miniBtn.classList.add('bg-sky-500', 'text-black', 'shadow-lg');
          miniBtn.classList.remove('border-sky-500', 'text-sky-400');
        } else {
          benchCard.classList.remove('mini-mode');
          miniBtn.classList.remove('bg-sky-500', 'text-black', 'shadow-lg');
          miniBtn.classList.add('border-sky-500', 'text-sky-400');
        }
        updateGameNamesForMiniMode(); 
      });

      // Sorting Logic (Handles Dollar Values)
      document.querySelectorAll('th.sortable').forEach(th => {
        th.addEventListener('click', function() {
          const table = th.closest('table');
          const tbody = table.querySelector('tbody');
          const rowsArray = Array.from(tbody.rows);
          const colIndex = Array.from(th.parentNode.children).indexOf(th);
          const isAsc = th.dataset.sortDir === 'asc';
          
          table.querySelectorAll('th').forEach(h => h.removeAttribute('data-sort-dir'));
          th.dataset.sortDir = isAsc ? 'desc' : 'asc';
          
          rowsArray.sort((a, b) => {
            const cellA = a.children[colIndex];
            const cellB = b.children[colIndex];
            
            // Clean values for comparison (remove $, etc)
            const getCleanVal = (cell) => {
              let val = cell.innerText.trim();
              if (val.startsWith('$')) val = val.substring(1);
              if (val === '-' || val.toLowerCase() === 'untested') return -1;
              const n = parseFloat(val);
              return isNaN(n) ? val : n;
            };

            const valA = getCleanVal(cellA);
            const valB = getCleanVal(cellB);

            if (typeof valA === 'number' && typeof valB === 'number') {
              return isAsc ? valB - valA : valA - valB;
            } else {
              return isAsc ? valB.toString().localeCompare(valA) : valA.toString().localeCompare(valB);
            }
          });
          tbody.append(...rowsArray);
        });
      });

      // Initial check for mobile
      if (window.innerWidth < 768) {
        miniModeOn = true;
        benchCard.classList.add('mini-mode');
        miniBtn.classList.add('bg-sky-500', 'text-black', 'shadow-lg');
        miniBtn.classList.remove('border-sky-500', 'text-sky-400');
        updateGameNamesForMiniMode();
      }

      updateTableVisibility();
      updateColumnVisibility();
    });
</script>
{% endblock %}
