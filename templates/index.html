{% extends "layout.html" %}

{% block title %}Home{% endblock %}

{% block content %}
<div id="achievement-popup" class="w-[90%] max-w-md fixed bottom-[-150px] left-1/2 -translate-x-1/2 z-[9999] transition-all duration-500">
    <div class="bg-yellow-400 border-4 border-black p-4 pixel-border flex items-center gap-4 shadow-[0_0_20px_rgba(250,204,21,0.4)]">
        <div class="bg-black p-2 border-2 border-black">
            <i data-feather="star" class="text-yellow-400 w-8 h-8 fill-yellow-400 animate-[spin_3s_linear_infinite]"></i>
        </div>
        <div class="flex-1">
            <p class="retro-font text-[10px] text-black uppercase mb-1">Achievement Unlocked!</p>
            <p class="retro-font text-[8px] text-gray-900 uppercase leading-snug">You're persistent! I like that about you too.</p>
        </div>
        <button onclick="document.getElementById('achievement-popup').classList.remove('show-popup')" class="text-black hover:text-white transition-colors">
            <i data-feather="x" class="w-4 h-4"></i>
        </button>
    </div>
</div>

<style>
    .show-popup { bottom: 30px !important; }
    /* Flip Card Styles */
    .flip-card { perspective: 1000px; cursor: pointer; }
    .flip-card-inner { position: relative; width: 100%; height: 100%; text-align: center; transition: transform 0.6s; transform-style: preserve-3d; }
    .flip-card.flipped .flip-card-inner { transform: rotateY(180deg); }
    .flip-card-front, .flip-card-back { position: absolute; width: 100%; height: 100%; -webkit-backface-visibility: hidden; backface-visibility: hidden; top: 0; left: 0; }
    .flip-card-back { transform: rotateY(180deg); }
    .rare-holo-bg { background: linear-gradient(135deg, #1e1b4b 0%, #4c1d95 25%, #be185d 50%, #4c1d95 75%, #1e1b4b 100%); background-size: 300% 300%; animation: foil-shine 6s ease infinite; }
    @keyframes foil-shine { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
</style>

<section id="games" class="py-16 bg-gray-200">
  <div class="container mx-auto px-4">
    <div class="flex items-center justify-center gap-4 mb-8" data-aos="fade-down">
        <h2 class="retro-font text-3xl md:text-4xl text-yellow-400 text-center drop-shadow-[2px_2px_0_rgba(0,0,0,1)]">PLAY RETRO GAMES</h2>
        <button id="device-trigger" class="play-trigger pixel-btn bg-yellow-400 text-black border-2 border-black rounded" onclick="toggleMarquee('device-marquee')" title="Pause/Resume Scroll">
            <svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
        </button>
    </div>
    
    <div class="flex flex-wrap justify-center items-center gap-2 mb-12">
      <button class="filter-btn filter-btn-default bg-gray-300 text-black px-4 py-2 rounded retro-font text-sm" data-filter="all">ALL</button>
      <button class="filter-btn filter-btn-default bg-gray-300 text-black px-4 py-2 rounded retro-font text-sm" data-filter="retroid">RETROID</button>
      <button class="filter-btn filter-btn-default bg-gray-300 text-black px-4 py-2 rounded retro-font text-sm" data-filter="ayn">AYN</button>
      <button class="filter-btn filter-btn-default bg-gray-300 text-black px-4 py-2 rounded retro-font text-sm" data-filter="ayaneo">AYANEO</button>
    </div>
  </div>

  <div class="marquee-container custom-scrollbar" id="device-marquee">
      <div class="marquee-track py-4">
        <a href="/static/handheld.html?device=Retroid%20Pocket%206" class="group device-item bg-white border-2 border-gray-300 rounded-lg overflow-hidden pixel-btn block" data-brand="retroid">
          <img src="https://www.goretroid.com/cdn/shop/files/bbe4c9ab94f9be237637709704cd2056_2048x.jpg?v=1761899314" class="w-full h-48 object-cover" alt="RP6">
          <div class="p-6">
            <span class="bg-red-500 text-black text-[10px] px-2 py-1 rounded retro-font">RETROID</span>
            <h3 class="text-xl font-bold mt-2 text-gray-800">Retroid Pocket 6</h3>
          </div>
        </a>

        <a href="/static/handheld.html?device=Retroid%20Pocket%20G2" class="group device-item bg-white border-2 border-gray-300 rounded-lg overflow-hidden pixel-btn block" data-brand="retroid">
          <img src="https://www.goretroid.com/cdn/shop/files/1_c52206d5-1a34-4947-b743-15a06041a963_2048x.jpg?v=1761373135" class="w-full h-48 object-cover" alt="RPG2">
          <div class="p-6">
            <span class="bg-red-500 text-black text-[10px] px-2 py-1 rounded retro-font">RETROID</span>
            <h3 class="text-xl font-bold mt-2 text-gray-800">Retroid Pocket G2</h3>
          </div>
        </a>

        <a href="/static/handheld.html?device=Retroid%20Pocket%205" class="group device-item bg-white border-2 border-gray-300 rounded-lg overflow-hidden pixel-btn block" data-brand="retroid">
          <img src="https://huggingface.co/spaces/IRyzoI/RyanRetro/resolve/main/images/rp5square.png" class="w-full h-48 object-cover" alt="RP5">
          <div class="p-6">
            <span class="bg-red-500 text-black text-[10px] px-2 py-1 rounded retro-font">RETROID</span>
            <h3 class="text-xl font-bold mt-2 text-gray-800">Retroid Pocket 5</h3>
          </div>
        </a>

        <a href="/static/handheld.html?device=Odin%202%20Portal" class="group device-item bg-white border-2 border-gray-300 rounded-lg overflow-hidden pixel-btn block" data-brand="ayn">
          <img src="https://huggingface.co/spaces/IRyzoI/RyanRetro/resolve/main/images/o2psquare.png" class="w-full h-48 object-cover" alt="O2P">
          <div class="p-6">
            <span class="bg-blue-500 text-black text-[10px] px-2 py-1 rounded retro-font">AYN</span>
            <h3 class="text-xl font-bold mt-2 text-gray-800">Odin 2 Portal</h3>
          </div>
        </a>

        <a href="/static/handheld.html?device=Odin%203" class="group device-item bg-white border-2 border-gray-300 rounded-lg overflow-hidden pixel-btn block" data-brand="ayn">
          <img src="https://huggingface.co/spaces/IRyzoI/RyanRetro/resolve/main/images/odin3.png" class="w-full h-48 object-cover" alt="Odin 3">
          <div class="p-6">
            <span class="bg-blue-500 text-black text-[10px] px-2 py-1 rounded retro-font">AYN</span>
            <h3 class="text-xl font-bold mt-2 text-gray-800">Odin 3</h3>
          </div>
        </a>
      </div>
  </div>
</section>

<section id="videos" class="py-16 bg-gray-100">
  <div class="container mx-auto px-4 text-center">
    <div class="flex items-center justify-center gap-4 mb-12" data-aos="fade-down">
        <h2 class="retro-font text-3xl md:text-4xl text-yellow-400 drop-shadow-[2px_2px_0_rgba(0,0,0,1)]">LATEST VIDEOS</h2>
        <button id="video-trigger" class="play-trigger pixel-btn bg-red-600 text-white border-2 border-black rounded" onclick="toggleMarquee('video-marquee')" title="Pause/Resume Scroll">
            <svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
        </button>
    </div>
  </div>
  <div class="marquee-container custom-scrollbar video-scrollbar" id="video-marquee">
      <div id="latest-videos-track" class="marquee-track py-4">
        <p class="w-full text-center text-gray-500 py-10">Loading latest videos...</p>
      </div>
  </div>
  <div class="text-center mt-12">
    <a href="https://www.youtube.com/@RyanRetro/videos" target="_blank" class="inline-block bg-gray-700 hover:bg-gray-600 text-white px-8 py-3 rounded pixel-btn retro-font">VIEW ALL VIDEOS</a>
  </div>
</section>

<section id="guides" class="py-16 bg-gray-200">
  <div class="container mx-auto px-4">
    <h2 class="retro-font text-3xl md:text-4xl text-yellow-400 mb-12 text-center drop-shadow-[2px_2px_0_rgba(0,0,0,1)]" data-aos="fade-down">RETRO GUIDES</h2>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
      <a href="/guides/steam-android" class="bg-white border-2 border-gray-300 rounded-lg overflow-hidden pixel-btn block video-item" data-aos="fade-up" data-aos-delay="0">
        <img src="https://cdn.akamai.steamstatic.com/store/home/store_home_share.jpg" class="w-full h-48 object-cover" alt="Steam Guide">
        <div class="p-6 video-info-area bg-gray-50">
          <span class="bg-green-500 text-black text-[10px] px-2 py-1 rounded retro-font">ANDROID</span>
          <h3 class="text-xl font-bold mt-2 video-title text-gray-900">Steam on Android</h3>
        </div>
      </a>
      </div>
  </div>
</section>

<section class="py-16 bg-gray-100">
  <div class="container mx-auto px-4">
    <div class="flex flex-col md:flex-row items-center gap-10">
      <div class="md:w-1/2" data-aos="fade-right">
        <div class="flip-card w-full aspect-square max-w-[400px] mx-auto" onclick="this.classList.toggle('flipped')">
            <div class="flip-card-inner h-full">
                <div class="flip-card-front">
                    <img src="https://huggingface.co/spaces/IRyzoI/RyanRetro/resolve/main/images/ryan%20retro%20logo.png" alt="Ryan Retro" class="rounded-lg pixel-border w-full h-full object-cover bg-gray-800">
                </div>
                <div class="flip-card-back rounded-lg pixel-border rare-holo-bg border-[6px] border-yellow-400 p-4 flex flex-col justify-between relative overflow-hidden shadow-[0_0_15px_rgba(234,179,8,0.4)]">
                    <div class="absolute inset-0 bg-gradient-to-tr from-transparent via-white/10 to-transparent opacity-30 pointer-events-none"></div>
                    <div class="bg-black/70 border-2 border-yellow-400/50 p-3 rounded flex-grow flex items-center justify-center relative z-10 backdrop-blur-sm">
                        <p class="text-white text-xs sm:text-sm md:text-sm leading-relaxed font-sans text-center drop-shadow-md w-full">
                            I truly appreciate everyone who takes the time to watch my youtube videos...
                        </p>
                    </div>
                </div>
            </div>
        </div>
      </div>
      <div class="md:w-1/2" data-aos="fade-left">
        <h2 class="retro-font text-3xl md:text-4xl text-yellow-400 mb-6 drop-shadow-[2px_2px_0_rgba(0,0,0,1)]">ABOUT RYAN RETRO</h2>
        <p class="text-gray-600 text-lg mb-8 leading-relaxed">I've loved games since I got my purple Game Boy Color and Pokemon Red as a little kid...</p>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
             <a href="https://patreon.com/ryanretro" target="_blank" class="bg-orange-600 hover:bg-orange-700 text-white px-6 py-3 rounded pixel-btn retro-font text-xs flex items-center justify-center">PATREON</a>
             <a href="https://www.youtube.com/@RyanRetro" target="_blank" class="bg-red-600 hover:bg-red-700 text-white px-6 py-3 rounded pixel-btn retro-font text-xs flex items-center justify-center">SUBSCRIBE</a>
        </div>
      </div>
    </div>
  </div>
</section>

{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
  
  // 1. Initialize Marquees
  initMarquee('device-marquee');

  // 2. Filter Button Logic
  const filterBtns = document.querySelectorAll('.filter-btn');
  const ACTIVE_MAP = { 
      all: 'bg-yellow-400 text-black', 
      retroid: 'bg-red-600 text-white', 
      ayn: 'bg-blue-600 text-white', 
      ayaneo: 'bg-indigo-600 text-white' 
  };

  filterBtns.forEach(btn => {
    btn.addEventListener('click', () => {
      const filter = btn.dataset.filter;
      const allItems = document.querySelectorAll('.device-item');
      
      filterBtns.forEach(b => {
          b.classList.remove('active-brand', 'bg-white', 'bg-red-600', 'bg-blue-600', 'bg-indigo-600', 'text-white', 'bg-yellow-400', 'text-black');
          b.classList.add('bg-gray-300', 'text-black', 'filter-btn-default');
      });
      
      btn.classList.remove('bg-gray-300', 'text-black', 'filter-btn-default');
      const activeClasses = (ACTIVE_MAP[filter] || 'bg-white text-black').split(' ');
      btn.classList.add(...activeClasses, 'active-brand');
      
      allItems.forEach(item => {
          item.style.display = (filter === 'all' || item.dataset.brand === filter) ? 'block' : 'none';
      });
      // Reset scroll
      const container = document.getElementById('device-marquee');
      if(container) container.scrollLeft = 0;
    });
  });
  
  // Set default filter
  const defBtn = document.querySelector('.filter-btn[data-filter="all"]');
  if(defBtn) defBtn.click();

  // 3. Load Videos
  async function loadVideos() {
    const track = document.getElementById('latest-videos-track');
    if (!track) return;
    try {
      const res = await fetch('/api/latest-videos?limit=10');
      const data = await res.json();
      if (data && data.length) {
        track.innerHTML = data.map(v => `
          <a href="https://www.youtube.com/watch?v=${v.id}" target="_blank" class="video-item bg-white border-2 border-gray-300 rounded-lg overflow-hidden pixel-btn block group">
            <div class="relative pb-[56.25%] bg-black">
              <img src="${v.thumb}" class="absolute h-full w-full object-cover transition-transform duration-200 group-hover:scale-[1.02]" alt="${(v.title || '').replace(/"/g,'&quot;')}">
              <div class="absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 bg-black/40 transition-opacity">
                  <i data-feather="play" class="text-white w-12 h-12"></i>
              </div>
            </div>
            <div class="p-4 h-20 video-info-area bg-gray-50">
              <h3 class="video-title font-bold text-xs line-clamp-2 text-gray-900">${v.title}</h3>
            </div>
          </a>`).join('');
        feather.replace();
        initMarquee('video-marquee');
      }
    } catch(e) {
      track.innerHTML = '<p class="text-center w-full py-10 text-gray-500">Visit YouTube for updates</p>';
    }
  }
  loadVideos();
});

// 4. Achievement Logic
let deviceTriggerClicks = 0;
window.onMarqueeToggle = function(id) {
    if (id === 'device-marquee') {
        deviceTriggerClicks++;
        if (deviceTriggerClicks === 5) {
            const popup = document.getElementById('achievement-popup');
            if(popup) {
                popup.classList.add('show-popup');
                setTimeout(() => { popup.classList.remove('show-popup'); }, 6000);
            }
        }
    }
}
</script>
{% endblock %}
